YUI.add("gallery-dispatcher",function(B){var I=B.ClassNameManager.getClassName,K="dispatcher",T="script",W="fetch",S="purge",D="beforeExecute",V="load",Q="ready",H="uri",E="content",F="autopurge",P="loading",R="node",G="normalize",A=/<\s*body.*?>(.*?)<\/\s*?body[^>\w]*?>/i,U=/<\s*head.*?>(.*?)<\/\s*?head[^>\w]*?>/i,C=I(K,"loading"),J=B.Lang,M=J.isBoolean,N=J.isString;function X(c,L){var Z=B.Node.create("<div></div>"),b=Z.cloneNode(),d={},Y=null,a="";if(L&&(Y=U.exec(c))){Z.setContent(Y[1]).all(T+",style,link").each(function(e){b.append(e);});a=b.get("innerHTML");}Z.setContent(a+((Y=A.exec(c))?Y[1]:c));d.js=Z.all(T).each(function(e){e.get("parentNode").removeChild(e);});d.content=Z.get("innerHTML");return d;}function O(Z,L,Y){if(L&&L.on&&L.on[Z]){L.on[Z].apply(L.context||B,Y);}}B.Dispatcher=B.Base.create(K,B.Base,[],{_queue:null,_io:null,initializer:function(L){L=L||{};this._queue=new B.AsyncQueue();this.after(E+"Change",function(Y){this._dispatch(Y.newVal);},this);this.after(H+"Change",function(Y){this._fetch(Y.newVal);},this);if(L[E]){this._dispatch(this.get(E));}if(L[H]){this._fetch(this.get(H));}},destructor:function(){this.stop();this._queue=null;this._io=null;},_dispatch:function(Y){var L=this,a=X(Y,this.get(G)),Z=this._queue,b=this.get(R);this.stop();if(!b){return;}if(this.get(F)){Z.add({fn:function(){b.get("children").each(function(d){d.purge(true);});L.fire(S,b);}});}Z.add({fn:function(){b.setContent(a.content);L.fire(D,b);}});a.js.each(function(c){if(c&&c.get("src")){Z.add({fn:function(){B.Get.script(c.get("src"),{onFailure:function(d){},onEnd:function(d){d.purge();Z.run();}});},autoContinue:false});}else{Z.add({fn:function(){var g=c.get("ownerDocument"),f=g.one("head")||g.get("documentElement"),e=B.Node.create("<"+T+"></"+T+">");if(c._node.text){e._node.text=c._node.text;}f.appendChild(e);e.remove();c.remove();}});}});Z.add({fn:function(){L.fire(Q);}});this._queue.run();},_fetch:function(Z){var Y=this.get("ioConfig")||{},L;this.stop();if(!Z){return false;}L=B.merge({method:"GET"},Y);L.on={start:function(){this._set(P,true);O("start",Y,arguments);},success:function(a,b){this.set(E,b.responseText);O("success",Y,arguments);},failure:function(a,b){O("failure",Y,arguments);},end:function(){this._set(P,false);O("end",Y,arguments);}};L.context=this;return(this._io=B.io(Z,L));},stop:function(){this._queue.stop();if(this._io){this._io.abort();}return this;}},{EVENT_PREFIX:K,ATTRS:{node:{value:null,setter:function(L){this.stop();return B.one(L);}},autopurge:{value:true,validator:M},normalize:{value:false,validator:M},uri:{value:null,validator:function(L){return(L&&N(L)&&(L!==""));}},content:{value:"",validator:N},loading:{value:false,validator:M,readOnly:true,setter:function(L){if(L){this.fire(W);this.get(R).addClass(C);}else{this.fire(V);this.get(R).removeClass(C);}return L;}},ioConfig:{value:null}}});},"gallery-2010.09.15-18-40",{requires:["base","node-base","io-base","get","async-queue","classnamemanager"]});