YUI.add("gallery-dispatcher",function(B){var I=B.ClassNameManager.getClassName,K="dispatcher",S="script",V="fetch",R="purge",D="beforeExecute",U="load",P="ready",H="uri",E="content",F="autopurge",O="loading",Q="node",G="normalize",A=/<\s*body.*?>(.*?)<\/\s*?body[^>\w]*?>/i,T=/<\s*head.*?>(.*?)<\/\s*?head[^>\w]*?>/i,C=I(K,"loading"),J=B.Lang,M=J.isBoolean,N=J.isString;function W(b,L){var Y=B.Node.create("<div></div>"),a=Y.cloneNode(),c={},X=null,Z="";if(L&&(X=T.exec(b))){Y.setContent(X[1]).all(S+",style,link").each(function(d){a.append(d);});Z=a.get("innerHTML");}Y.setContent(Z+((X=A.exec(b))?X[1]:b));c.js=Y.all(S).each(function(d){d.get("parentNode").removeChild(d);});c.content=Y.get("innerHTML");return c;}B.Dispatcher=B.Base.create(K,B.Base,[],{_queue:null,_io:null,initializer:function(L){L=L||{};this._queue=new B.AsyncQueue();this.after(E+"Change",function(X){this._dispatch(X.newVal);},this);this.after(H+"Change",function(X){this._fetch(X.newVal);},this);if(L[E]){this._dispatch(this.get(E));}if(L[H]){this._fetch(this.get(H));}},destructor:function(){this.stop();this._queue=null;this._io=null;},_dispatch:function(X){var L=this,Z=W(X,this.get(G)),Y=this._queue,a=this.get(Q);this.stop();if(!a){return;}if(this.get(F)){Y.add({fn:function(){a.get("children").each(function(b){b.purge(true);});L.fire(R,a);}});}Y.add({fn:function(){a.setContent(Z.content);L.fire(D,a);}});Z.js.each(function(b){if(b&&b.get("src")){Y.add({fn:function(){B.Get.script(b.get("src"),{onFailure:function(c){},onEnd:function(c){c.purge();Y.run();}});},autoContinue:false});}else{Y.add({fn:function(){var f=b.get("ownerDocument"),e=f.one("head")||f.get("documentElement"),c=B.Node.create("<"+S+"></"+S+">");if(b._node.text){c._node.text=b._node.text;}e.appendChild(c);c.remove();b.remove();}});}});Y.add({fn:function(){L.fire(P);}});this._queue.run();},_fetch:function(X,L){this.stop();if(!X){return false;}L=L||{method:"GET"};L.on={start:function(){this._set(O,true);},success:function(Y,Z){this.set(E,Z.responseText);},failure:function(Y,Z){},end:function(){this._set(O,false);}};L.context=this;return(this._io=B.io(X,L));},stop:function(){this._queue.stop();if(this._io){this._io.abort();}return this;}},{EVENT_PREFIX:K,ATTRS:{node:{value:null,setter:function(L){this.stop();return B.one(L);}},autopurge:{value:true,validator:M},normalize:{value:false,validator:M},uri:{value:null,validator:function(L){return(L&&N(L)&&(L!==""));}},content:{value:"",validator:N},loading:{value:false,validator:M,readOnly:true,setter:function(L){if(L){this.fire(V);this.get(Q).addClass(C);}else{this.fire(U);this.get(Q).removeClass(C);}return L;}}}});},"gallery-2010.09.01-19-12",{requires:["base","node-base","io-base","get","async-queue","classnamemanager"]});