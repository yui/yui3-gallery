YUI.add("gallery-dispatcher",function(A){var G=A.ClassNameManager.getClassName,I="dispatcher",Q="script",S="fetch",P="purge",C="beforeExecute",R="load",N="ready",F="uri",D="content",E="autopurge",M="loading",O="node",B=G(I,"loading"),H=A.Lang,J=H.isBoolean,K=H.isString;function T(U){var L=A.Node.create("<div></div>"),V={};L.setContent(U);V.js=L.all(Q).each(function(W){W.get("parentNode").removeChild(W);});V.content=L.get("innerHTML");return V;}A.Dispatcher=A.Base.create(I,A.Base,[],{_queue:null,_io:null,initializer:function(L){L=L||{};this._queue=new A.AsyncQueue();this.after(D+"Change",function(U){this._dispatch(U.newVal);},this);this.after(F+"Change",function(U){this._fetch(U.newVal);},this);if(L[D]){this._dispatch(this.get(D));}if(L[F]){this._fetch(this.get(F));}},destructor:function(){this.stop();this._queue=null;this._io=null;},_dispatch:function(U){var L=this,W=T(U),V=this._queue,X=this.get(O);this.stop();if(!X){return;}if(this.get(E)){V.add({fn:function(){X.get("children").each(function(Y){Y.purge(true);});L.fire(P,X);}});}V.add({fn:function(){X.setContent(W.content);L.fire(C,X);}});W.js.each(function(Y){if(Y&&Y.get("src")){V.add({fn:function(){A.Get.script(Y.get("src"),{onFailure:function(Z){},onEnd:function(Z){Z.purge();V.run();}});},autoContinue:false});}else{V.add({fn:function(){var b=Y.get("ownerDocument"),a=b.one("head")||b.get("documentElement"),Z=A.Node.create("<"+Q+"></"+Q+">");if(Y._node.text){Z._node.text=Y._node.text;}a.appendChild(Z);Z.remove();Y.remove();}});}});V.add({fn:function(){L.fire(N);}});this._queue.run();},_fetch:function(U,L){this.stop();if(!U){return false;}L=L||{method:"GET"};L.on={start:function(){this._set(M,true);},success:function(V,W){this.set(D,W.responseText);},failure:function(V,W){},end:function(){this._set(M,false);}};L.context=this;return(this._io=A.io(U,L));},stop:function(){this._queue.stop();if(this._io){this._io.abort();}return this;}},{EVENT_PREFIX:I,ATTRS:{node:{value:null,setter:function(L){this.stop();return A.one(L);}},autopurge:{value:true,validator:J},uri:{value:null,validator:function(L){return(L&&K(L)&&(L!==""));}},content:{value:"",validator:K},loading:{value:false,validator:J,readOnly:true,setter:function(L){if(L){this.fire(S);this.get(O).addClass(B);}else{this.fire(R);this.get(O).removeClass(B);}return L;}}}});},"gallery-2010.08.18-17-12",{requires:["base","node-base","io-base","get","async-queue","classnamemanager"]});