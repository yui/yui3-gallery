YUI.add("gallery-matrix-background",function(a){function k(t){this.timer={};this.cell_on=[];k.superclass.constructor.call(this,t);}k.NAME="MatrixBackgroundPlugin";k.NS="matrix";k.ATTRS={charRange:{value:["\u30A1","\u30FA"],validator:function(t){return(a.Lang.isArray(t)&&t.length==2&&t[0].length==1&&t[1].length==1&&t[0]<t[1]);}},monospace:{value:false,validator:a.Lang.isBoolean},computeWidestChar:{value:false,validator:a.Lang.isBoolean},spinFraction:{value:0.2,validator:function(t){return(0<=t&&t<=1);}}};var o={spin:10,drop:80},p=3,l=300,s=800;function e(u,t){return u+Math.floor(Math.random()*(t-u));}function b(){var t=this.get("charRange");return[t[0].charCodeAt(0),t[1].charCodeAt(0)];}function j(t,u){return a.Node.getDOMNode(this.table).firstChild.childNodes[u].childNodes[t];}function c(t){g.call(this,t);this.timer[t]=a.later(o[t],this,function(){this.fire(t);},null,true);}function g(t){if(this.timer[t]){this.timer[t].cancel();delete this.timer[t];}}function h(){if(this.table){this.table.destroy();}var u=b.call(this),B=String.fromCharCode(u[0]);this.container.set("innerHTML","<table><tr><td>"+B+"</td></tr></table>");var G=this.container.one("table");if(this.get("computeWidestChar")){var t=u[0],A=G.totalWidth(),H=u[1],F=a.Node.getDOMNode(this.container).getElementsByTagName("td")[0];for(B=t+1;B<=H;B++){F.innerHTML=String.fromCharCode(B);var E=G.totalWidth();if(E>A){A=E;t=B;}}F.innerHTML=B=String.fromCharCode(t);}var E=Math.ceil(this.container.totalWidth()/G.totalWidth()),z=Math.ceil(this.container.totalHeight()/G.totalHeight());var J="<tr>";for(var D=0;D<E;D++){J+="<td>&nbsp;</td>";}J+="</tr>";var I="";for(var C=0;C<z;C++){I+=J;}I+="<tr>";for(var D=0;D<E;D++){I+="<td>"+B+"</td>";}I+="</tr>";G.setContent("<tbody>"+I+"</tbody>");this.table=G;this.row_count=z;this.col_count=E;this.drop_active=0;this.drop_col=[];for(var v=0;v<E;v++){this.drop_col.push({active:false});}c.call(this,"drop");f.call(this);c.call(this,"spin");}function f(){this.spin_count=Math.floor(this.col_count*this.get("spinFraction"));this.spin_active=0;this.spin=[];for(var t=0;t<this.spin_count;t++){this.spin.push({active:false});}}function r(t){var v=this.drop_col[t];v.active=true;v.y=Math.random()<0.5?e(0,this.row_count-p):0;if(Math.random()<0.5){v.y_max=v.y+e(p,this.row_count-v.y-1);}else{v.y_max=this.row_count-1;}if(Math.random()<0.2){v.c="&nbsp;";}else{var u=b.call(this);v.c=String.fromCharCode(e(u[0],u[1]+1));}}function i(){var x=this.col_count,u=b.call(this);for(var w=0;w<x;w++){var v=this.drop_col[w];if(v.active&&v.y>=v.y_max){v.active=false;this.drop_active--;}else{if(v.c!="&nbsp;"){v.c=String.fromCharCode(e(u[0],u[1]+1));}v.y++;}}if(this.drop_active<this.col_count){var t=0;do{var w=e(0,this.col_count);t++;}while(this.drop_col[w].active&&t<this.col_count);if(!this.drop_col[w].active){r.call(this,w);this.drop_active++;}}d.call(this);}function m(){if(this.spin_active<this.spin_count&&e(0,100)===0){var u=0;do{var w=e(0,this.spin_count);u++;}while(this.spin[w].active&&u<this.spin_count);if(!this.spin[w].active){var t=e(0,this.col_count),B=e(0,this.row_count);this.spin[w]={active:true,counter:e(l,s),cell:j.call(this,t,B)};this.spin_active++;}}var z=this.spin_count,v=b.call(this);for(var w=0;w<z;w++){var A=this.spin[w];if(A.active&&A.counter<=0){A.active=false;A.cell=null;this.spin_active--;}else{if(A.active){A.c=String.fromCharCode(e(v[0],v[1]+1));A.counter--;}}}d.call(this);}function d(){var w=this.cell_on.length;for(var v=0;v<w;v++){a.DOM.removeClass(this.cell_on[v],"on");}this.cell_on=[];var w=this.col_count;for(var v=0;v<w;v++){var u=this.drop_col[v];if(u.active){var t=j.call(this,v,u.y);a.DOM.addClass(t,"on");this.cell_on.push(t);t.innerHTML=u.c;}}var w=this.spin_count;for(var v=0;v<w;v++){var x=this.spin[v];if(x.active){a.DOM.addClass(x.cell,"on");this.cell_on.push(x.cell);x.cell.innerHTML=x.c;}}}function n(){if(this.get("monospace")){this.container.addClass("monospace");}else{this.container.removeClass("monospace");}}function q(){if(this.is_body){this.container.setStyles({width:a.DOM.winWidth()+"px",height:a.DOM.winHeight()+"px"});}else{var t=this.get("host");this.container.setStyles({width:t.getStyle("width"),height:t.getStyle("height")});}h.call(this);}a.extend(k,a.Plugin.Base,{initializer:function(t){var u=this.get("host");u.removeClass("yui3-matrixbkgd-loading");this.container=a.Node.create('<div class="yui3-matrixbkgd"></div>');u.append(this.container);n.call(this);this.after("charRangeChange",h);this.after("monospaceChange",n);this.after("spinFractionChange",f);this.on("drop",i);this.on("spin",m);if(u==a.one("body")){this.is_body=true;a.on("windowresize",q,u,this);}this.afterHostMethod("setStyle",function(v,w){if(v=="width"||v=="height"){q.call(this);}});this.afterHostMethod("setStyles",function(v){if(v.width||v.height){q.call(this);}});this.afterHostMethod("addClass",q);this.afterHostMethod("removeClass",q);this.afterHostMethod("replaceClass",q);q.call(this);},destructor:function(){g.call(this,"drop");g.call(this,"spin");if(this.table){this.table.destroy();}}});a.namespace("Plugin");a.Plugin.MatrixBackground=k;a.mix(a.Plugin.MatrixBackground,{rnd:e,startTimer:c,stopTimer:g,getCharacterRange:b});},"gallery-2012.06.13-20-30",{requires:["node-pluginhost","plugin","gallery-dimensions","node-screen","event-resize"],skinnable:true});