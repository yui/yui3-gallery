YUI.add("gallery-nav-assist",function(e,t){var n=e.namespace("Navigation-Assistant"),r="down:39+shift",i="down:37+shift",s="down:68+shift",o="down:69+shift",u="down:27",a=16,f=a,l=39,c=37,h=38,p=40,d="next",v="keydown",m=!0,g=!1,y="default-child-highlight",b="&#182;",w="nav-pointer",E="default-container-highlight",S=!1,x=!1,T=!1,N=.3,C=e.Easing.easeIn;n=function(){n.superclass.constructor.apply(this,arguments)},n.NAME="Navigation Assistant",n.ATTRS={activeRegistryIndex:{value:null},registry:{value:[]},debug:{value:null},styleContainer:{value:T},scrollAnim:{value:S},navPointer:{value:x},ignore:{value:null}},e.NAVASSIST=e.extend(n,e.Base,{container:{node:null,containerId:null,children:[],childIndexInFocus:-1,activeLink:null,isHorizontal:!1,pullToTop:!1},initializer:function(){function a(){t.deactivateRegisteredContainer()}var t=this,n=0,r,i;this.reorderRegistryByRank(),this.activateContainerNavigation(),e.one("body").on("key",function(){t.disableAllNavigation()},s),e.one("body").on("key",function(){t.enableAllNavigation()},o),e.one("body").on("key",function(){t.deactivateRegisteredContainer()},u);if(this.get("ignore")){i=this.get("ignore");if(e.Lang.isArray(i))for(n=0;n<i.length;n+=1)r=e.one(i[n]),r&&r.on("focus",a)}},enableAllNavigation:function(){this.activateContainerNavigation(),this.makeNextContainerNavigable(m)},disableAllNavigation:function(){this.deactivateRegisteredContainer(),this.deactivateContainerNavigation()},register:function(t){var n=t||{},r=n.node,i=this.get("registry");return e.one(r)&&(i[i.length]=n,this.reorderRegistryByRank()),this},deRegister:function(t){var n=t||{},r=n.node,i=this.get("registry"),s=e.one(r),o=null;return s&&(o=this.isNodeInRegistry(r),o!==null&&(i.splice(o,1),this.reorderRegistryByRank())),this},isNodeInRegistry:function(e){var t=0,n=this.get("registry"),r=n.length;for(t=0;t<r;t+=1)if(e===n[t].node)return t;return null},reorderRegistryByRank:function(){var e=this.get("registry"),t=e.length,n=[],r,i,s;for(s=0;s<t;s+=1)n[s]=null,e[s].rank===undefined&&(e[s].rank=null);for(s=0;s<t;s+=1)r=e[s].rank,r&&r>0&&r<=t&&(n[r-1]!==null?e[s].rank=null:n[r-1]=e[s]);i=0;for(s=0;s<t;s+=1){r=e[s].rank;if(r===null||r<=0||r>t){while(n[i]!==null)i+=1;n[i]=e[s],n[i].rank=i+1}}this.set("registry",n)},activateContainerNavigation:function(){var t=this,n=e.one("body");e.ContainerSubscr&&this.deactivateContainerNavigation(),e.ContainerSubscr={},e.ContainerSubscr.next=n.on("key",function(){t.makeNextContainerNavigable(m)},r),e.ContainerSubscr.prev=n.on("key",function(){t.makeNextContainerNavigable(g)},i),n.on("keyup",function(e){e.charCode===f&&(t._specialKeyDown=!1)}),n.on("keydown",function(e){e.charCode===f&&(t._specialKeyDown=!0)})},deactivateContainerNavigation:function(){var t,n=e.ContainerSubscr;if(n){for(t in n)n.hasOwnProperty(t)&&n[t].detach();delete e.ContainerSubscr}this.set("activeRegistryIndex",null)},makeNextContainerNavigable:function(t){var n=this.get("registry"),r,i,s,o,u=!1,a=!1;n.length>0&&(r=this.getNextRegistryIndex(t),r!==null&&n[r]&&(i=e.one(n[r].node),i?(u=n[r].isHorizontal||!1,a=n[r].pullToTop||!1,s=E,o=y,n[r].containerStyle&&(s=n[r].containerStyle.className||E),n[r].elemStyle&&(o=n[r].elemStyle.className||y),this.deactivateRegisteredContainer(),this.registerContainer(i,r+1,u,a,s,o),this.initiateNavigation()):this.deactivateRegisteredContainer()))},getNextRegistryIndex:function(t){var n=this.get("registry"),r,i=null,s=0;if(n&&n.length>0){for(s=0;s<n.length;s+=1){r=n.length,i=this.get("activeRegistryIndex"),i===null?i=0:(i=t?i+1:i-1,i>=r&&(i=0),i<0&&(i=r-1)),this.set("activeRegistryIndex",i);if(e.one(n[i].node))return i}return i}return null},registerContainer:function(e,t,n,r,i,s){e&&this.updateChildren(e,t,n,r,i,s)},updateChildren:function(e,t,n,r,i,s){var o=e.all("> *"),u=[],a=this.container;o.each(function(e,t){u[t]=e}),a.isHorizontal=n||!1,a.pullToTop=r||!1,a.rank=t,a.node=e,a.children=u,a.containerId=e.generateID(),a.containerClass=i,a.childClass=s},initiateNavigation:function(){this.activateRegisteredContainer()},deactivateRegisteredContainer:function(){this.killAllChildNavigationSubscription(),this.get("styleContainer")&&this.removeHighlightonContainer(),this.removeHighlightonCurrentChild(),this.resetContainer(),this.removeNavPointer()},removeHighlightonContainer:function(){var e=this.container,t;e&&e.node&&(t=this.container.containerClass||E,e.node.removeClass(t))},highlightContainer:function(){var e=this.container,t;e&&e.node&&(t=this.container.containerClass||E,e.node.addClass(t))},removeHighlightonCurrentChild:function(){var e=this.container,t=e.childIndexInFocus,n=e.childClass||y;t!==null&&t!==-1&&e.children[t].removeClass(n)},resetRegistryIndex:function(){this.set("activeRegistryIndex",null)},resetContainer:function(){this.container={rank:null,node:null,containerId:null,children:[],childIndexInFocus:-1,isHorizontal:!1,pullToTop:!1},this.wasLastChild=!1},killAllChildNavigationSubscription:function(){e.BodySubscr&&this.detachAllChildSubscriptions()},splash:function(t,n){var r='<h1 style="font-size:3em;color:#444;position:fixed;-webkit-transform: rotate(-10deg);" id="_splash">'+t+"</h1>",i,s,o,u=n||[0,0];i=e.one("#_splash"),s=e.one("body"),i&&i.remove(),o=e.DOM.create(r),s.append(o),i=e.one("#_splash").setXY(u).addClass("cramDownOpacity")},activateRegisteredContainer:function(){var t=this.container,n=this,r;t&&t.node&&(this.get("styleContainer")&&this.highlightContainer(),this.get("debug")&&(r=[200,200],this.splash("Container now navigable:"+t.node.generateID(),r))),e.BodySubscr={},e.BodySubscr.keydown=e.one("body").on(v,e.bind(this.navigateToNextChild,this)),e.BodySubscr.keyup=e.one("body").on(v,e.bind(this.navigateToPrevChild,this)),n.navigateToNextChild(d)},isKeyChildNavigator:function(e){return!e||e.charCode!==h&&e.charCode!==c&&e.charCode!==p&&e.charCode!==l?!1:!0},navigateToNextChild:function(t){var n=this.container,r,i;if(this.isKeyChildNavigator(t)&&this._specialKeyDown)return;if(n)if(n.isHorizontal){if(t.charCode===p)return}else if(t.charCode===
l)return;if(t===d||t.charCode===p||t.charCode===l)this.wasLastChild=!1,n&&(e.Lang.isObject(t)&&t.preventDefault(),r=n.childIndexInFocus,i=this.getNextIndex(r),n.childIndexInFocus=i,this.bringChildtoFocus(n.children[i]),this.get("navPointer")&&this.setNavPointer())},navigateToPrevChild:function(t){var n=this.container,r,i;if(this.isKeyChildNavigator(t)&&this._specialKeyDown)return;if(n)if(n.isHorizontal){if(t.charCode===h)return}else if(t.charCode===c)return;(t===d||t.charCode===h||t.charCode===c)&&n&&(e.Lang.isObject(t)&&t.preventDefault(),r=n.childIndexInFocus,i=this.getPreviousIndex(r),this.bringChildtoFocus(n.children[i]),n.childIndexInFocus=i,this.get("navPointer")&&this.setNavPointer())},detachAllChildSubscriptions:function(){var t=e.BodySubscr,n;if(t){for(n in t)t.hasOwnProperty(n)&&t[n].detach();delete e.BodySubscr}},removeNavPointer:function(){var t="."+w,n=e.one(t);n&&n.remove()},setNavPointer:function(){var t=this.container,n=t.childClass||y,r=e.one("."+n);this.removeNavPointer(),r&&r.prepend('<span class="'+w+'">'+b+"</span>")},destructor:function(){this.anim&&delete this.anim,this.disableAllNavigation()},getNextIndex:function(e){var t=this.container,n=t.children.length,r=t.childClass||y;return e!==-1&&t.children[e].removeClass(r),e===n-1?(e=-1,this.wasLastChild=!0):this.wasLastChild=!1,e+=1,e},getPreviousIndex:function(e){var t=this.container,n=t.children.length,r=t.childClass||y;return e>=0&&t.children[e]&&t.children[e].removeClass(r),e===0&&(e=n),e-=1,e<0&&(e=0),e},_scroll:function(t){this.get("scrollAnim")?(this.anim&&delete this.anim,this.anim=(new e.Anim({node:"window",from:{scroll:[e.DOM.docScrollX(),e.DOM.docScrollY()]},to:{scroll:[e.DOM.docScrollX(),t]},duration:N,easing:C})).run()):e.config.win.scroll(0,t)},scrollTo:function(t){var n=t.getY(),r=t.get("clientHeight"),i=r/2,s=t.get("winHeight"),o=s/2,u=0;return r>s&&(i=0),n>o&&(this.anim&&this.anim.get("running")&&this.anim.pause(),this.container&&this.container.pullToTop?u=n:u=n-o+i),e.DOM.inViewportRegion(e.Node.getDOMNode(t),!0,null)?null:u},bringChildtoFocus:function(e){var t=e,n=[],r=this.container,i=r.childClass||y,s;if(!e)return;t=e.all("a"),e.addClass(i).focus(),this.anim&&this.anim.get("running")&&this.anim.pause(),s=this.scrollTo(e),s&&this._scroll(s,e.getY),this.activeLink&&this.activeLink.blur(),t.each(function(e,t){n[t]=e}),n[0]&&(n[0].focus(),this.activeLink=n[0])}})},"@VERSION@",{requires:["node","event","event-key","gallery-event-nav-keys","base","anim"],skinnable:!1});
