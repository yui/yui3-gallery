YUI.add("gallery-plugin-simple-datatable-sort",function(B){var A={ASC:"asc",DESC:"desc",KEY:"key",DIRECTION:"direction"};B.Plugin.SDTSort=B.Base.create("simple-datatable-sort",B.Plugin.Base,[],{_host:null,_tHead:null,_sortCell:null,_newKey:false,_newSort:false,_delegate:null,initializer:function(){this._host=this.get("host");this._host.get("boundingBox").addClass(this._host.getClassName("sort"));this.afterHostMethod("setHeaders",this._updateTable);if(this._host.headersSet){this._updateTable();}this.afterHostEvent("render",this._setup);},destructor:function(){this._host.get("boundingBox").removeClass(this._host.getClassName("sort"));this._delegate.detach();},toggleSort:function(){this._toggleSort();return this;},sortBy:function(C){this.set(A.KEY,C);return this;},_setup:function(){this.publish("sort",{defaultFn:this._defSortFn});this.after(A.KEY+"Change",this._afterKeyChange);this.on(A.DIRECTION+"Change",this._onDirectionChange);this.after(A.DIRECTION+"Change",this._afterDirectionChange);this._delegate=this._tHead.delegate("click",function(C){this.fire("sort",{headerTarget:C.currentTarget});},'th:not([sortable="false"])',this);},_updateTable:function(){var G=this.get("ascClass"),D=this.get("descClass"),F=this.get(A.KEY),E=this.get(A.DIRECTION),H=this._host.get("rows"),C;this._tHead=this._host.get("contentBox").one("thead");this._tHead.all("th .yui3-simple-datatable-title").each(function(I){if(!I.one(".yui3-icon")){I.append('<span class="yui3-icon"></span>');}});if(this._newSort&&!this._newKey){this._reverseTable();}else{if(this._sortCell){C=Object.prototype.toString;Object.prototype.toString=function(){return this[F];};H.sort();Object.prototype.toString=C;if(E===A.DESC){H.reverse();}this._host.setRows(H);this._host.set("rows",H);}}if(this._sortCell){this._tHead.all("."+G).removeClass(G);this._tHead.all("."+D).removeClass(D);this._sortCell.addClass(this.get(E+"Class"));}},_reverseTable:function(){var D=this._host.get("contentBox").one("tbody"),E,C;this._host.set("row",this._host.get("rows").reverse());for(E=0,C=D.all("tr").size();E<C;E++){D.insert(D.one("tr:last-child").remove(),E);}},_defSortFn:function(D){var C=D.headerTarget.getAttribute(A.KEY);this._sortCell=D.headerTarget;if(this.get(A.KEY)!==C){this._newKey=true;this.set(A.KEY,C);}else{this._newKey=false;this._toggleSort();}},_afterKeyChange:function(C){if(this._sortCell.hasAttribute("defDirection")){this.set(A.DIRECTION,this._sortCell.getAttribute("defDirection"));}else{this.set(A.DIRECTION,A.ASC);}},_onDirectionChange:function(C){if(C.newVal===C.prevVal){this._newSort=false;this._updateTable();}else{this._newSort=true;}},_afterDirectionChange:function(C){this._updateTable();},_keySort:function(F,E,D,C){D=D[F];C=C[F];if(B.Lang.isString(D)){D=D.toLowerCase();C=C.toString().toLowerCase();}if(D==C){return 0;}if(D>C){return(E===A.DESC)?-1:1;}return(E===A.ASC)?-1:1;},_toggleSort:function(){this.set(A.DIRECTION,(this.get(A.DIRECTION)===A.ASC)?A.DESC:A.ASC);}},{NS:"sort",SORT:A,ATTRS:{ascClass:{value:"yui3-icon-control-s"},descClass:{value:"yui3-icon-control-n"},key:{validator:function(C){return(this.get("host").get("headers")[C])?true:false;}},direction:{setter:function(C){return(C===A.DESC)?A.DESC:A.ASC;}}}});},"gallery-2010.09.08-19-45",{requires:["plugin","event","selector-css3"]});