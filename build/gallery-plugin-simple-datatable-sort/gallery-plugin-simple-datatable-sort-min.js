YUI.add("gallery-plugin-simple-datatable-sort",function(b){var a={ASC:"asc",DESC:"desc",KEY:"key",DIRECTION:"direction"};b.Plugin.SDTSort=b.Base.create("sdt-sort",b.Plugin.Base,[],{_host:null,_tHead:null,_sortCell:null,_newKey:false,_newSort:false,_delegate:null,initializer:function(){this._host=this.get("host");this._host.get("boundingBox").addClass(this._host.getClassName("sort"));this.afterHostMethod("setHeaders",this._updateTable);if(this._host.headersSet){this._updateTable();}this.afterHostEvent("render",this._setup);},destructor:function(){this._host.get("boundingBox").removeClass(this._host.getClassName("sort"));this._delegate.detach();},toggleSort:function(){this._toggleSort();return this;},sortBy:function(c){this._sortCell=this._host.get("boundingBox").one("th.yui3-sdt-col-"+c);this._newKey=true;this.set(a.KEY,c);return this;},_setup:function(){this.publish("sort",{defaultFn:this._defSortFn});this.after(a.KEY+"Change",this._afterKeyChange);this.on(a.DIRECTION+"Change",this._onDirectionChange);this.after(a.DIRECTION+"Change",this._afterDirectionChange);this._delegate=this._tHead.delegate("click",function(c){this.fire("sort",{headerTarget:c.currentTarget});},'th:not([sortable="false"])',this);},_updateTable:function(){var g=this.get("ascClass"),d=this.get("descClass"),f=this.get(a.KEY),e=this.get(a.DIRECTION),h=this._host.get("rows"),c;this._tHead=this._host.get("contentBox").one("thead");this._tHead.all("th .yui3-sdt-liner").each(function(i){if(!i.one(".yui3-icon")){i.append('<span class="yui3-icon"></span>');}});if(this._newSort&&!this._newKey){this._reverseTable();}else{if(this._sortCell){c=Object.prototype.toString;Object.prototype.toString=function(){return this[f];};h.sort();Object.prototype.toString=c;if(e===a.DESC){h.reverse();}this._host.setRows(h);this._host.set("rows",h);}}if(this._sortCell){this._tHead.all("."+g).removeClass(g);this._tHead.all("."+d).removeClass(d);this._sortCell.addClass(this.get(e+"Class"));}},_reverseTable:function(){var d=this._host.get("contentBox").one("tbody"),e,c;this._host.set("row",this._host.get("rows").reverse());for(e=0,c=d.all("tr").size();e<c;e++){d.insert(d.one("tr:last-child").remove(),e);}},_defSortFn:function(d){var c=d.headerTarget.getAttribute(a.KEY);this._sortCell=d.headerTarget;if(this.get(a.KEY)!==c){this._newKey=true;this.set(a.KEY,c);}else{this._newKey=false;this._toggleSort();}},_afterKeyChange:function(c){if(this._sortCell.hasAttribute("defDirection")){this.set(a.DIRECTION,this._sortCell.getAttribute("defDirection"));}else{this.set(a.DIRECTION,a.ASC);}},_onDirectionChange:function(c){if(c.newVal===c.prevVal){this._newSort=false;this._updateTable();}else{this._newSort=true;}},_afterDirectionChange:function(c){this._updateTable();},_keySort:function(f,e,d,c){d=d[f];c=c[f];if(b.Lang.isString(d)){d=d.toLowerCase();c=c.toString().toLowerCase();}if(d==c){return 0;}if(d>c){return(e===a.DESC)?-1:1;}return(e===a.ASC)?-1:1;},_toggleSort:function(){this.set(a.DIRECTION,(this.get(a.DIRECTION)===a.ASC)?a.DESC:a.ASC);}},{NS:"sort",SORT:a,ATTRS:{ascClass:{value:"yui3-type-control-s"},descClass:{value:"yui3-type-control-n"},key:{validator:function(c){return(this.get("host").get("headers")[c])?true:false;}},direction:{setter:function(c){return(c===a.DESC)?a.DESC:a.ASC;}}}});},"gallery-2011.03.11-23-49",{requires:["plugin","event","selector-css3"]});