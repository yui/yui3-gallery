YUI.add("gallery-eventsource",function(f){var a=typeof EventSource!="undefined",b,e,d=500;function c(g){f.Event.Target.call(this);this.url=g;this.readyState=0;this._transport=null;this._init();}e={_fireErrorEvent:function(){f.later(0,this,function(){this.readyState=2;this.fire({type:"error"});});},_fireOpenEvent:function(){if(this.readyState<2){f.later(0,this,function(){this.readyState=1;this.fire({type:"open"});});}},_fireMessageEvent:function(g){f.later(0,this,function(){this.fire(g);});}};if(a){b={_init:function(){try{var i=new EventSource(this.url),h=this;i.onopen=i.onmessage=i.onerror=f.bind(function(j){switch(j.type){case"open":this._fireOpenEvent();break;case"message":this._fireMessageEvent({type:"message",data:j.data,lastEventId:j.lastEventId,origin:j.origin});break;case"error":this._fireErrorEvent();break;}},this);this._transport=i;}catch(g){this._fireErrorEvent();}},close:function(){if(this._transport!=null){this._transport.close();}this.readyState=2;},on:function(k,j,i,h,g){var l=this;if(k!="message"&&k!="error"&&k!="open"){this._transport.addEventListener(k,function(m){l._fireMessageEvent({type:m.type,data:m.data,origin:m.origin,lastEventId:m.lastEventId});},false);}f.Event.Target.prototype.on.apply(this,arguments);}};}else{b={_init:function(){this._lastIndex=0;this._lastEventId=null;this._data="";this._eventName="";var h,g=this;if(this.readyState!=2){if(typeof XMLHttpRequest!="undefined"){h=new XMLHttpRequest();}else{if(typeof ActiveXObject!="undefined"){h=new ActiveXObject("MSXML2.XMLHttp");}else{throw new Error("Server-sent events unavailable.");}}h.open("get",this.url,true);if(this._lastEventId){h.setRequestHeader("Last-Event-ID",this._lastEventId);}if(f.UA.ie){h.setRequestHeader("X-YUIEventSource-PollOnly","1");}h.onreadystatechange=function(){if(h.readyState==3&&f.UA.ie===0){if(h.getResponseHeader("Content-type")!="text/event-stream"){g.close();g._fireErrorEvent();}else{g._signalOpen();g._processIncomingData(h.responseText);}}else{if(h.readyState==4&&g.readyState<2){g._signalOpen();g._fireMessageEvent();g._validateResponse();}}};this._transport=h;h.send(null);}},_validateResponse:function(){var h=this._transport;try{if(h.status>=200&&h.status<300){this._processIncomingData(h.responseText);if(this.readyState!=2){this._transport.onreadystatechange=function(){};f.later(d,this,this._init);}}else{throw new Error();}}catch(g){this._fireErrorEvent();}h=null;},_signalOpen:function(){if(this.readyState==0){this._fireOpenEvent();}},_processDataLine:function(g,i,h){var j;switch(g){case"data":j=i+"\n";if(j.charAt(0)==" "){j=j.substring(1);}this._data+=j;break;case"event":this._eventName=i.replace(/^\s+|\s+$/g,"");break;case"":break;case"id":this._lastEventId=i;break;case"retry":break;default:if(!h){this._processDataLine(g,"",true);}}},_processIncomingData:function(m){m=m.substring(this._lastIndex);this._lastIndex+=m.length;var h=m.split("\n"),l,j=0,g=h.length,k;while(j<g){if(h[j].indexOf(":")>-1){l=h[j].split(":");this._processDataLine(l.shift(),l.join(":"));}else{if(h[j].replace(/\s/g,"")==""){this._fireMessageEvent();}}j++;}this._fireMessageEvent();},_fireMessageEvent:function(){var h="message",i,g;if(this._data!=""){if(this._data.charAt(this._data.length-1)=="\n"){this._data=this._data.substring(0,this._data.length-1);}if(this._eventName.replace(/^\s+|\s+$/g,"")!=""){h=this._eventName;}i=this._data;g=this._lastEventId;f.later(0,this,function(){this.fire({type:h,data:i,lastEventId:g});});this._data="";this._eventName="";}},close:function(){if(this.readyState!=2){this.readyState=2;if(this._transport){this._transport.abort();}}}};}f.extend(c,f.Event.Target,f.merge(e,b));f.EventSource=c;},"gallery-2010.11.17-21-32",{requires:["event-base","event-custom"]});