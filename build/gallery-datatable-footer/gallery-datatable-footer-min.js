YUI.add("gallery-datatable-footer",function(a){var r=a.Node,b=a.Lang,m=a.Node.create,q=a.UA,s=1000000000000000,e="datatable",t="host",f="heading",d="col_keys",p="recordset",l="columnset",i="dtFooter",c=a.ClassNameManager.getClassName,n=c(e,"hd"),g=c(e,"liner"),h=c(e,"ft"),o='<div class="'+h+'"></div>';function k(u){k.superclass.constructor.apply(this,arguments);}a.mix(k,{NAME:"dataTableFooter",NS:"footer",ATTRS:{heading:{value:{colspan:1,label:"",className:""}},col_keys:{value:[],validator:b.isArray},fixed:{value:false,validator:b.isBoolean},dateFormat:{value:"%D",validator:b.isString},timeFormat:{value:"%T",validator:b.isString}}});a.extend(k,a.Plugin.Base,{_tfootContainer:null,_tfootNode:null,_tfootTrNode:null,_tfootThNode:null,initializer:function(){this.afterHostMethod("renderUI",this.renderPluginUI);this.afterHostMethod("bindUI",this.bindPluginUI);this.afterHostMethod("syncUI",this.syncPluginUI);},refreshFooter:function(){var w=this.get(t),v=w.get(l).keys,G=w.get(p),y=this.get(f),z=this.get(d),H=this._tfootNode.all("td");if(y.label){this._tfootThNode.one("div").setContent(this._doRecordSetMath(null,y.label));}for(j=0;j<z.length;j++){var u=z[j].key,D=null,F=null;var x=this._rtnColumnSetKeyIndex(v,u);if(x!==false){var B=x-this.get("heading.colspan");if(B>=0){D=H.item(B);F=D.one("div");var C=parseFloat(this._doRecordSetMath(z[j])),E=null;var A=z[j].formatter||v[x].get("formatter")||null;if(a.Lang.isFunction(A)){E=A.call(this,{value:C,record:{},column:v[j],tr:null,headers:null,classnames:null});}else{E=C;}if(F){F.setContent(E);}}}}},renderPluginUI:function(){this._buildFooterNodes();},bindPluginUI:function(){this.afterHostEvent("recordsetChange",this.syncPluginUI);this.afterHostEvent("recordset:recordsChange",this.syncPluginUI);this.afterHostEvent("recordset:update",this.syncPluginUI);},syncPluginUI:function(){this.refreshFooter();if(this.get(t).hasPlugin("scroll")&&this.get("fixed")){this._syncFooterWidths();}},_buildFooterNodes:function(){var w=this.get(t),v=w.get(l).keys,x=this.get(f),y=this.get(d),B=w._tableNode;if(!this.get(t).hasPlugin("scroll")&&this.get("fixed")){this.set("fixed",false);}if(this.get("fixed")){this._tfootContainer=w.get("contentBox").appendChild(m(o));B=this._tfootContainer.appendChild("<table/>");}this._tfootNode=B.appendChild(m("<tfoot/>"));this._tfootTrNode=this._tfootNode.appendChild(m("<tr/>"));this._tfootThNode=this._tfootTrNode.appendChild(m("<th/>"));tfdiv=this._tfootThNode.appendChild("<div/>");tfdiv.addClass(g);if(x.colspan){this._tfootThNode.setAttribute("colSpan",x.colspan);}if(x.className){tfdiv.addClass(x.className);}var z=(x.colspan)?x.colspan:0;for(;z<v.length;z++){var u=v[z].get("key");var C=this._tfootTrNode.appendChild(m("<td/>"));var D=C.appendChild(m("<div/>"));D.addClass(g);var A=this._indexOfObj(y,"key",u);if(A!==false){if(y[A].className){D.addClass(y[A].className);}}}return this._tfootNode;},_doRecordSetMath:function(x,y){var F=null;var w=this.get(t),v=w.get(l).keys,H=w.get(p);if(!x&&y){F=a.substitute(y,{ROW_COUNT:H.getLength(),COL_COUNT:v.length,DATE:a.DataType.Date.format(new Date(),{format:this.get("dateFormat")}),TIME:a.DataType.Date.format(new Date(),{format:this.get("timeFormat")})});}if(a.Lang.isObject(x)){var u=x.key,B=x.calc.toUpperCase(),G=0,I=-s,E=s,A=0;for(var C=0;C<H.getLength();C++){var z=H.getRecord(C),D=z.getValue();switch(B){case"{SUM}":case"{MEAN}":case"{AVG}":case"{AVERAGE}":G+=D[u];if(D[u]!==null){A++;}break;case"{MIN}":E=Math.min(E,D[u]);break;case"{MAX}":I=Math.max(I,D[u]);break;}}F=a.substitute(B,{SUM:G,MEAN:A>0?G/A:"#",AVG:A>0?G/A:"#",AVERAGE:A>0?G/A:"#",MIN:E,MAX:I,ROW_COUNT:H.getLength(),COL_COUNT:v.length,DATE:a.DataType.Date.format(new Date(),{format:this.get("dateFormat")}),TIME:a.DataType.Date.format(new Date(),{format:this.get("timeFormat")})});}return F;},_rtnColumnSetKeyIndex:function(v,u){for(var w=0;w<v.length;w++){if(v[w].get("key")===u){return w;}}return false;},_indexOfObj:function(u,x,v){for(var w=0;w<u.length;w++){if(u[w][x]===v){return w;}}return false;},_syncFooterWidths:function(){var w=this.get(t),y=w.get("contentBox").one("."+n),z=y.one("tr").all("."+g),C=this._tfootTrNode.all("."+g),D=(q.ie)?"offsetWidth":"clientWidth",E=null,u=0,x=this.get("heading.colspan");if(z&&z.size()){u=0;for(var A=0;A<x;A++){u+=z.item(A).get(D);}E=C.item(0);u-=(parseInt(E.getComputedStyle("paddingLeft"),10)|0)+(parseInt(E.getComputedStyle("paddingRight"),10)|0);var v=1;u+=v*(x-1);E.setStyle("width",u+"px");var A=x;for(;A<z.size();A++){u=z.item(A).get(D);var B=A-x+1;E=C.item(B);u-=(parseInt(E.getComputedStyle("paddingLeft"),10)|0)+(parseInt(E.getComputedStyle("paddingRight"),10)|0);C.item(B).setStyle("width",u+"px");}}}});a.namespace("Plugin");a.Plugin.DataTableFooter=k;},"gallery-2012.01.11-21-03",{skinnable:true,requires:["datatable-base","datatype","plugin"]});