YUI.add("gallery-aui-autocomplete",function(l){var Y=l.Lang,u=Y.isArray,i=Y.isString,N=Y.isNull,n=Y.isFunction,X=l.ClassNameManager.getClassName,J="alert",H="content",P="helper",Q="hidden",C="icon",V="item",K="list",q="loading",F="autocomplete",R="reset",T="results",z="selected",r="circle-triangle-b",I=J,c=q,b=X(F,z),S=X(P,Q),g=X(F,K,V),O=X(P,R),a=X(F,T),t=X(F,T,H),p=8,M=9,D=13,j=16,d=17,e=18,o=20,E=27,h=33,k=35,x=36,L=38,w=40,v=39,s=37,G=44,W=44,f=229,y={node:null,points:["tl","bl"]},U="boundingBox",B="contentBox";var m=l.Component.create({NAME:F,ATTRS:{alwaysShowContainer:{value:false},autoHighlight:{value:true},applyLocalFilter:{value:null},button:{value:true},dataSource:{value:null},dataSourceType:{value:null},delimChar:{value:null,setter:function(A){if(i(A)&&(A.length>0)){A=[A];}else{if(!u(A)){A=l.Attribute.INVALID_VALUE;}}return A;}},forceSelection:{value:false},input:{value:null},matchKey:{value:0},maxResultsDisplayed:{value:10},minQueryLength:{value:1},queryDelay:{value:0.2,getter:function(A){return A*1000;}},queryInterval:{value:0.5,getter:function(A){return A*1000;}},queryMatchCase:{value:false},queryMatchContains:{value:false},queryQuestionMark:{value:true},schema:{value:null},schemaType:{value:"",validator:i},suppressInputUpdate:{value:false},typeAhead:{value:false},typeAheadDelay:{value:0.2,getter:function(A){return A*1000;}},uniqueName:{value:null}},prototype:{initializer:function(Z){var A=this;A._overlayAlign=l.mix({},y);A._createDataSource();},renderUI:function(){var A=this;A._renderInput();A._renderOverlay();},bindUI:function(){var A=this;var Z=A.button;var aa=A.inputNode;A.dataSource.on("request",l.bind(Z.set,Z,C,c));aa.on("blur",A._onTextboxBlur,A);aa.on("focus",A._onTextboxFocus,A);aa.on("keydown",A._onTextboxKeyDown,A);aa.on("keypress",A._onTextboxKeyPress,A);aa.on("keyup",A._onTextboxKeyUp,A);var ab=A.overlay.get(U);ab.on("click",A._onContainerClick,A);ab.on("mouseout",A._onContainerMouseout,A);ab.on("mouseover",A._onContainerMouseover,A);ab.on("scroll",A._onContainerScroll,A);A.publish("containerCollapse");A.publish("containerExpand");A.publish("containerPopulate");A.publish("dataError");A.publish("dataRequest");A.publish("dataReturn");A.publish("itemArrowFrom");A.publish("itemArrowTo");A.publish("itemMouseOut");A.publish("itemMouseOver");A.publish("itemSelect");A.publish("selectionEnforce");A.publish("textboxBlur");A.publish("textboxChange");A.publish("textboxFocus");A.publish("textboxKey");A.publish("typeAhead");A.publish("unmatchedItemSelect");A.overlay.after("visibleChange",A._realignContainer,A);},syncUI:function(){var A=this;A.inputNode.setAttribute("autocomplete","off");},destructor:function(){var A=this;A.overlay.destroy();},doBeforeExpandContainer:function(){return true;},doBeforeLoadData:function(A){return true;},filterResults:function(aj){var ap=this;var aa=aj.callback;var ab=aj.request;var Z=aj.response;if(aa&&aa.argument&&aa.argument.query){ab=aa.argument.query;}if(ab){var ao=ap.dataSource;var al=Z.results;var A=[];var ad=false;var ac=ap.get("matchKey");var am=ap.get("queryMatchCase");var ah=ap.get("queryMatchContains");var ag=(ab=="*");var ai=ap.get("schema.resultFields");for(var ak=al.length-1;ak>=0;ak--){var af=al[ak];var an=null;if(i(af)){an=af;}else{if(u(af)){an=af[0];}else{if(ai){an=af[ac||ai[0]];}}}if(i(an)){var ae=-1;if(am){ae=an.indexOf(decodeURIComponent(ab));}else{ae=an.toLowerCase().indexOf(decodeURIComponent(ab).toLowerCase());}if((ag)||(!ah&&(ae===0))||(ah&&(ae>-1))){A.unshift(af);}}}Z.results=A;}return Z;},formatResult:function(Z,aa,A){return A||"";},generateRequest:function(A){return{request:A};},handleResponse:function(aa){var Z=this;Z._populateList(aa);var A=r;if(aa.error){A=I;}Z.button.set(C,A);},sendQuery:function(Z){var A=this;A.set("focused",null);var aa=Z;if(A.get("delimChar")){Z=A.inputNode.get("value")+Z;}A._sendQuery(aa);},_clearInterval:function(){var A=this;if(A._queryIntervalId){clearInterval(A._queryIntervalId);A._queryIntervalId=null;}},_clearSelection:function(){var Z=this;var aa=Z.get("delimChar");var A={previous:"",query:Z.inputNode.get("value")};if(aa){A=Z._extractQuery(Z.inputNode.get("value"));}Z.fire("selectionEnforce",A.query);},_createDataSource:function(){var A=this;A._queryTask=new l.DelayedTask(A.sendQuery,A);var ae=A.get("dataSource");var ac=ae;var ad=A.get("dataSourceType");if(!(ae instanceof l.DataSource.Local)){if(!ad){ad="Local";if(n(ac)){ad="Function";}else{if(i(ac)){ad="IO";}}}ae=new l.DataSource[ad]({source:ac});}ae.on("error",A.handleResponse,A);ae.after("response",A.handleResponse,A);ad=ae.name;if(ad=="dataSourceLocal"){A.set("applyLocalFilter",true);}A.set("dataSource",ae);A.set("dataSource",ad);A.dataSource=ae;var ab=A.get("schema");if(ab){if(ab.fn){A.dataSource.plug(ab);}else{var Z=A.get("schemaType");var aa={array:l.Plugin.DataSourceArraySchema,json:l.Plugin.DataSourceJSONSchema,text:l.Plugin.DataSourceTextSchema,xml:l.Plugin.DataSourceXMLSchema};Z=Z.toLowerCase()||"array";A.dataSource.plug({fn:aa[Z],cfg:{schema:ab}});}}A.set("schema",ab);},_enableIntervalDetection:function(){var A=this;var Z=A.get("queryInterval");if(!A._queryIntervalId&&Z){A._queryInterval=setInterval(l.bind(A._onInterval,A),Z);}},_extractQuery:function(ac){var ag=this;var ae=ag.get("delimChar");var A=-1;var aa=ae.length-1;var af,ad,ab;for(;aa>=0;aa--){af=ac.lastIndexOf(ae[aa]);if(af>A){A=af;}}if(ae[aa]==" "){for(var Z=ae.length-1;Z>=0;Z--){if(ac[A-1]==ae[Z]){A--;break;}}}if(A>-1){ad=A+1;while(ac.charAt(ad)==" "){ad+=1;}ab=ac.substring(0,ad);ac=ac.substring(ad);}else{ab="";}return{previous:ab,query:ac};},_focus:function(){var A=this;setTimeout(function(){A.inputNode.focus();},0);},_isIgnoreKey:function(Z){var A=this;if((Z==M)||(Z==D)||(Z==j)||(Z==d)||(Z>=e&&Z<=o)||(Z==E)||(Z>=h&&Z<=k)||(Z>=x&&Z<=w)||(Z>=G&&Z<=W)||(Z==f)){return true;}return false;},_jumpSelection:function(){var A=this;if(A._elCurListItem){A._selectItem(A._elCurListItem);}else{A._toggleContainer(false);}},_moveSelection:function(al){var ai=this;if(ai.overlay.get("visible")){var am=ai._elCurListItem;
var Z=-1;if(am){Z=Number(am.getAttribute("data-listItemIndex"));}var aa=Z-1;if(al==w){aa=Z+1;}if(aa==-1){aa=ai._displayedItems-1;}if(aa>=ai._displayedItems){aa=0;}if(aa<-2){return;}if(am){ai._toggleHighlight(am,"from");ai.fire("itemArrowFrom",am);}if(aa==-1){if(ai.get("delimChar")){ai.inputNode.set("value",ai._pastSelections+ai._currentQuery);}else{ai.inputNode.set("value",ai._currentQuery);}return;}if(aa==-2){ai._toggleContainer(false);return;}var ae=ai.resultList.get("childNodes").item(aa);var ac=ai.overlay.get(B);var ag=ac.getStyle("overflow");var aj=ac.getStyle("overflowY");var ab=(ag=="auto")||(ag=="scroll")||(aj=="auto")||(aj=="scroll");if(ab&&(aa>-1)&&(aa<ai._displayedItems)){var A=-1;var an=ae.get("offsetTop");var ad=an+ae.get("offsetHeight");var ah=ac.get("offsetHeight");var af=ac.get("scrollTop");var ak=ah+af;if(al==w){if(ad>ak){A=(ad-ah);}else{if(ad<af){A=an;}}}else{if(an<ah){A=an;}else{if(an>ak){A=(ad-ah);}}}if(A>-1){ac.set("scrollTop",A);}}ai._toggleHighlight(ae,"to");ai.fire("itemArrowTo",ae);if(ai.get("typeAhead")){ai._updateValue(ae);}}},_onButtonMouseDown:function(Z){var A=this;Z.halt();A._focus();A._sendQuery(A.inputNode.get("value")+"*");},_onContainerClick:function(aa){var A=this;var ab=aa.target;var Z=ab.get("nodeName").toLowerCase();aa.halt();while(ab&&(Z!="table")){switch(Z){case"body":return;case"li":A._toggleHighlight(ab,"to");A._selectItem(ab);return;default:break;}ab=ab.get("parentNode");if(ab){Z.get("nodeName").toLowerCase();}}},_onContainerMouseout:function(aa){var A=this;var ab=aa.target;var Z=ab.get("nodeName").toLowerCase();while(ab&&(Z!="table")){switch(Z){case"body":return;case"li":A._toggleHighlight(ab,"from");A.fire("itemMouseOut",ab);break;case"ul":A._toggleHighlight(A._elCurListItem,"to");break;case"div":if(ab.hasClass(a)){A._overContainer=false;return;}break;default:break;}ab=ab.get("parentNode");if(ab){Z=ab.get("nodeName").toLowerCase();}}},_onContainerMouseover:function(aa){var A=this;var ab=aa.target;var Z=ab.get("nodeName").toLowerCase();while(ab&&(Z!="table")){switch(Z){case"body":return;case"li":A._toggleHighlight(ab,"to");A.fire("itemMouseOut",ab);break;case"div":if(ab.hasClass(a)){A._overContainer=true;return;}break;default:break;}ab=ab.get("parentNode");if(ab){Z=ab.get("nodeName").toLowerCase();}}},_onContainerScroll:function(Z){var A=this;A._focus();},_onInterval:function(){var A=this;var aa=A.inputNode.get("value");var Z=A._lastValue;if(aa!=Z){A._lastValue=aa;A._sendQuery(aa);}},_onTextboxBlur:function(ab){var A=this;if(!A._overContainer||(A._keyCode==M)){if(!A._itemSelected){var aa=A._textMatchesOption();var Z=A.overlay.get("visible");if(!Z||(Z&&N(aa))){if(A.get("forceSelection")){A._clearSelection();}else{A.fire("unmatchedItemSelect",A._currentQuery);}}else{if(A.get("forceSelection")){A._selectItem(aa);}}}A._clearInterval();A.blur();if(A._initInputValue!==A.inputNode.get("value")){A.fire("textboxChange");}A.fire("textboxBlur");A._toggleContainer(false);}else{A._focus();}},_onTextboxFocus:function(Z){var A=this;if(!A.get("focused")){A.inputNode.setAttribute("autocomplete","off");A.focus();A._initInputValue=A.inputNode.get("value");A.fire("textboxFocus");}},_onTextboxKeyDown:function(Z){var A=this;var aa=Z.keyCode;if(A._typeAheadDelayId!=-1){clearTimeout(A._typeAheadDelayId);}switch(aa){case M:if(A._elCurListItem){if(A.get("delimChar")&&A._keyCode!=aa){if(A.overlay.get("visible")){Z.halt();}}A._selectItem(A._elCurListItem);}else{A._toggleContainer(false);}break;case D:if(A._elCurListItem){if(A._keyCode!=aa){if(A.overlay.get("visible")){Z.halt();}}A._selectItem(A._elCurListItem);}else{A._toggleContainer(false);}break;case E:A._toggleContainer(false);return;case L:if(A.overlay.get("visible")){Z.halt();A._moveSelection(aa);}break;case v:A._jumpSelection();break;case w:if(A.overlay.get("visible")){Z.halt();A._moveSelection(aa);}break;default:A._itemSelected=false;A._toggleHighlight(A._elCurListItem,"from");A.fire("textboxKey",aa);break;}if(aa==e){A._enableIntervalDetection();}A._keyCode=aa;},_onTextboxKeyPress:function(Z){var A=this;var aa=Z.keyCode;switch(aa){case M:if(A.overlay.get("visible")){if(A.get("delimChar")){Z.halt();}if(A._elCurListItem){A._selectItem(A._elCurListItem);}else{A._toggleContainer(false);}}break;case 13:if(A.overlay.get("visible")){Z.halt();if(A._elCurListItem){A._selectItem(A._elCurListItem);}else{A._toggleContainer(false);}}break;default:break;}if(aa==f){A._enableIntervalDetection();}},_onTextboxKeyUp:function(aa){var A=this;var Z=A.inputNode;var ab=Z.get("value");var ac=aa.keyCode;if(A._isIgnoreKey(ac)){return;}A._queryTask.delay(A.get("queryDelay"),null,null,[ab]);},_populateList:function(A){var aj=this;if(aj._typeAheadDelayId!=-1){clearTimeout(aj._typeAheadDelayId);}var ae=A.request;var ac=A.response;var am=A.callback;var ab=(ae=="*");if(am&&am.argument&&am.argument.query){A.request=ae=am.argument.query;}var ah=aj.doBeforeLoadData(A);if(ah&&!A.error){aj.fire("dataReturn",A);var ag=aj.get("focused");if(ab||ag||ag===null){var af=decodeURIComponent(ae);aj._currentQuery=af;aj._itemSelected=false;var aa=A.response.results;var al=Math.min(aa.length,aj.get("maxResultsDisplayed"));var ad=aj.get("schema.resultFields");var ak=aj.get("matchKey");if(!ak&&ad){ak=ad[0];}else{ak=ak||0;}if(al>0){var ai=aj.resultList.get("childNodes");ai.each(function(ar,aq,ap){if(aq<al){var ao=aa[aq];var an="";if(i(ao)){an=ao;}else{if(u(ao)){an=ao[0];}else{an=ao[ak];}}ar._resultMatch=an;ar._resultData=ao;ar.html(aj.formatResult(ao,af,an));ar.removeClass(S);}else{ar.addClass(S);}});aj._displayedItems=al;aj.fire("containerPopulate",ae,aa);if(ae!="*"&&aj.get("autoHighlight")){var Z=aj.resultList.get("firstChild");aj._toggleHighlight(Z,"to");aj.fire("itemArrowTo",Z);aj._typeAhead(Z,ae);}else{aj._toggleHighlight(aj._elCurListItem,"from");}ah=aj.doBeforeExpandContainer(ae,aa);aj._toggleContainer(ah);}else{aj._toggleContainer(false);}return;}}else{aj.fire("dataError",ae);}},_realignContainer:function(Z){var A=this;var aa=A._overlayAlign;if(Z.newVal){A.overlay._uiSetAlign(aa.node,aa.points);
}},_renderInput:function(){var Z=this;var aa=Z.get(B);var ab=Z.get("input");var ad={field:{labelText:false},icons:[{icon:"circle-triangle-b",id:"trigger",handler:{fn:Z._onButtonMouseDown,context:Z}}]};var ac=null;var A=null;if(ab){ab=l.one(ab);ad.field.node=ab;ac=ab.next();A=ab.get("parentNode");}var ae=new l.Combobox(ad).render(aa);if(A){var af=ae.get("boundingBox");A.insertBefore(af,ac);}Z.inputNode=ae.get("node");Z.button=ae.icons.item("trigger");Z.set("uniqueName",l.stamp(Z.inputNode));},_renderListElements:function(){var A=this;var ab=A.get("maxResultsDisplayed");var Z=A.resultList;var aa=[];while(ab--){aa[ab]='<li class="'+S+" "+g+'" data-listItemIndex="'+ab+'"></li>';}Z.html(aa.join(""));},_renderOverlay:function(){var A=this;var ab=A._overlayAlign;ab.node=A.inputNode;var aa=new l.OverlayBase({align:ab,bodyContent:"<ul></ul>",visible:false,width:A.inputNode.get("offsetWidth")});var Z=aa.get(B);aa.get(U).addClass(a);Z.addClass(t);aa.render(document.body);aa.addTarget(A);A.overlay=aa;A.resultList=Z.one("ul");A.resultList.addClass(O);A._renderListElements();},_selectItem:function(Z){var A=this;A._itemSelected=true;A._updateValue(Z);A._pastSelections=A.inputNode.get("value");A._clearInterval();A.fire("itemSelect",Z,Z._resultData);A._toggleContainer(false);},_sendQuery:function(ad){var Z=this;if(Z.get("disabled")){Z._toggleContainer(false);return;}var ab=Z.get("delimChar");var aa=Z.get("minQueryLength");if(ab){var A=Z._extractQuery(ad);ad=A.query;Z._pastSelections=A.previous;}if((ad&&(ad.length<aa))||(!ad&&aa>0)){Z._queryTask.cancel();Z._toggleContainer(false);return;}ad=encodeURIComponent(ad);if(Z.get("applyLocalFilter")){Z.dataSource.on("response",Z.filterResults,Z);}var ac=Z.generateRequest(ad);Z.fire("dataRequest",ad,ac);Z.dataSource.sendRequest(ac);},_textMatchesOption:function(){var A=this;var Z=null;var ad=A._displayedItems;var ae=A.resultList.get("childNodes");for(var ab=0;ab<ad.length;ab++){var ac=ae.item(ab);var aa=(""+ac._resultMatch).toLowerCase();if(aa==A._currentQuery.toLowerCase()){Z=ac;break;}}return Z;},_toggleContainer:function(Z){var A=this;var aa=A.overlay;if(A.get("alwaysShowContainer")&&aa.get("visible")){return;}if(!Z){A._toggleHighlight(A._elCurListItem,"from");A._displayedItems=0;A._currentQuery=null;}if(Z){aa.show();A.fire("containerExpand");}else{aa.hide();A.fire("containerCollapse");}},_toggleHighlight:function(Z,aa){var A=this;if(Z){if(A._elCurListItem){A._elCurListItem.removeClass(b);A._elCurListItem=null;}if(aa=="to"){Z.addClass(b);A._elCurListItem=Z;}}},_typeAhead:function(Z,aa){var A=this;if(!A.get("typeAhead")||A._keyCode==p){return;}var ab=l.Node.getDOMNode(A.inputNode);if(ab.setSelectionRange||ab.createTextRange){A._typeAheadDelayId=setTimeout(function(){var ae=ab.value;var af=ae.length;A._updateValue(Z);var ac=ab.value.length;A.inputNode.selectText(af,ac);var ad=ab.value.substr(af,ac);A.fire("typeAhead",aa,ad);},A.get("typeAheadDelay"));}},_updateValue:function(ad){var Z=this;if(!Z.get("suppressInputUpdate")){var ac=Z.inputNode;var A=ad._resultMatch;var ab=Z.get("delimChar");ab=(ab&&ab[0])||ab;var ae="";if(ab){ae=Z._pastSelections;ae+=A+ab;if(ab!=" "){ae+=" ";}}else{ae=A;}ac.set("value",ae);if(ac.get("type")=="textarea"){ac.set("scrollTop",ac.get("scrollHeight"));}var aa=ae.length;ac.selectText(aa,aa);Z._elCurListItem=ad;}},_currentQuery:null,_displayedItems:0,_elCurListItem:null,_initInputValue:null,_itemSelected:false,_keyCode:null,_lastValue:null,_overContainer:false,_pastSelections:"",_typeAheadDelayId:-1}});l.AutoComplete=m;},"gallery-2011.02.09-21-32",{requires:["gallery-aui-base","gallery-aui-overlay-base","datasource","dataschema","gallery-aui-form-combobox"],skinnable:true});