YUI.add("gallery-jute",function(g){var e=g.namespace("UnitTest"),d,c,b,a,f;e.heartBeat=function(){var h={method:"GET",on:{success:function(t,k){var m,p,l,s,o,n,r,j,u=0;try{m=g.JSON.parse(k.responseText);if(typeof(m.redirect_run_tests)==="string"){g.one("#run_tests").setAttribute("src",m.redirect_run_tests);}else{p=m.current_status;l=m.current_results;s='<h4 style="background-color="yellow" align="center">Status</h4><ul><li>Browsers</li><font size="-1"><ul>';g.each(p.browsers,function(w,v,i){s+="<li>"+w.name+"</li>";s+="<ul><li>heart beat&nbsp;"+w.heart_beat+"</li>";s+="<li>get test&nbsp;"+w.get_test+"</li></ul>";});s+="</ul></font>";s+='<li>Tests</li><font size="-1"><ul>';for(n=0;n<p.tests_to_run.length;n=n+1){r=p.tests_to_run[n];j="";if(r.running>0){j='style="background-color:yellow"';}s+="<li>Test</li><ul>";s+="<li "+j+">Test:    "+r.url+"</li>";s+="<li "+j+">Browser: "+r.browser+"</li>";s+="<li "+j+">Running: "+r.running+"</li></ul>";}s+="</ul>";s+="</font></ul>";g.one("#list").setContent(s);o='<h4 align="center">Results</h4><div id="count"></div><ul>';if(l){if(l["lcov-report"]){o+='<li><a href="/jutebase/output/lcov-report/index.html">Total Coverage</a></li>';}g.each(l,function(A,y,w){var x,v,z=0,i;if(y==="lcov.info"||y==="lcov-report"){return;}o+="<li>"+y+"</li><ul>";if(A.test_results){for(n=0;n<A.test_results.length;n=n+1){x=A.test_results[n].name;v=A.test_results[n].failed?"red":"green";i=x;i=i.replace(/-test.xml$/,"");o+='<li><a target="_blank" title="'+x+'" href="/jutebase/output/'+y+"/"+x+'"><font color="'+v+'">'+i+"</font></a></li>";if(A.test_results[n].failed&&!z){z=1;u+=1;}}}if(A.coverage==1){o+='<li><a target="_blank" href="/jutebase/output/'+y+'/lcov-report/index.html">Coverage Report</a></li>';}o+="</ul>";});}o+="</ul>";g.one("#results").setContent(o);e.current_status=g.JSON.stringify(p);g.one("#count").setContent("<p>"+u+" test failure(s) found.</p>");}}catch(q){console.log(q);g.one("#list").setContent("<pre>"+k.responseText+"</pre>");}},end:function(i){g.later(5000,{},e.heartBeat);}}};g.io("/jute/_heart_beat",h);};e.content_set=false;e.waitLoop=function(){var h={method:"GET",data:"d="+new Date().getTime(),on:{success:function(r,k){var l,q,s,m,j,o,p;try{l=g.JSON.parse(k.responseText);if(l.testLocation){q=window.location.search.substring(1);s="?";if(l.testLocation.match(/\?/)){s="&";}if(q){l.testLocation=l.testLocation+s+q;}window.location.href=l.testLocation;}else{if(!e.content_set&&l.availableTests){j=g.one("#content");o='<form method="POST" name="multiple_tests" action="/jute/_run_multiple">';o+='<h2 align="center"><span style="float:right;"><input type="submit" value="Run Tests"/></span>Available Tests</h2>';o+='<table width="100%" border="0" cellpadding="2" cellspacing="1"><tr><th>Test File (located at /jutebase/test/)</th><th><input type="checkbox" id="run_all_no_cov">&nbsp;Run Without Coverage</th><th><input type="checkbox" id="run_all_cov">&nbsp;Run With Coverage</th></tr>';for(m=0;m<l.availableTests.length;m=m+1){p=l.availableTests[m];o+="<tr>";o+="<td>"+p.test_url.replace(/\/jutebase\/test/gi,"")+"</td>";o+='<td align="center"><input name="test" class="no_cov_cbox" type="checkbox" value="'+p.test_url+';" />&nbsp;<a href="'+p.test_url+'?_one_shot=1">Run</a></td>';o+='<td align="center"><input name="test" class="cov_cbox" type="checkbox" value="'+p.test_url+'?do_coverage=1;" /><a href="'+p.test_url+'?_one_shot=1&do_coverage=1">Run</a></td>';o+="</tr>";}o+="</table>";o+='<input type="submit" value="Run Tests" />';j.setContent(o);g.one("#run_all_no_cov").on("click",function(){g.all(".no_cov_cbox").set("checked",g.one("#run_all_no_cov").get("checked"));});g.one("#run_all_cov").on("click",function(){g.all(".cov_cbox").set("checked",g.one("#run_all_cov").get("checked"));});e.content_set=true;}}}catch(n){console.log(n);}},end:function(i){g.later(5000,{},e.waitLoop);},failure:function(){}}};g.io("/jute/_get_test",h);};d=g.one("#get_coverage_button");if(d){d.on("click",function(){console.log("current status: "+e.current_status);var k=g.JSON.parse(e.current_status),h,j;for(h=0;h<k.tests_to_run.length;h=h+1){j=k.tests_to_run[h];if(navigator.userAgent===j.browser&&j.running>0){g.one("#grabber").setAttribute("src",j.remote_grabber);g.later(5000,{},function(){g.one("#run_tests").setAttribute("src","/jute_docs/run_tests.html");});}}});}c=g.one("#load_button");if(c){c.on("click",function(){var h=g.one("#load_file").get("value");g.io("/jute/_run_test",{method:"POST",data:"test="+escape(h)});});}b=g.one("#kick_frame");if(b){b.on("click",function(){g.one("#run_tests").setAttribute("src","/jute_docs/run_tests.html");});}a=g.one("#clear_tests");if(a){a.on("click",function(){g.io("/jute/_clear_tests",{method:"GET",on:{success:function(){g.one("#run_tests").setAttribute("src","/jute_docs/run_tests.html");},failure:function(){g.one("#run_tests").setAttribute("src","/jute_docs/run_tests.html");}}});});}f=g.one("#clear_results");if(f){f.on("click",function(){g.io("/jute/_clear_results");});}g.Test.Runner.subscribe(g.Test.Runner.COMPLETE_EVENT,function(i){var j=g.Test.Runner.getCoverage(g.Coverage.Format.JSON),h=g.Test.Format.JUnitXML(i.results);if(window.__done){window.__done(i,h,typeof(_yuitest_coverage)=="object"?_yuitest_coverage:null,j);}else{g.io("/jute/_test_report",{method:"POST",data:"results="+escape(h)+"&name="+escape(i.results.name)+"&coverage="+escape(j),on:{success:function(l,k){if(!window.location.toString().match("_one_shot")){window.location.href="/jute_docs/run_tests.html";}},failure:function(l,k){if(!window.location.toString().match("_one_shot")){window.location.href="/jute_docs/run_tests.html";}}}});}});e.go=function(){if(g.Console){var h=new g.Console({newestOnTop:false});h.render("#log");}try{g.Test.Runner.run();}catch(i){g.io("/jute/_pop",{on:{end:function(){window.location.href="/jute_docs/run_tests.html";}}});}};},"gallery-2011.06.22-20-13",{requires:["test","console","json","io","node"],skinnable:false});