YUI.add("gallery-form",function(B){function G(){G.superclass.constructor.apply(this,arguments);}B.mix(G,{NAME:"form",ATTRS:{method:{value:"post",validator:function(K){return this._validateMethod(K);},setter:function(K){return K.toLowerCase();}},action:{value:"",validator:B.Lang.isString},fields:{writeOnce:true,validator:function(K){return this._validateFields(K);},setter:function(K){return this._setFields(K);}},errors:{writeOnce:true,value:[],validator:function(K){return this._validateErrors(K);}}},HTML_PARSER:{action:function(K){return this._parseAction(K);},method:function(K){return this._parseMethod(K);},fields:function(K){return this._parseFields(K);}},FORM_TEMPLATE:"<form></form>"});B.extend(G,B.Widget,{_formNode:null,_ioIds:null,_validateMethod:function(K){if(!B.Lang.isString(K)){return false;}if(K.toLowerCase()!="get"&&K.toLowerCase()!="post"){return false;}return true;},_validateFields:function(M){if(!B.Lang.isArray(M)){return false;}for(var L=0,K=M.length;L<K;L++){if(M[L] instanceof B.FormField){continue;}else{if(B.Lang.isObject(M[L])){if(!M[L].name){return false;}continue;}else{return false;}}}return true;},_validateErrors:function(N){if(!B.Lang.isArray(N)){return false;}var M=true,L=0,K=N.length;for(;L<K;L++){if(!B.Lang.isObject(N[L])||!N[L].name||!N[L].message){M=false;break;}}return M;},_setFields:function(K){K=K||[];var O=0,M=K.length,P,L,N;for(;O<M;O++){if(!K[O]._classes){N=K[O].type;if(B.Lang.isFunction(N)){L=N;}else{if(N=="hidden"){L=B.HiddenField;}else{if(N=="checkbox"){L=B.CheckboxField;}else{if(N=="textarea"){L=B.TextareaField;}else{if(N=="select"){L=B.SelectField;}else{if(N=="choice"){L=B.ChoiceField;}else{if(N=="button"||N=="submit"||N=="reset"){L=B.Button;if(N=="submit"){K[O].onclick={fn:this.submit,scope:this};}else{if(N=="reset"){K[O].onclick={fn:this.reset,scope:this};}}}else{L=B.TextField;}}}}}}}P=new L(K[O]);K[O]=P;}}return K;},_parseAction:function(K){var L=K.one("form");return L.get("action");},_parseMethod:function(K){var L=K.one("form");return L.get("method");},_parseFields:function(L){var M=L.all("*"),N=L.all("label"),K=[];M.each(function(Q,P,O){var U=Q.get("nodeName"),S=Q.get("id"),R,T=[];if(U=="INPUT"){R={type:Q.get("type"),name:Q.get("name"),value:Q.get("value")};if(R.type=="submit"||R.type=="reset"||R.type=="button"){R.label=Q.get("value");}}else{if(U=="BUTTON"){R={type:"button",name:Q.get("name"),label:Q.get("innerHTML")};}else{if(U=="SELECT"){Q.all("option").each(function(W,X,V){T.push({label:W.get("innerHTML"),value:W.get("value")});});R={type:"select",name:Q.get("name"),choices:T};}}}if(R){if(S){R.id=S;N.some(function(W,X,V){if(W.get("htmlFor")==S){R.label=W.get("innerHTML");}});}K.push(R);}Q.remove();});return K;},_renderFormNode:function(){var K=this.get("contentBox"),L=K.query("form");if(!L){L=B.Node.create(G.FORM_TEMPLATE);K.appendChild(L);}this._formNode=L;},_renderFormFields:function(){var K=this.get("fields"),M=0,L=K.length;for(;M<L;M++){K[M].render(this._formNode);}},_syncFormAttributes:function(){this._formNode.setAttrs({action:this.get("action"),method:this.get("method"),id:this.get("id")});},_syncErrors:function(){var N=this.get("errors"),M,L=0,K=N.length;for(;L<K;L++){M=this.getField(N[L].name);if(M){M.showError(N[L].message);}}this.reset("errors");},_runValidation:function(){var K=this.get("fields"),M=0,L=K.length,N=true;for(;M<L;M++){if(K[M].validate()===false){N=false;}}return N;},_handleIOSuccess:function(K,L){if(typeof this._ioIds[K]!="undefined"){this.reset();this.fire("success",{response:L});delete this._ioIds[K];}},_handleIOFailure:function(K,L){if(typeof this._ioIds[K]!="undefined"){this.fire("failure",{response:L});delete this._ioIds[K];}},reset:function(){this.clearErrors();this._formNode.reset();for(var K=this.get("fields"),M=0,L=K.length;M<L;M++){K[M].clear();}},submit:function(){if(this._runValidation()){var L=this.get("action"),M=this.get("method"),O=this._formNode.get("id"),K={method:M,form:{id:O}},N=B.io(L,K);this._ioIds[N.id]=N;}},getField:function(L){var K=this.get("fields"),N=0,M=K.length;if(B.Lang.isNumber(L)){return K[L];}else{if(B.Lang.isString(L)){for(;N<M;N++){if(K[N].get("name")==L){return K[N];}}}}},clearErrors:function(){for(var K=this.get("fields"),M=0,L=K.length;M<L;M++){K[M].clearError();}},initializer:function(K){this._ioIds={};this.publish("submit");this.publish("reset");this.publish("success");this.publish("failure");},destructor:function(){this._formNode=null;},renderUI:function(){this._renderFormNode();this._renderFormFields();},bindUI:function(){this.after("errorsChange",B.bind(function(K){},this));this._formNode.on("submit",B.bind(function(K){K.halt();},this));B.on("io:success",B.bind(this._handleIOSuccess,this));B.on("io:failure",B.bind(this._handleIOFailure,this));},syncUI:function(){this._syncFormAttributes();this._syncErrors();}});B.Form=G;function C(){C.superclass.constructor.apply(this,arguments);}B.mix(C,{NAME:"form-field",ATTRS:{id:{value:B.guid(),validator:B.Lang.isString,writeOnce:true},name:{validator:B.Lang.isString,writeOnce:true},value:{value:"",validator:B.Lang.isString},label:{value:"",validator:B.Lang.isString},validator:{value:function(K){return true;},validator:B.Lang.isFunction},required:{value:false,validator:B.Lang.isBoolean}},tabIndex:0,INPUT_TEMPLATE:"<input>",TEXTAREA_TEMPLATE:"<textarea></textarea>",LABEL_TEMPLATE:"<label></label>",SELECT_TEMPLATE:"<select></select>"});B.extend(C,B.Widget,{_labelNode:null,_fieldNode:null,_errorNode:null,_nodeType:"text",_renderLabelNode:function(){var K=this.get("contentBox"),L=K.query("label");if(!L||L.get("for")!=this.get("id")){L=B.Node.create(C.LABEL_TEMPLATE);K.appendChild(L);}this._labelNode=L;},_renderFieldNode:function(){var K=this.get("contentBox"),L=K.query("#"+this.get("id"));if(!L){L=B.Node.create(C.INPUT_TEMPLATE);K.appendChild(L);}this._fieldNode=L;},_syncLabelNode:function(){if(this._labelNode){this._labelNode.setAttrs({innerHTML:this.get("label")});this._labelNode.setAttribute("for",this.get("id"));}},_syncFieldNode:function(){this._fieldNode.setAttrs({name:this.get("name"),type:this._nodeType,id:this.get("id"),value:this.get("value")});
this._fieldNode.setAttribute("tabindex",C.tabIndex);C.tabIndex++;},_checkRequired:function(){if(this.get("required")===true&&this.get("value").length===0){return false;}return true;},showError:function(L){var K=this.get("contentBox"),M=B.Node.create("<span>"+L+"</span>");M.addClass("error");K.insertBefore(M,this._labelNode);this._errorNode=M;},clearError:function(){if(this._errorNode){var K=this.get("contentBox");K.removeChild(this._errorNode);this._errorNode=null;}},validate:function(){var L=this.get("value"),K=this.get("validator");this.clearError();if(!this._checkRequired()){this.showError("This field is required");return false;}return K.call(this,L);},clear:function(){this.set("value","");this._fieldNode.set("value","");},initializer:function(){this.publish("blur");this.publish("change");this.publish("focus");},destructor:function(K){},renderUI:function(){this._renderLabelNode();this._renderFieldNode();},bindUI:function(){this._fieldNode.on("change",B.bind(function(K){this.set("value",this._fieldNode.get("value"));},this));this.on("valueChange",B.bind(function(K){this._fieldNode.set("value",K.newVal);},this));},syncUI:function(){this.get("boundingBox").removeAttribute("tabindex");this._syncLabelNode();this._syncFieldNode();}});B.FormField=C;function H(){H.superclass.constructor.apply(this,arguments);}B.mix(H,{NAME:"text-field"});B.extend(H,B.FormField,{_nodeType:"text"});B.TextField=H;function D(){D.superclass.constructor.apply(this,arguments);}B.mix(D,{NAME:"checkbox-field"});B.extend(D,B.FormField,{_nodeType:"checkbox"});B.CheckboxField=D;function J(){J.superclass.constructor.apply(this,arguments);}B.mix(J,{NAME:"hidden-field",ATTRS:{displayValue:{value:false,writeOnce:true,validator:B.Lang.isBoolean}}});B.extend(J,B.FormField,{_nodeType:"hidden",_valueDisplayNode:null,_renderValueDisplayNode:function(){if(this.get("displayValue")===true){var L=B.Node.create("<div></div>"),K=this.get("contentBox");K.appendChild(L);this._valueDisplayNode=L;}},renderUI:function(){J.superclass.renderUI.apply(this,arguments);this._renderValueDisplayNode();},bindUI:function(){J.superclass.bindUI.apply(this,arguments);if(this.get("displayValue")===true){this.after("valueChange",B.bind(function(K,L){this._valueDisplayNode.set("innerHTML",L.newVal);},this,true));}}});B.HiddenField=J;function E(){E.superclass.constructor.apply(this,arguments);}B.mix(E,{NAME:"textarea-field",NODE_TEMPLATE:"<textarea></textarea>"});B.extend(E,B.FormField,{_renderFieldNode:function(){var K=this.get("contentBox"),L=K.query("#"+this.get("id"));if(!L){L=B.Node.create(B.substitute(E.NODE_TEMPLATE,{name:this.get("name"),type:"text",id:this.get("id"),value:this.get("value")}));K.appendChild(L);}L.setAttribute("tabindex",B.FormField.tabIndex);B.FormField.tabIndex++;this._fieldNode=L;}});B.TextareaField=E;function I(){I.superclass.constructor.apply(this,arguments);}B.mix(I,{NAME:"choice-field",ATTRS:{choices:{validator:function(K){return this._validateChoices(K);}},multiple:{validator:B.Lang.isBoolean,value:false}}});B.extend(I,B.FormField,{_validateChoices:function(M){if(!B.Lang.isArray(M)){return false;}for(var L=0,K=M.length;L<K;L++){if(!B.Lang.isObject(M[L])){return false;}if(!M[L].label||!B.Lang.isString(M[L].label)||!M[L].value||!B.Lang.isString(M[L].value)){return false;}}return true;},_renderLabelNode:function(){var K=this.get("contentBox"),L=B.Node.create("<span>"+this.get("label")+"</span>");K.appendChild(L);this._labelNode=L;},_renderFieldNode:function(){var L=this.get("contentBox"),P=this.get("choices"),N=0,K=P.length,M,O;for(;N<K;N++){M=B.Node.create(C.LABEL_TEMPLATE);L.appendChild(M);O=B.Node.create(C.INPUT_TEMPLATE);L.appendChild(O);}this._fieldNode=L.all("input");},_syncFieldNode:function(){var N=this.get("choices"),K=this.get("contentBox"),M=K.all("label"),L=(this.get("multiple")===true?"checkbox":"radio");M.each(function(P,O,Q){P.setAttrs({innerHTML:N[O].label});P.setAttribute("for",(this.get("id")+"_choice"+O));},this);this._fieldNode.each(function(Q,O,R){Q.setAttrs({value:N[O].value,id:(this.get("id")+"_choice"+O),name:this.get("name"),type:L});var P=B.Node.getDOMNode(Q);P.value=N[O].value;},this);},clear:function(){this._fieldNode.each(function(L,K,M){L.setAttribute("checked",false);},this);this.set("value","");},bindUI:function(){this._fieldNode.on("change",B.bind(function(K){this._fieldNode.each(function(M,L,N){if(M.get("checked")===true){this.set("value",M.get("value"));}},this);},this));}});B.ChoiceField=I;function A(){A.superclass.constructor.apply(this,arguments);}B.mix(A,{NAME:"select-field",NODE_TEMPLATE:"<select></select>",OPTION_TEMPLATE:"<option></option>"});B.extend(A,B.ChoiceField,{_renderFieldNode:function(){var K=this.get("contentBox"),L=K.query("#"+this.get("id"));if(!L){L=B.Node.create(A.NODE_TEMPLATE);K.appendChild(L);}this._fieldNode=L;this._renderOptionNodes();},_renderOptionNodes:function(){var N=this.get("choices"),L=0,K=N.length,M;for(;L<=K;L++){M=B.Node.create(A.OPTION_TEMPLATE);this._fieldNode.appendChild(M);}},_syncFieldNode:function(){this._fieldNode.setAttrs({name:this.get("name"),id:this.get("id"),multiple:(this.get("multiple")===true?"multiple":"")});},_syncOptionNodes:function(){var M=this.get("choices"),K=this.get("contentBox"),L=K.all("option");L.each(function(Q,P,O){var N=(P===0?"Choose one":M[P-1].label),R=(P===0?"":M[P-1].value);Q.setAttrs({innerHTML:N,value:R});},this);},clear:function(){this._fieldNode.value="";},bindUI:function(){A.superclass.constructor.superclass.bindUI.apply(this,arguments);},syncUI:function(){A.superclass.syncUI.apply(this,arguments);this._syncOptionNodes();}});B.SelectField=A;function F(){F.superclass.constructor.apply(this,arguments);}B.mix(F,{NAME:"button",HTML_PARSER:{},ATTRS:{onclick:{validator:function(K){if(B.Lang.isObject(K)===false){return false;}if(typeof K.fn=="undefined"||B.Lang.isFunction(K.fn)===false){return false;}return true;},value:{fn:function(K){}},setter:function(K){K.scope=K.scope||this;K.argument=K.argument||{};return K;}}},NODE_TEMPLATE:"<button></button>"});
B.extend(F,B.FormField,{_renderButtonNode:function(){var K=this.get("contentBox"),L;L=B.Node.create(F.NODE_TEMPLATE);K.appendChild(L);this._fieldNode=L;},_syncLabelNode:function(){},_syncFieldNode:function(){this._fieldNode.setAttrs({innerHTML:this.get("label"),id:this.get("id")});},_setClickHandler:function(){if(!this._fieldNode){return;}var K=this.get("onclick");B.Event.purgeElement(this._fieldNode,true,"click");B.on("click",B.bind(K.fn,K.scope,true),this._fieldNode);},renderUI:function(){this._renderButtonNode();},bindUI:function(){this.after("onclickChange",B.bind(this._setClickHandler,this,true));this._setClickHandler();}});B.Button=F;},"gallery-2009.11.09-19",{requires:["node","attribute","widget","io-form","substitute"]});