YUI.add("gallery-datatable-multisort",function(g){var f=g.ClassNameManager.getClassName,h="datatable",b="column",d="asc",c="desc",a='<a class="{link_class}" title="{link_title}" href="{link_href}">{value}</a>';function e(){e.superclass.constructor.apply(this,arguments);}g.mix(e,{NS:"multisort",NAME:"dataTableMultiSort",ATTRS:{trigger:{value:{event:"click",selector:"th"},writeOnce:"initOnly"},lastSortedBy:{setter:"_setLastSortedBy",lazyAdd:false},template:{value:a},strings:{valueFn:function(){return g.Intl.get("datatable-multisort");}}}});g.extend(e,g.Plugin.Base,{initializer:function(j){var k=this.get("host"),i=this.get("trigger");k.get("recordset").plug(g.Plugin.RecordsetMultisort,{dt:k});k.get("recordset").multisort.addTarget(k);this.doBefore("_createTheadThNode",this._beforeCreateTheadThNode);this.doBefore("_attachTheadThNode",this._beforeAttachTheadThNode);this.doBefore("_attachTbodyTdNode",this._beforeAttachTbodyTdNode);k.delegate(i.event,g.bind(this._onEventSortColumn,this),i.selector);k.after("recordsetMultisort:sort",function(){this._uiSetRecordset(this.get("recordset"));});this.on("lastSortedByChange",function(l){this._uiSetLastSortedBy(l.prevVal,l.newVal,k);});if(k.get("rendered")){k._uiSetColumnset(k.get("columnset"));this._uiSetLastSortedBy(null,this.get("lastSortedBy"),k);}},_setLastSortedBy:function(k){if(g.Lang.isArray(k)){for(var j=0;j<k.length;j++){k[j].notdir=(k[j].dir==="desc")?"asc":"desc";}return k;}else{return null;}},_getLastSortedByKey:function(l){var k=this.get("lastSortedBy");for(var j=0;k&&j<k.length;j++){if(k[j].key==l){return k[j];}}return null;},_uiSetLastSortedBy:function(o,n,m){var y=this.get("strings"),l=m.get("columnset"),z=o&&o.key,w=n&&n.key,j=o&&m.getClassName(o.dir),r=n&&m.getClassName(n.dir),t=l.keyHash[z],q=l.keyHash[w],s=m._tbodyNode,x=g.Lang.sub,k,v,u;for(var p=0;o&&p<o.length;p++){z=o[p].key,t=l.keyHash[z],j=m.getClassName(o[p].dir);if(t&&j){k=t.thNode;v=k.one("a");if(v){v.set("title",x(y.sortBy,{column:t.get("label")}));}k.removeClass(j);s.all("."+f(b,t.get("id"))).removeClass(j);}}for(var p=0;n&&p<n.length;p++){w=n[p].key,q=l.keyHash[w],r=m.getClassName(n[p].dir);if(q&&r){k=q.thNode;v=k.one("a");if(v){u=(n[p].dir===d)?"reverseSortBy":"sortBy";v.set("title",x(y[u],{column:q.get("label")}));}k.addClass(r);s.all("."+f(b,q.get("id"))).addClass(r);}}},_beforeCreateTheadThNode:function(l){var j,k,i;if(l.column.get("sortable")){j=this._getLastSortedByKey(l.column.get("key"));k=(j&&j.dir===d&&j.key===l.column.get("key"))?"reverseSortBy":"sortBy";l.value=g.Lang.sub(this.get("template"),{link_class:l.link_class||"",link_title:g.Lang.sub(this.get("strings."+k),{column:l.column.get("label")}),link_href:"#",value:l.value});}},_beforeAttachTheadThNode:function(m){var l=this._getLastSortedByKey(m.column.get("key"));var k=l&&l.key,i=l&&l.dir,j=l&&l.notdir;if(m.column.get("sortable")){m.th.addClass(f(h,"sortable"));}if(k&&(k===m.column.get("key"))){m.th.replaceClass(f(h,j),f(h,i));}},_beforeAttachTbodyTdNode:function(m){var l=this._getLastSortedByKey(m.column.get("key"));var k=l&&l.key,i=l&&l.dir,j=l&&l.notdir;if(m.column.get("sortable")){m.td.addClass(f(h,"sortable"));}if(k&&(k===m.column.get("key"))){m.td.replaceClass(f(h,j),f(h,i));}},_onEventSortColumn:function(p){p.halt();var t=this.get("host"),l=t.get("columnset").idHash[p.currentTarget.get("id")],s=[],k=[],r,q,j,o,u;var n=this.get("lastSortedBy");for(var m=0;n&&m<n.length;m++){if(n[m].key==l.get("key")){j=n[m];}else{if(p.shiftKey){k.push({field:n[m].key,desc:n[m].dir===c});s.push({key:n[m].key,dir:n[m].dir});}}}if(l.get("sortable")){r=l.get("key");q=l.get("field");j=j||{};o=(j.key===r&&j.dir===d);u=l.get("sortFn");k.push({field:q,desc:o});s.push({key:r,dir:(o)?c:d});t.get("recordset").multisort.sort(k,u);this.set("lastSortedBy",s);}}});g.namespace("Plugin").DataTableMultiSort=e;},"gallery-2011.11.30-20-58",{lang:["en"],requires:["datatable-base","plugin","gallery-recordset-multisort"],skinnable:true});