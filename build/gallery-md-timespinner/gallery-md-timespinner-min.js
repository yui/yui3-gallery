YUI.add("gallery-md-timespinner",function(b){var h=b.Spinner,d=b.Lang,n="contentBox",a="boundingBox",k="Change",e="value",i="ui",r="showAmPm",q="min",s="max",j="interval",o="showSeconds",c="running",p="after",m="wrapped",g="hours",f="minutes",l="seconds",t="ampm";b.TimeSpinner=b.Base.create("timeSpinner",b.Widget,[b.MakeNode],{_hourSp:null,_minSp:null,_secSp:null,_ampmSp:null,_timer:null,_offset:0,_frozenTime:0,_spFact:function(x,u,v){var w=new h(b.merge({min:0,max:59,wraparound:true,"strings.input":this.get("strings."+x)},u)).render(v);w.get(a).addClass(this._classNames[x]);return w;},renderUI:function(){var u=this.get(n);this._hourSp=this._spFact(g,this.get(r)?{min:1,max:12}:{max:23},u);this._minSp=this._spFact(f,null,u);},bindUI:function(){this._eventHandles=[this._hourSp.after(e+k,this._afterValueChange,this),this._minSp.after(e+k,this._afterValueChange,this),this._minSp.after(m,this._afterWrapped,this)];},destroy:function(){if(this._timer){this._timer.cancel();}b.each([].concat(this._eventHandles,this._secondsEventHandles,this._ampmEventHandle),function(u){if(u){u.detach();}});b.TimeSpinner.superclass.destroy.call(this);},_uiSetShowSeconds:function(u){if(u){this._secSp=this._spFact(l,{value:this.get(e).getSeconds()});this._minSp.get(a).insert(this._secSp.get(a),p);this._secondsEventHandles=[this._secSp.after(e+k,this._afterValueChange,this),this._secSp.after(m,this._afterWrapped,this)];}else{if(this._secSp){if(this._secSp){b.each(this._secondsEventHandles,function(v){v.detach();});this._secSp.destroy();this._secSp=null;}}}},_uiSetShowAmPm:function(u){if(u){this._ampmSp=this._spFact(t,{max:1,formatter:function(v){return v?"PM":"AM";},parser:function(v){switch(v.toUpperCase()){case"AM":return 0;case"PM":return 1;default:return false;}}});(this._secSp?this._secSp.get(a):this._minSp.get(a)).insert(this._ampmSp.get(a),p);this._ampmEventHandle=this._ampmSp.after(e+k,this._afterValueChange,this);this._hourSp.setAttrs({max:12,min:1});this._uiSetValue(this.get(e));}else{this._hourSp.setAttrs({max:23,min:0});if(this._ampmSp){this._ampmEventHandle.detach();this._ampmSp.destroy();this._ampmSp=null;}}},_uiSetValue:function(v,w){if(w===i){return;}this._setting=true;var u=v.getHours();if(this._ampmSp){this._hourSp.set(e,(u%12)||12);this._ampmSp.set(e,u>=12?1:0);}else{this._hourSp.set(e,u);}this._minSp.set(e,v.getMinutes());if(this._secSp){this._secSp.set(e,v.getSeconds());}this._setting=false;},_uiSetInterval:function(u){if(this._timer){this._timer.cancel();}if(u){this._timer=b.later(u,this,this._updateTime,[],true);}},_uiSetRunning:function(u){this._uiSetInterval(u&&this.get(j));this._frozenTime=Date.now();},_afterValueChange:function(){if(this._setting){return;}var u=new Date();u.setHours((this._hourSp.get(e)+(this._ampmSp?12*this._ampmSp.get(e):0))%24);u.setMinutes(this._minSp.get(e));u.setSeconds(this._secSp?this._secSp.get(e):0);this.set(e,u,{src:i});},_afterWrapped:function(v){var u=v.newVal>v.prevVal?-1:1;if(v.target===this._secSp){this._minSp.set(e,this._minSp.get(e)+u);}if(v.target===this._minSp){this._hourSp.set(e,this._hourSp.get(e)+u);}},_updateTime:function(){this._uiSetValue(this._getTime());},_getTime:function(){if(this.get(c)){return new Date(Date.now()-this._offset);}else{return new Date(this._frozenTime-this._offset);}},_setTime:function(u){this._offset=Date.now()-u.getTime();return u;},start:function(){this.set(c,true);},stop:function(){this.set(c,false);}},{_CLASS_NAMES:[g,f,l,t],ATTRS:{showAmPm:{value:false,validator:d.isBoolean},showSeconds:{value:true,validator:d.isBoolean},value:{valueFn:function(){return new Date();},validator:function(u){return u instanceof Date;},getter:"_getTime",setter:"_setTime"},interval:{value:500,validator:d.isNumber},running:{value:true,validator:d.isBoolean},strings:{value:{hours:g,minutes:f,seconds:l,ampm:"am/pm"}}},_ATTRS_2_UI:{BIND:[j,c,r,o,e],SYNC:[j,c,r,o,e]}});},"gallery-2012.05.09-20-27",{requires:["gallery-md-spinner","gallery-makenode"],skinnable:false});