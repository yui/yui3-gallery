YUI.add("gallery-popup-calendar",function(c){var b="input",a="tabindex";c.PopupCalendar=c.Base.create("popup-calendar",c.Calendar,[c.WidgetPosition,c.WidgetPositionAlign,c.WidgetAutohide],{initializer:function(e){var f=e.input,d=f.getData("min-date"),i=f.getData("max-date"),g,h;this._bindEvents();this.setHideOn();this.set("tabIndex",0);if(this.get("autoTabIndexFormElements")){this.get(b).ancestor("form").all(b).setAttribute(a,"1");}if(d){g=this.normalizeIsoDate(d);this.set("startDate",g);this.set("minimumDate",g);if(!e.date){this.set("date",new Date(g));}}if(i){h=this.normalizeIsoDate(i);this.set("maximumDate",h);this.set("endDate",h);}this.set("customRenderer",{rules:this._buildDisabledRule(),filterFunction:this.filterFunction});},normalizeIsoDate:function(d){var f=d.replace(/-/g,"/"),e;e=new Date(f);if(e=="Invalid Date"||isNaN(e)){return new Date();}return e;},_bindEvents:function(){var d=this.get(b);d.on("focus",this.showCalendar,this);d.on("keydown",this.testKey,this);this.on("selectionChange",this._emitDate,this);this.after("autoFocusOnFieldFocusChange",this.setHideOn,this);},_setPopupTabindex:function(){var d=this.get(b),e=d.getAttribute(a);this.get(b).insert(this.get("boundingBox"),"after");if(e===""){e="0";}this.get("boundingBox").setAttribute(a,e);},_emitDate:function(d){this.fire("dateSelected",d);this.hideCalendar();},_testKey:function(d){if(d.keyCode===9){this.hideCalendar();}},_buildDisabledRule:function(d,n){var g=this.get("startDate"),q=this.get("endDate"),s={},j="",o="",p,l,m,f,k,r,h,e,i;if(g!==null){f=g.getUTCDate();k=g.getUTCMonth();r=g.getUTCFullYear();}if(q!==null){h=q.getUTCDate();e=q.getUTCMonth();i=q.getUTCFullYear();}if(n){p=d.getUTCDate()+"";l=d.getUTCMonth()+"";m=d.getUTCFullYear()+"";s[m]={};s[m][l]={};if(n==="start"){j=p+"-31";if(f!=1&&k==l){j="1-"+(f-1)+","+j;}}else{if(n==="end"){if(f>p&&k==l){p=f;}j="1-"+(p-1);}}s[m][l][j]="disabledDates";}s[r]=s[r]||{};s[i]=s[i]||{};s[r][k]=s[r][k]||{};s[i][e]=s[r][e]||{};o="1-"+(f-1);maxDayRule=(h+1)+"-31";s[r][k][o]="disabledDates";s[i][e][maxDayRule]="disabledDates";return s;},destructor:function(){this.get(b).detachAll();},setHideOn:function(){var d=[{eventName:"mousedownoutside"},{eventName:"key",node:c.one("document"),keyCode:"esc"}];if(this.get("autoFocusOnFieldFocus")){d.push({eventName:"keyupoutside"});}else{d.push({eventName:"keydownoutside"});}this.set("hideOn",d);},showCalendar:function(){if(this.get("rendered")){this.show();}else{this.render();this._setPopupTabindex();this.setCalendarPosition();this.get("contentBox").setStyle("height",this.get("height"));this.get("boundingBox").setStyle("z-index","1000");}if(this.get("autoFocusOnFieldFocus")){this.focus();}},hideCalendar:function(){this.hide();},setCalendarPosition:function(){if(this.get("align")===null){this.set("align",this.get("_align"));}this.show();}},{ATTRS:{input:{value:null},autoFocusOnFieldFocus:{value:false},autoTabIndexFormElements:{value:false},visible:{value:false},disabledDatesRule:{value:"disabledDates"},startDate:{value:null},endDate:{value:null},_align:{valueFn:function(){return{node:this.get("input"),points:[c.WidgetPositionAlign.TL,c.WidgetPositionAlign.TR]};}}}});},"gallery-2012.05.16-20-37",{skinnable:true,requires:["calendar","widget-position","widget-position-align","widget-autohide"]});