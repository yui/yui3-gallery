YUI.add("gallery-player",function(B){function A(C){A.superclass.constructor.apply(this,arguments);}A.NAME="player";A.ATTRS={stylesheet:{value:"assets/gallery-player-core.css",validator:B.Lang.isString},images:{value:"assets/images/",validator:B.Lang.isString},type:{value:"video",validator:B.Lang.isString},sources:{value:null,validator:B.Lang.isArray},poster:{value:null,validator:B.Lang.isString},preload:{value:false,validator:B.Lang.isBool},autoplay:{value:false,validator:B.Lang.isBool},loop:{value:false,validator:B.Lang.isBool},standardControls:{value:false,validator:B.Lang.isBool},controlSet:{value:["play","rewind","forward","fullscreen","volume","scrubber","counters"],validator:B.Lang.isArray},width:{value:null,validator:B.Lang.isNumber},height:{value:null,validator:B.Lang.isNumber},degrade:{value:"<p>Your browser does not support this widget.</p>",validator:B.Lang.isString},player:null,controls:{},scrubEvent:null,playEvent:null,rewindEvent:null,forwardEvent:null};B.extend(A,B.Widget,{initializer:function(){if(!this.get("standardControls")){B.Node.DOM_EVENTS.abort=1;B.Node.DOM_EVENTS.canplay=1;B.Node.DOM_EVENTS.canplaythrough=1;B.Node.DOM_EVENTS.durationchange=1;B.Node.DOM_EVENTS.emptied=1;B.Node.DOM_EVENTS.ended=1;B.Node.DOM_EVENTS.error=1;B.Node.DOM_EVENTS.load=1;B.Node.DOM_EVENTS.loadeddata=1;B.Node.DOM_EVENTS.loadedmetadata=1;B.Node.DOM_EVENTS.loadstart=1;B.Node.DOM_EVENTS.pause=1;B.Node.DOM_EVENTS.play=1;B.Node.DOM_EVENTS.playing=1;B.Node.DOM_EVENTS.progress=1;B.Node.DOM_EVENTS.ratechange=1;B.Node.DOM_EVENTS.seeked=1;B.Node.DOM_EVENTS.seeking=1;B.Node.DOM_EVENTS.stalled=1;B.Node.DOM_EVENTS.suspend=1;B.Node.DOM_EVENTS.timeupdate=1;B.Node.DOM_EVENTS.volumechange=1;B.Node.DOM_EVENTS.waiting=1;}},renderUI:function(){this.createPlayerTag(this.get("type"));},bindUI:function(){if(!this.get("standardControls")){this.get("player").on("abort",this.eventAbort,this);this.get("player").on("canplay",this.eventCanPlay,this);this.get("player").on("canplaythrough",this.eventCanPlayThrough,this);this.get("player").on("durationchange",this.eventDurationChange,this);this.get("player").on("emptied",this.eventEmptied,this);this.get("player").on("ended",this.eventEnded,this);this.get("player").on("error",this.eventError,this);this.get("player").on("load",this.eventLoad,this);this.get("player").on("loadeddata",this.eventLoadedData,this);this.get("player").on("loadedmetadata",this.eventLoadedMetaData,this);this.get("player").on("loadstart",this.eventLoadStart,this);this.get("player").on("pause",this.eventPause,this);this.get("player").on("play",this.eventPlay,this);this.get("player").on("playing",this.eventPlaying,this);this.get("player").on("progress",this.eventProgress,this);this.get("player").on("ratechange",this.eventRateChange,this);this.get("player").on("seeked",this.eventSeeked,this);this.get("player").on("seeking",this.eventSeeking,this);this.get("player").on("stalled",this.eventStalled,this);this.get("player").on("suspend",this.eventSuspend,this);this.get("player").on("timeupdate",this.eventTimeUpdate,this);this.get("player").on("volumechange",this.eventVolumeChange,this);this.get("player").on("waiting",this.eventWaiting,this);this.get("boundingBox").on("mouseover",this.showControls,this);this.get("boundingBox").on("mouseout",this.hideControls,this);if(this.get("controlSet").indexOf("volume")!==-1){this.get("controls").volume_slider.on("valueChange",this.volume,this);this.get("controls").volume.on("click",this.volume,this);}if(this.get("controlSet").indexOf("fullscreen")!==-1&&this.get("player")._node.webkitEnterFullScreen!==undefined){this.get("controls").fullscreen.on("click",this.fullscreen,this);}}},syncUI:function(){var C,D;C=((this.get("player").getStyle("width").replace("px",""))-438)/2+this.get("player").getX();D=((this.get("player").getStyle("height").replace("px",""))-59)/1+this.get("player").getY()-25;this.get("controls").controls.setXY([C,D]);},destructor:function(){},createPlayerTag:function(E){var C,D;C=this.get("contentBox");if(E==="video"){D=B.Node.create("<video></video>",document);D.prepend(this.get("degrade"));if(this.get("sources").length>1){D.prepend(this.createSources(this.get("sources")));}else{D.setAttribute("src",this.get("sources")[0].title);}if(this.get("width")!==null){D.setAttribute("width",this.get("width"));}if(this.get("height")!==null){D.setAttribute("height",this.get("height"));}if(this.get("poster")!==null){D.setAttribute("poster",this.get("poster"));}D._node.autoplay=this.get("autoplay");D._node.controls=this.get("standardControls");D._node.loop=this.get("loop");D._node.autobuffer=this.get("preload");C.prepend(D);if(!this.get("standardControls")){this.createCustomControls(D);}}this.set("player",D);this.get("player")._node.volume=0.75;},createSources:function(D){var E,G,F,C="";for(E=0;E<D.length;E=E+1){G=D[E].title;F=D[E].type;C+='<source src="'+G+'" type="'+F+'" />';}return C;},createCustomControls:function(O){var L,P,G,H,K,J,N,M,D,I,F,Q,E,C="";L="yui-"+this.name+"-";if(this.get("stylesheet")){C=B.Node.create('<link rel="stylesheet" type="text/css" href="'+this.get("stylesheet")+'" media="screen" />');B.one("head").append(C);}P=B.Node.create('<div class="'+L+'controls"><img src="'+this.get("images")+'volume_icons.png" width="92" height="14" alt="Volume Icons" class="volume_icons"></div>');if(this.get("controlSet").indexOf("play")!==-1){G=B.Node.create('<img src="'+this.get("images")+'play.png" class="'+L+'play" width="22" height="25" alt="Play">');}if(this.get("controlSet").indexOf("rewind")!==-1){H=B.Node.create('<img src="'+this.get("images")+'rewind.png" class="'+L+'rewind" width="33" height="19" alt="Rewind">');}if(this.get("controlSet").indexOf("forward")!==-1){K=B.Node.create('<img src="'+this.get("images")+'forward.png" class="'+L+'forward" width="33" height="19" alt="Forward">');}if(this.get("controlSet").indexOf("volume")!==-1){J=B.Node.create('<div class="yui-widget yui-slider '+L+'volume"><div class="yui-slider-content"><div class="yui-slider-rail yui-slider-rail-x"><div class="yui-slider-thumb"></div></div></div></div>');
Q=new B.Slider({railSize:"50px",height:"10px",axis:"x",thumbImage:this.get("images")+"volume.png",boundingBox:J,min:0,max:100,value:75});}if(this.get("controlSet").indexOf("volume")!==-1&&O._node.webkitEnterFullScreen!==undefined){N=B.Node.create('<img src="'+this.get("images")+'fullscreen.png" class="'+L+'fullscreen" width="15" height="16" alt="Fullscreen">');}if(this.get("controlSet").indexOf("scrubber")!==-1){M=B.Node.create('<div class="yui-widget yui-slider '+L+'scrubber_bar"><div class="yui-slider-content"><div class="yui-slider-rail yui-slider-rail-x"><div class="yui-slider-thumb"></div></div></div></div>');D=B.Node.create('<span class="'+L+'progress">00:00:00</span>');F=B.Node.create('<span class="'+L+'length">00:00:00</span>');E=new B.Slider({railSize:"316px",height:"8px",axis:"x",thumbImage:this.get("images")+"progress.png",boundingBox:M,min:0,max:100,value:0});}this.set("controls",{"controls":P,"rewind":H,"play":G,"forward":K,"volume":J,"fullscreen":N,"scrubber_bar":M,"progress":D,"scrubber":I,"length":F,"volume_slider":Q,"scrubber_slider":E});if(this.get("controlSet").indexOf("scrubber")!==-1){M.prepend(F);M.prepend(D);M.prepend(I);P.prepend(M);}if(this.get("controlSet").indexOf("fullscreen")!==-1&&O._node.webkitEnterFullScreen!==undefined){P.prepend(N);}if(this.get("controlSet").indexOf("volume")!==-1){P.prepend(J);}if(this.get("controlSet").indexOf("forward")!==-1){P.prepend(K);K.setStyle("opacity",0.5);}if(this.get("controlSet").indexOf("rewind")!==-1){P.prepend(H);H.setStyle("opacity",0.5);}if(this.get("controlSet").indexOf("play")!==-1){P.prepend(G);G.setStyle("opacity",0.5);}O.ancestor().insert(P);if(this.get("controlSet").indexOf("volume")!==-1){Q.render();}if(this.get("controlSet").indexOf("scrubber")!==-1){E.get("contentBox").setStyle("opacity",0.5);E.render();}},play:function(D){var C=this.get("player")._node;if(C.paused){C.play();}else{C.pause();}},rewind:function(C){this.get("player")._node.playbackRate=this.get("player")._node.playbackRate-2;},forward:function(C){this.get("player")._node.playbackRate=this.get("player")._node.playbackRate+2;},volume:function(C){if(parseInt(C.newVal,10)){this.get("player")._node.volume=parseInt(C.newVal,10)/100;}},scrub:function(E){if(parseInt(E.newVal,10)){var D,C;D=this.get("player")._node.duration;C=D*(parseInt(E.newVal,10)/100);if(C>D){C=D;}if(C<0){C=0;}this.get("player")._node.currentTime=C;}},beginScrub:function(C){this.scrubEvent=this.get("controls").scrubber_slider.on("valueChange",this.scrub,this);},endScrub:function(C){this.scrubEvent.detach();},fullscreen:function(C){this.get("player")._node.webkitEnterFullScreen();},showControls:function(){var C=new B.Anim({node:this.get("controls").controls,to:{opacity:1},duration:0.25});C.run();},hideControls:function(){var C=new B.Anim({node:this.get("controls").controls,to:{opacity:0},duration:0.25});C.run();},eventAbort:function(C){},eventCanPlay:function(C){if(this.get("controlSet").indexOf("play")!==-1){this.playEvent=this.get("controls").play.on("click",this.play,this);this.get("controls").play.setStyle("opacity",1);}if(this.get("controlSet").indexOf("rewind")!==-1){this.rewindEvent=this.get("controls").rewind.on("click",this.rewind,this);this.get("controls").rewind.setStyle("opacity",1);}if(this.get("controlSet").indexOf("forward")!==-1){this.forwardEvent=this.get("controls").forward.on("click",this.forward,this);this.get("controls").forward.setStyle("opacity",1);}if(this.get("controlSet").indexOf("scrubber")!==-1){this.get("controls").scrubber_slider.on("slideStart",this.beginScrub,this);this.get("controls").scrubber_slider.on("slideEnd",this.endScrub,this);this.get("controls").scrubber_slider.get("contentBox").setStyle("opacity",1);}},eventCanPlayThrough:function(C){},eventDurationChange:function(C){},eventEmptied:function(C){},eventEnded:function(C){},eventError:function(C){},eventLoad:function(C){},eventLoadedData:function(C){},eventLoadedMetaData:function(D){var C=this.get("player")._node.duration;if(this.get("controlSet").indexOf("scrubber")!==-1){this.get("controls").length.set("innerHTML",this.convertSecondsToTimeStamp(C));}},eventLoadStart:function(C){},eventPause:function(C){if(this.get("controlSet").indexOf("play")!==-1){this.get("controls").play.removeClass("yui-player-pause");this.get("controls").play.addClass("yui-player-play");this.get("controls").play._node.src=this.get("images")+"play.png";}},eventPlay:function(C){if(this.get("controlSet").indexOf("play")!==-1){this.get("controls").play.removeClass("yui-player-play");this.get("controls").play.addClass("yui-player-pause");this.get("controls").play._node.src=this.get("images")+"pause.png";}},eventPlaying:function(C){},eventProgress:function(C){if(this.get("controlSet").indexOf("play")!==-1){if(this.get("playEvent")!==undefined){this.get("playEvent").detach();}if(this.get("forwardEvent")!==undefined){this.get("forwardEvent").detach();}if(this.get("rewindEvent")!==undefined){this.get("rewindEvent").detach();}}},eventRateChange:function(C){},eventSeeked:function(C){},eventSeeking:function(C){},eventStalled:function(C){},eventSuspend:function(C){},eventTimeUpdate:function(E){var C,D;D=this.get("player")._node.duration;C=this.get("player")._node.currentTime;if(this.get("controlSet").indexOf("scrubber")!==-1){this.get("controls").progress.set("innerHTML",this.convertSecondsToTimeStamp(C));this.get("controls").scrubber_slider.setValue((C/D)*100);this.get("controls").scrubber_slider.syncUI();}},eventVolumeChange:function(C){},eventWaiting:function(C){if(this.get("controlSet").indexOf("play")!==-1){this.playEvent=this.get("controls").play.detach();this.get("controls").play.setStyle("opacity",0.5);}if(this.get("controlSet").indexOf("rewind")!==-1){this.rewindEvent=this.get("controls").rewind.detach();this.get("controls").rewind.setStyle("opacity",0.5);}if(this.get("controlSet").indexOf("forward")!==-1){this.forwardEvent=this.get("controls").forward.detach();this.get("controls").forward.setStyle("opacity",0.5);}if(this.get("controlSet").indexOf("scrubber")!==-1){this.get("controls").scrubber_slider.detach();
this.get("controls").scrubber_slider.detach();this.get("controls").scrubber_slider.get("contentBox").setStyle("opacity",0.5);}},convertSecondsToTimeStamp:function(E){var C,D,G,F;C=(E>3600)?(E/60)/60:0;if(C===0){D=(E>60)?E/60:0;}else{D=E-((C%1)*60*60);}if(D===0){G=(E<60)?E:0;}else{G=(D%1)*60;}C=(Math.floor(C).toString().length===1)?"0"+Math.floor(C):Math.floor(C);D=(Math.floor(D).toString().length===1)?"0"+Math.floor(D):Math.floor(D);G=(Math.floor(G).toString().length===1)?"0"+Math.floor(G):Math.floor(G);F=C+":"+D+":"+G;return F;}});B.Player=A;},"gallery-2010.03.23-17-54",{requires:["widget","node","slider","anim"],supersedes:["widget"]});