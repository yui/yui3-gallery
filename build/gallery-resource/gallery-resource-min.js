YUI.add("gallery-resource",function(g){var h,i="resource",k="uri",q="headers",b="timeout",a="entityTranslators",t="request",d="response",e="success",j="failure",p="HEAD",r="OPTIONS",u="GET",f="POST",l="PUT",s="DELETE",n=g.Lang.isString,m=g.Lang.isObject,o=g.Lang.isNumber,c=g.Lang.isFunction;h=function(v){h.superclass.constructor.apply(this,arguments);};g.mix(h,{NAME:i,ATTRS:{uri:{validator:n},headers:{validator:m},timeout:{validator:o},entityTranslators:{validator:m}},ENTITY_TRANSLATORS:{JSON:{contentType:"application/json; charset=UTF-8",serialize:g.JSON.stringify,deserialize:function(v){if(v.responseText){return g.JSON.parse(v.responseText);}}},FORM:{contentType:"application/x-www-form-urlencoded; charset=UTF-8",serialize:g.QueryString.stringify,deserialize:null}},NO_ENTITY_METHODS:[u,p,s],isNoEntityMethod:function(v){return g.Array.indexOf(h.NO_ENTITY_METHODS,v.toUpperCase())>=0;}});g.extend(h,g.Base,{_request:null,initializer:function(v){if(!this.get(k)){g.error("A Resource needs to be configured with: uri");}v=v||{};this.publish(t,{defaultFn:this._defRequestFn});this.publish(d);this.publish(e);this.publish(j);g.each(h.ENTITY_TRANSLATORS,g.bind(this.registerEntityTranslator,this));g.each(v[a],g.bind(this.registerEntityTranslator,this));},destructor:function(){this._request=null;},registerEntityTranslator:function(v){var w={};if(v&&v.contentType){w[v.contentType.split(";")[0]]=v;this.set(a,g.merge(this.get(a),w));}},unregisterEntityTranslator:function(w){var v=this.get(a);if(w){delete v[w.split(";")[0]];this.set(a,v);}},getEntityTranslator:function(v){return(v?this.get(a)[v.split(";")[0]]:null);},sendRequest:function(y){var z=this.get(k),x=this.get(q),v=this.get(b),C,B,A,w;y=y||{};C=y.method?y.method.toUpperCase():u;B=g.merge(x,y.headers);A=y.timeout||v;if(h.isNoEntityMethod(C)){delete B["Content-Type"];}else{w=y.entity;}this._request=null;this.fire(t,{uri:z,headers:B,timeout:A,method:C,params:y.params,entity:w,on:y.on});return this._request;},_defRequestFn:function(w){var v=w.method.toLowerCase()+"Request";this.publish(v,{defaultFn:this._sendRequest});this.fire(v,{uri:w.uri,headers:w.headers,timeout:w.timeout,method:w.method,params:w.params,entity:w.entity,on:w.on});},_sendRequest:function(C){var x=C.uri,v=C.method,w=C.headers,E=C.timeout,D=C.on,z,A,B;if(m(C.params)){z=g.clone(C.params,true);x=g.substitute(x,z,function(G,F){delete z[G];return F;});if(g.Object.size(z)>0){x+=x.indexOf("?")<0?"?":"";x+=x[x.length-1]!=="?"&&x[x.length-1]!=="&"?"&":"";x+=g.QueryString.stringify(z);}}A=C.entity;B=this.getEntityTranslator(w["Content-Type"]);if(A&&B&&B.serialize){try{A=B.serialize(A);}catch(y){}}this._request=g.io(x,{method:v,headers:w,data:A,timeout:E,context:this,on:{complete:this._onComplete,success:this._onSuccess,failure:this._onFailure},"arguments":{resource:this,request:{method:C.method,params:C.params,entity:C.entity},on:D}});},_onComplete:function(z,y,v){var x=v.request.method.toLowerCase()+"Response",w={txId:z,request:v.request,response:y};this.getEvent(d).applyConfig({defaultFn:function(A){this.publish(x,{defaultFn:function(B){if(v.on&&c(v.on.response)){v.on.response(w);}}}).fire(w);}},true);this.fire(d,w);},_onSuccess:function(C,B,x){var A=x.request.method.toLowerCase()+"Success",w=this.getEntityTranslator(B.getResponseHeader("Content-Type")),v,y;if(B&&w&&w.deserialize){try{v=w.deserialize(B);}catch(z){g.error(z);}}y={txId:C,request:x.request,response:B,entity:v};this.getEvent(e).applyConfig({defaultFn:function(D){this.publish(A,{defaultFn:function(E){if(x.on&&c(x.on.success)){x.on.success(y);}}}).fire(y);}},true);this.fire(e,y);},_onFailure:function(z,y,w){var v=w.request.method.toLowerCase()+"Failure",x={txId:z,request:w.request,response:y};this.getEvent(j).applyConfig({defaultFn:function(A){this.publish(v,{defaultFn:function(B){if(w.on&&c(w.on.failure)){w.on.failure(x);}}}).fire(x);}},true);this.fire(j,x);}});g.each([p,r,u,f,l,s],function(v){h.prototype[v]=function(w){if(c(w)){w={on:{success:w}};}return this.sendRequest(g.merge(w,{method:v}));};});g.Resource=h;},"gallery-2011.05.04-20-03",{requires:["base-base","io-base","querystring-stringify-simple","substitute","json"]});