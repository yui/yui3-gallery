YUI.add("gallery-colorpicker",function(d){var c={rgbToHSL:function(e,k,n){e/=255;k/=255;n/=255;var o=Math.max(e,k,n),i=Math.min(e,k,n),j,p,f=(o+i)/2,m;if(o===i){j=p=0;}else{m=o-i;p=f>0.5?m/(2-o-i):m/(o+i);switch(o){case e:j=(k-n)/m+(k<n?6:0);break;case k:j=(n-e)/m+2;break;case n:j=(e-k)/m+4;break;}j/=6;}return{h:j,s:p,l:f};},_hue2rgb:function(g,f,e){if(e<0){e+=1;}if(e>1){e-=1;}if(e<1/6){return g+(f-g)*6*e;}if(e<1/2){return f;}if(e<2/3){return g+(f-g)*(2/3-e)*6;}return g;},hslToRGB:function(j,i,f){var m,k,e,n,o;if(i===0){m=k=e=f;}else{n=f<0.5?f*(1+i):f+i-f*i;o=2*f-n;m=c._hue2rgb(o,n,j+1/3);k=c._hue2rgb(o,n,j);e=c._hue2rgb(o,n,j-1/3);}return{r:Math.round(m*255),g:Math.round(k*255),b:Math.round(e*255)};}};d.Colors=c;function a(){a.superclass.constructor.apply(this,arguments);}a.NAME="colorpicker";a.CLASSNAME=d.ClassNameManager.getClassName(a.NAME);a.CLASSNAME_SQUARE=d.ClassNameManager.getClassName(a.NAME,"colrsqr");a.CLASSNAME_HBAR=d.ClassNameManager.getClassName(a.NAME,"hbar");a.CLASSNAME_SBAR=d.ClassNameManager.getClassName(a.NAME,"sbar");a.CLASSNAME_LBAR=d.ClassNameManager.getClassName(a.NAME,"lbar");a.CLASSNAME_SWATCH=d.ClassNameManager.getClassName(a.NAME,"swatch");a.CLASSNAME_VALUE=d.ClassNameManager.getClassName(a.NAME,"val");a.CLASSNAME_HVALUE=d.ClassNameManager.getClassName(a.NAME,"hval");a.CLASSNAME_SVALUE=d.ClassNameManager.getClassName(a.NAME,"sval");a.CLASSNAME_LVALUE=d.ClassNameManager.getClassName(a.NAME,"lval");a.CLASSNAME_RVALUE=d.ClassNameManager.getClassName(a.NAME,"rval");a.CLASSNAME_GVALUE=d.ClassNameManager.getClassName(a.NAME,"gval");a.CLASSNAME_BVALUE=d.ClassNameManager.getClassName(a.NAME,"bval");a.CLASSNAME_HEXVALUE=d.ClassNameManager.getClassName(a.NAME,"hexval");a.ATTRS={showHSLBars:{value:true},showHSL:{value:true},showRGB:{value:true},showHEX:{value:true},showSwatch:{value:true},squareWidth:{value:150},squareHeight:{value:150},barWidth:{value:20},barHeight:{value:150},swatchWidth:{value:110},swatchHeight:{value:34},hex:{getter:function(){var f=this.get("rgb"),i=f.r.toString(16),h=f.g.toString(16),e=f.b.toString(16);if(i.length<2){i="0"+i;}if(h.length<2){h="0"+h;}if(e.length<2){e="0"+e;}return i+h+e;},setter:function(l){if(l.length<6){return;}var h=l[0]+l[1],f=l[2]+l[3],i=l[4]+l[5],k=parseInt(h,16),j=parseInt(f,16),e=parseInt(i,16);this.set("rgb",{r:k,g:j,b:e});}},rgb:{getter:function(){return c.hslToRGB(this.color.h,this.color.s,this.color.l);},setter:function(f){f.r=Math.min(f.r,255);f.g=Math.min(f.g,255);f.b=Math.min(f.b,255);f.r=Math.max(f.r,0);f.g=Math.max(f.g,0);f.b=Math.max(f.b,0);var e=c.rgbToHSL(f.r,f.g,f.b);this.color=d.merge(e);this.update();}},hslInt:{getter:function(){var e=d.merge(this.color);e.h=Math.round(e.h*360);e.s=Math.round(e.s*100);e.l=Math.round(e.l*100);return e;},setter:function(f){var e=d.merge(f);e.h=e.h/360;e.s=e.s/100;e.l=e.l/100;e.h=Math.min(e.h,1);e.s=Math.min(e.s,1);e.l=Math.min(e.l,1);e.h=Math.max(e.h,0);e.s=Math.max(e.s,0);e.l=Math.max(e.l,0);this.color=e;this.update();}},hsl:{getter:function(){return this.color;},setter:function(e){e.h=Math.min(e.h,1);e.s=Math.min(e.s,1);e.l=Math.min(e.l,1);e.h=Math.max(e.h,0);e.s=Math.max(e.s,0);e.l=Math.max(e.l,0);this.color=d.merge(e);this.update();}},cacheBars:{value:false},strings:{value:{hValue:"H",sValue:"S",lValue:"L",rValue:"R",gValue:"G",bValue:"B",hexValue:"Hex"}}};d.extend(a,d.Widget,{color:{h:0,s:1,l:0.5},sCachePixels:{},lCachePixels:{},squareCachePixels:{},barPaddingX:5,barPaddingY:5,renderUI:function(){this.contentBox=this.get("contentBox");this.contentBox.addClass(this.name);this.squareCanvas=this.createCanvas(a.CLASSNAME_SQUARE,this.get("squareWidth"),this.get("squareHeight"));this.squareCanvas.id="squareCanvas";this.renderSquare();var f,h,g,e;if(this.get("showHSLBars")){f=this.get("barWidth");h=this.get("barHeight");this.hCanvas=this.createCanvas(a.CLASSNAME_HBAR,f+this.barPaddingX*2,h+this.barPaddingY*2);this.sCanvas=this.createCanvas(a.CLASSNAME_SBAR,f+this.barPaddingX*2,h+this.barPaddingY*2);this.lCanvas=this.createCanvas(a.CLASSNAME_LBAR,f+this.barPaddingX*2,h+this.barPaddingY*2);}if(this.get("showSwatch")){this.swatchCanvas=d.Node.create("<div></div>");this.swatchCanvas.addClass(a.CLASSNAME_SWATCH);this.contentBox.appendChild(this.swatchCanvas);}if(this.get("showHSL")){this.hVal=this.createValue(a.CLASSNAME_HVALUE,this.get("strings.hValue"),this.color.h,3,3,"hslInt","h");this.sVal=this.createValue(a.CLASSNAME_SVALUE,this.get("strings.sValue"),this.color.s,3,3,"hslInt","s");this.lVal=this.createValue(a.CLASSNAME_LVALUE,this.get("strings.lValue"),this.color.l,3,3,"hslInt","l");}if(this.get("showRGB")){g=this.get("rgb");this.rVal=this.createValue(a.CLASSNAME_RVALUE,this.get("strings.rValue"),g.r,3,3,"rgb","r");this.gVal=this.createValue(a.CLASSNAME_GVALUE,this.get("strings.gValue"),g.g,3,3,"rgb","g");this.bVal=this.createValue(a.CLASSNAME_BVALUE,this.get("strings.bValue"),g.b,3,3,"rgb","b");}if(this.get("showHEX")){e=this.get("hex");this.hexVal=this.createValue(a.CLASSNAME_HEXVALUE,this.get("strings.hexValue"),e,6,6,"hex",null);}},renderPixels:function(j,s,q,v,u,A,w,h,g,B,z,D,C,m){var t=j.getContext("2d"),r=t.createImageData(s,q),l={h:0,s:0,l:0},f=(D-B)/s,k=(C-z)/q,p=0,i=1,o,n,e;l[A]=w;l[h]=B;l[g]=z;if(m){i=-1;p=r.data.length;}for(n=0;n<q;n+=1){for(o=0;o<s;o+=1){e=c.hslToRGB(l.h,l.s,l.l);r.data[p]=e.r;p+=i;r.data[p]=e.g;p+=i;r.data[p]=e.b;p+=i;r.data[p]=255;p+=i;l[h]+=f;}l[g]+=k;l[h]=B;}t.putImageData(r,v,u);return r;},startUpdating:function(){this.stopUpdating();this.moveListener=d.on("mousemove",this.onMouseMove,this.get("boundingBox"),this);this.mouseUpListener=d.on("mouseup",this.onMouseUp,document.body,this);this.animTimer=d.later(60,this,this.update,null,true);},stopUpdating:function(){if(this.animTimer){this.animTimer.cancel();this.animTimer=null;}if(this.moveListener){this.moveListener.detach();this.moveListener=null;}if(this.mouseUpListener){this.mouseUpListener.detach();this.mouseUpListener=null;}},onBarMouseDown:function(h,f){this.trackBar=f.component;this.trackBarCanvas=h.target;
var g=h.target.getXY(),j=h.target.get("docScrollX"),i=h.target.get("docScrollY"),e=h.clientX+j-g[0],k=h.clientY+i-g[1];this.barX=e;this.barY=k;this.startUpdating();h.halt();},onMouseUp:function(e){this.trackBar=false;this.trackSquare=false;this.stopUpdating();e.halt();},onMouseMove:function(i){var f,j,h,e,m,l,k,g;if(this.trackSquare){g=d.Node.one(this.squareCanvas);f=g.getXY();l=g.get("docScrollX");k=g.get("docScrollY");j=i.clientX+l-f[0];h=i.clientY+k-f[1];e=this.get("squareWidth");m=this.get("squareHeight");j=Math.min(e,j);h=Math.min(m,h);h=Math.max(0,h);j=Math.max(0,j);this.squareX=j;this.squareY=h;}if(this.trackBar){f=this.trackBarCanvas.getXY();l=this.trackBarCanvas.get("docScrollX");k=this.trackBarCanvas.get("docScrollY");j=-this.barPaddingX+i.clientX+l-f[0];h=-this.barPaddingY+i.clientY+k-f[1];e=this.get("barWidth");m=this.get("barHeight");j=Math.min(e,j);h=Math.min(m,h);h=Math.max(0,h);j=Math.max(0,j);this.barX=j;this.barY=h;}i.halt();},onSquareMouseDown:function(g){this.trackSquare=true;var f=g.target.getXY(),i=g.target.get("docScrollX"),h=g.target.get("docScrollY"),e=g.clientX+i-f[0],j=g.clientY+h-f[1];this.squareX=e;this.squareY=j;this.startUpdating();g.halt();},updateColor:function(){if(!this.get("showHSLBars")){return;}var f=this.get("barWidth"),h=this.get("barHeight"),g=this.get("cacheBars"),e=this.hCanvas.getContext("2d");e.clearRect(0,0,f+this.barPaddingX*2,h+this.barPaddingY*2);e=this.sCanvas.getContext("2d");e.clearRect(0,0,f+this.barPaddingX*2,h+this.barPaddingY*2);e=this.lCanvas.getContext("2d");e.clearRect(0,0,f+this.barPaddingX*2,h+this.barPaddingY*2);if(g){if(!this.sCachePixels[this.color.h]){this.sCachePixels[this.color.h]=this.renderPixels(this.sCanvas,f,h,this.barPaddingX,this.barPaddingY,"h",this.color.h,"l","s",50,100,50,0);}else{e=this.sCanvas.getContext("2d");e.putImageData(this.sCachePixels[this.color.h],this.barPaddingX,this.barPaddingY);}if(!this.lCachePixels[this.color.h]){this.lCachePixels[this.color.h]=this.renderPixels(this.lCanvas,f,h,this.barPaddingX,this.barPaddingY,"h",this.color.h,"s","l",100,100,100,0);}else{e=this.lCanvas.getContext("2d");e.putImageData(this.lCachePixels[this.color.h],this.barPaddingX,this.barPaddingY);}}else{this.renderPixels(this.sCanvas,f,h,this.barPaddingX,this.barPaddingY,"h",this.color.h,"l","s",0.5,1,0.5,0);this.renderPixels(this.lCanvas,f,h,this.barPaddingX,this.barPaddingY,"h",this.color.h,"s","l",1,1,1,0);}if(!this.huePixelCache){this.huePixelCache=this.renderPixels(this.hCanvas,f,h,this.barPaddingX,this.barPaddingY,"s",1,"l","h",0.5,0,0.5,1);}else{e=this.hCanvas.getContext("2d");e.putImageData(this.huePixelCache,this.barPaddingX,this.barPaddingY);}},drawThumb:function(f,l,h,e,o,m,i){var n=this.color[l],p=f.getContext("2d"),k=(o/m)*(n),g=h,j;if(i){k=o-k;}k+=this.barPaddingY;g[l]=n;g.h=g.h-0.5;if(g.h<0){g.h+=1;}g.s=g.s-0.5;if(g.s<0){g.s+=1;}g.l=g.l-0.5;if(g.l<0){g.l+=1;}p.beginPath();p.moveTo(this.barPaddingX,k);p.lineTo(e+this.barPaddingX*2,k);j=c.hslToRGB(g.h,g.s,g.l);p.strokeStyle="rgb("+j.r+", "+j.g+", "+j.b+")";p.lineWidth=0.5;p.stroke();p.beginPath();p.moveTo(this.barPaddingX,k);p.lineTo(0,k-2.5);p.lineTo(0,k+2.5);p.lineTo(this.barPaddingX,k);p.moveTo(e+this.barPaddingX,k);p.lineTo(e+this.barPaddingX*2,k-2.5);p.lineTo(e+this.barPaddingX*2,k+2.5);p.lineTo(e+this.barPaddingX,k);p.strokeStyle="rgb(255, 255, 255)";p.fillStyle="rgb(255, 255, 255)";p.stroke();p.fill();},updateValues:function(){var e=this.get("rgb"),f;if(this.get("showSwatch")){this.swatchCanvas.setStyle("background","rgb("+e.r+", "+e.g+", "+e.b+")");}if(this.get("showHSL")){this.hVal.set("value",Math.round(this.color.h*360));this.sVal.set("value",Math.round(this.color.s*100));this.lVal.set("value",Math.round(this.color.l*100));}if(this.get("showRGB")){this.rVal.set("value",e.r);this.gVal.set("value",e.g);this.bVal.set("value",e.b);}if(this.get("showHEX")){f=this.get("hex");this.hexVal.set("value",f);}},update:function(){var k=this.get("squareWidth"),e=this.get("squareHeight"),j=this.get("barWidth"),m=this.get("barHeight"),i,f,g;if(this.trackSquare){i=(1/k)*this.squareX;f=1-(1/e)*this.squareY;this.color.h=i;this.color.l=f;}if(this.trackBar){if(this.trackBar==="h"){i=(1/m)*this.barY;this.color.h=i;}else{g=1-(1/m)*this.barY;this.color[this.trackBar]=g;}}this.renderSquare();this.updateValues();if(this.get("showHSLBars")){this.updateColor();this.drawThumb(this.hCanvas,"h",{h:this.color.h,s:1,l:0.5},j,m,1,false);this.drawThumb(this.sCanvas,"s",{h:this.color.h,s:1,l:this.color.l},j,m,1,true);this.drawThumb(this.lCanvas,"l",{h:this.color.h,s:this.color.s,l:0.5},j,m,1,true);}},renderSquare:function(){var i=this.get("squareWidth"),g=this.get("squareHeight"),h=this.squareCanvas.getContext("2d"),f,e,j;if(!this.squareCachePixels[this.color.s]){this.squareCachePixels[this.color.s]=this.renderPixels(this.squareCanvas,i,g,0,0,"s",this.color.s,"h","l",0,1,1,0);}else{h.putImageData(this.squareCachePixels[this.color.s],0,0);}h.strokeStyle="rgb(255, 255, 255)";f=5;e=(this.color.h*(i/1));j=((1-this.color.l)*(g/1));h.beginPath();h.arc(e,j,f,0,Math.PI*2,true);h.stroke();h.beginPath();h.strokeStyle="rgb(0, 0, 0)";h.arc(e,j,f+1,0,Math.PI*2,true);h.stroke();},createCanvas:function(h,g,e){var i=d.Node.create("<div class='"+h+"'></div>"),f=d.Node.create("<canvas width='"+g+"' height='"+e+"'></canvas>");i.appendChild(f);this.contentBox.appendChild(i);return d.Node.getDOMNode(f);},createValue:function(h,k,l,m,f,g,i){var e=d.Node.create("<div class='"+a.CLASSNAME_VALUE+" "+h+"'></div>"),j=d.Node.create("<input type='text' size='"+m+"' maxlength='"+f+"' value='"+l+"'></input>");k=d.Node.create("<label>"+k+"</label>");e.appendChild(k);k.appendChild(j);this.contentBox.appendChild(e);j.setData("target",g);j.setData("component",i);return j;},onInputKeyDown:function(h){if(h.charCode===13||h.charCode===8||h.charCode===127||h.charCode===9){return true;}var f=String.fromCharCode(h.charCode),e=h.target,i=e.getData("target"),g;if(i==="hex"){g=/[0-9]|[a-f]|[A-F]/;if(!g.test(f)){h.halt();return false;
}}else{g=/[0-9]/;if(!g.test(f)){h.halt();return false;}}},onInputKeyUp:function(h){var f=h.target,j=f.getData("target"),g=f.getData("component"),e=f.get("value"),i;if(e===""){return;}if(j==="hex"){if(e.length<6){return;}this.set(j,e);return;}i=this.get(j);i[g]=parseInt(e,10);this.set(j,i);},onInputBlur:function(){this.update();},bindUI:function(){d.on("mousedown",this.onSquareMouseDown,this.squareCanvas,this);if(this.get("showHSLBars")){d.on("mousedown",this.onBarMouseDown,this.hCanvas,this,{component:"h"});d.on("mousedown",this.onBarMouseDown,this.sCanvas,this,{component:"s"});d.on("mousedown",this.onBarMouseDown,this.lCanvas,this,{component:"l"});}d.delegate("keyup",this.onInputKeyUp,this.contentBox,"."+a.CLASSNAME_VALUE,this);d.delegate("blur",this.onInputBlur,this.contentBox,"."+a.CLASSNAME_VALUE,this);d.delegate("keydown",this.onInputKeyDown,this.contentBox,"."+a.CLASSNAME_VALUE,this);},syncUI:function(){var f=this.get("squareWidth"),e=this.get("squareHeight");this.squareX=this.color.h*(f/1);this.squareY=this.color.l*(e/1);this.update();}});d.ColorPicker=a;function b(){b.superclass.constructor.apply(this,arguments);this.publish("palette:selected");}b.NAME="colorPalette";b.CLASSNAME_SWATCH="cp-swatch";b.ATTRS={};d.extend(b,d.Widget,{colors:[],colorExists:function(e){var f,g;for(f=0;f<this.colors.length;f+=1){g=this.colors[f];if(g.h===e.h&&g.s===e.s&&g.l===e.l){return true;}}return false;},addColor:function(f){if(this.colorExists(f)){return;}var h=d.merge(f),i=d.Node.create('<div class="'+b.CLASSNAME_SWATCH+'"></div>'),g=c.hslToRGB(h.h,h.s,h.l),e=this.get("contentBox");i.setStyle("background","rgb("+g.r+", "+g.g+", "+g.b+")");i.setData("hsl",h);e.appendChild(i);this.colors.push(h);},renderUI:function(){},bindUI:function(){d.delegate("click",this.onSwatchClick,this.get("contentBox"),"."+b.CLASSNAME_SWATCH,this);},onSwatchClick:function(h){var g=h.target,e=g.getData("hsl"),f=c.hslToRGB(e.h,e.s,e.l);this.fire("palette:selected",{hsl:e,rgb:f});},syncUI:function(){}});d.ColorPalette=b;},"gallery-2011.09.28-20-06",{requires:["node","event","widget","classnamemanager"]});