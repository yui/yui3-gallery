YUI.add("gallery-io-multiresponse",function(a){var l=a.config.win,s=a.config.doc,b=(s.documentMode&&s.documentMode>=8),e=decodeURIComponent;function i(y,x){var z=[],d=x.split("="),w,v;for(w=0,v=d.length-1;w<v;w++){z[w]=s.createElement("input");z[w].type="hidden";z[w].name=e(d[w].substring(d[w].lastIndexOf("&")+1));z[w].value=(w+1===v)?e(d[w+1]):e(d[w+1].substring(0,(d[w+1].lastIndexOf("&"))));y.appendChild(z[w]);}return z;}function g(w,v){if(!a.Lang.isString(v)){v=a.JSON.stringify(v);}var d=s.createElement("input");d.type="hidden";d.name="json";d.value=v;w.appendChild(d);return d;}function k(w,x){var v,d;for(v=0,d=x.length;v<d;v++){w.removeChild(x[v]);}}function f(v,x,d,w){v.setAttribute("action",d);v.setAttribute("method",w||"POST");v.setAttribute("target","io-multi-response-"+x);v.setAttribute(a.UA.ie&&!b?"encoding":"enctype","multipart/form-data");}function c(v,d){a.Object.each(d,function(w,x){if(w){v.setAttribute(x,w);}else{v.removeAttribute(x);}});}function p(d,v){a.io._timeout[d.id]=l.setTimeout(function(){var w={id:d.id,status:"timeout"};a.io.end(w,v);},v.timeout);}function m(d){l.clearTimeout(a.io._timeout[d]);delete a.io._timeout[d];}function j(v,d){if(!d.debug){a.Event.purgeElement("#io-multi-response-"+v,false);a.one("body").removeChild(a.one("#io-multi-response-"+v));}if(d.form.id.indexOf("io-multi-response-form-")===0){a.one("body").removeChild(a.one("#"+d.form.id));}}function h(d,v){if(v.timeout){m(d.id);}a.io.end(d,v);l.setTimeout(function(){j(d.id,v);},0);}function r(v,w){var d=a.Node.create('<iframe id="io-multi-response-'+v.id+'" name="io-multi-response-'+v.id+'" />');d._node.style.position="absolute";d._node.style.top="-1000px";d._node.style.left="-1000px";a.one("body").appendChild(d);a.on("load",function(){h(v,w);},"#io-multi-response-"+v.id);}function q(w){var v=a.guid("io-multi-response-form-"),d=a.Node.create('<form id="'+v+'" name="'+v+'" />');d._node.style.position="absolute";d._node.style.top="-1000px";d._node.style.left="-1000px";a.one("body").appendChild(d);return v;}function u(y,w,z){var x=(typeof z.form.id==="string")?s.getElementById(z.form.id):z.form.id,v=[],d={method:x.getAttribute("method"),action:x.getAttribute("action"),target:x.getAttribute("target")};f(x,y.id,w,z.method);if(z.data){v=i(x,z.data);}if(z.json){v.push(g(x,z.json));}if(z.timeout){p(y,z);}x.submit();a.io.start(y.id,z);if(z.data){k(x,v);}c(x,d);return{id:y.id,abort:function(){var A={id:y.id,status:"abort"};if(a.one("#io-multi-response-"+y.id)){j(y.id,z);a.io.end(A,z);}else{return false;}},isInProgress:function(){return a.one("#io-multi-response-"+y.id)?true:false;}};}function n(x,y){var w=new a.EventTarget().publish("transaction:"+x),d=y.arguments,v=y.context||a;if(d){w.on(y.on[x],v,d);}else{w.on(y.on[x],v);}return w;}var o=a.io.upload;a.io.upload=function(w,d,x){if(!x.multiresponse){return o.apply(this,arguments);}YUI.Env.io_multi_response_callback[w.id]=function(y){if(!y){a.error("Callback "+w.id+" invoked without data.",null,"io");return;}if(x.timeout){m(w.id);p(w,x);}if(x.on&&x.on.response){n("response",x).fire(w.id,y);}};var v="callback="+encodeURIComponent("window.parent.YUI.Env.io_multi_response_callback["+w.id+"]");x.data=x.data?x.data+"&"+v:v;if(x.form&&!x.form.id){delete x.form;}r(w,x);return u(w,d,x);};if(!YUI.Env.io_multi_response_callback){YUI.Env.io_multi_response_callback=[];}var t=a.io;a.io=function(v,w,d){if(w.multiresponse&&!w.form){w.form={id:q(w),upload:true};}else{if(w.multiresponse&&!w.form.upload){w.form.upload=true;}}t.call(this,v,w,d);};a.mix(a.io,t);},"gallery-2011.06.01-20-18",{requires:["io-upload-iframe"],optional:["json-stringify"]});