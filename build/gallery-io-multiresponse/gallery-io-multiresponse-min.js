YUI.add("gallery-io-multiresponse",function(a){var i=a.Lang,j=a.config.win,g=a.config.doc,e=(g.documentMode&&g.documentMode>=8),f=decodeURIComponent;function k(m,p,n){var d=a.Node.create('<iframe id="io-multi-response-'+m.id+'" name="io-multi-response-'+m.id+'" />');d._node.style.position="absolute";d._node.style.top="-1000px";d._node.style.left="-1000px";a.one("body").appendChild(d);a.on("load",function(){n._multi_complete(m,p);},"#io-multi-response-"+m.id);}function l(n){var m=a.guid("io-multi-response-form-"),d=a.Node.create('<form id="'+m+'" name="'+m+'" />');d._node.style.position="absolute";d._node.style.top="-1000px";d._node.style.left="-1000px";a.one("body").appendChild(d);return m;}a.mix(a.IO.prototype,{_addJSON:function(n,m){if(!a.Lang.isString(m)){m=a.JSON.stringify(m);}var d=g.createElement("input");d.type="hidden";d.name="json";d.value=m;n.appendChild(d);return d;},_multi_setAttrs:function(m,o,d,n){m.setAttribute("action",d);m.setAttribute("method",n||"POST");m.setAttribute("target","io-multi-response-"+o);m.setAttribute(a.UA.ie&&!e?"encoding":"enctype","multipart/form-data");},_multi_startTimeout:function(d,n){var m=this;m._timeout[d.id]=j.setTimeout(function(){d.status=0;d.statusText="timeout";m.end(d,n);},n.timeout);},_multi_destroy:function(m,d){if(!d.debug){a.Event.purgeElement("#io-multi-response-"+m,false);a.one("body").removeChild(a.one("#io-multi-response-"+m));}if(d.form.id.indexOf("io-multi-response-form-")===0){a.one("body").removeChild(a.one("#"+d.form.id));}},_multi_complete:function(d,n){var m=this;if(n.timeout){m._clearTimeout(d.id);}m.end(d,n);j.setTimeout(function(){m._multi_destroy(d.id,n);},0);},_multi_send:function(q,n,s){var r=this,p=(typeof s.form.id==="string")?g.getElementById(s.form.id):s.form.id,m={method:p.getAttribute("method"),action:p.getAttribute("action"),target:p.getAttribute("target")},d=[];r._multi_setAttrs(p,q.id,n,s.method);if(s.data){d=r._addData(p,s.data);}if(s.json){d.push(r._addJSON(p,s.json));}if(s.timeout){r._multi_startTimeout(q,s);}p.submit();r.start(q,s);if(s.data){r._removeData(p,d);}r._resetAttrs(p,m);return{id:q.id,abort:function(){q.status=0;q.statusText="abort";if(a.one("#io-multi-response-"+q.id)){r._multi_destroy(q.id,s);r.end(q,s);}else{return false;}},isInProgress:function(){return a.one("#io-multi-response-"+q.id)?true:false;},io:r};}});var h=a.IO.prototype._init;a.IO.prototype._init=function(d){h.apply(this,arguments);this.publish("io:response",a.merge({broadcast:1},d));this.publish("io-trn:response",d);};var b=a.IO.prototype.upload;a.IO.prototype.upload=function(p,d,r){if(!r.multiresponse){return b.apply(this,arguments);}var q=this;YUI.Env.io_multi_response_callback[p.id]=function(o){if(!o){a.error("Callback "+p.id+" invoked without data.",null,"io");return;}if(r.timeout){q._clearTimeout(p.id);q._multi_startTimeout(p,r);}if(r.on&&r.on.response){p.c=o;q._evt("response",p,r);}};var m=encodeURIComponent("window.parent.YUI.Env.io_multi_response_callback["+p.id+"]");var n="callback="+m;if(!r.data){r.data=n;}else{if(i.isObject(r.data)){r.data.callback=m;}else{r.data=r.data+"&"+n;}}if(r.form&&!r.form.id){delete r.form;}k(p,r,q);return q._multi_send(p,d,r);};if(!YUI.Env.io_multi_response_callback){YUI.Env.io_multi_response_callback=[];}var c=a.io;a.io=function(d,m){if(m.multiresponse&&!m.form){m.form={id:l(m),upload:true};}else{if(m.multiresponse&&!m.form.upload){m.form.upload=true;}}c.call(this,d,m);};a.mix(a.io,c);},"gallery-2011.10.27-17-03",{requires:["io-upload-iframe"],optional:["json-stringify"]});