YUI.add("gallery-itsaviewmodelpanel",function(e,t){"use strict";var n,r=e.ITSAFormElement,i=e.Array,s=e.Object,o=e.Lang,u=4e3,a="focusnext",f="id",l="contentBox",c="rendered",h="View",p="body"+h,d="footer",v=d+h,m="header"+h,g="template",y=d+"Template",b="itsa-focused",w="editable",E="model",S="visible",x="Change",T="close",N="click",C=T+N,k="button",L=k+N,A=k+":hide",O="boolean",M="string",_="load",D="submit",P="delete",H="save",B="destroy",j="value",F="reset",I="itsatabkeymanager",q="noHideOnLoad",R="noHideOnReset",U="noHideOnSubmit",z="noHideOnSave",W="disabled",X="pure-"+k+"-"+W,V="validationerror",$="itsa-panelclosebtn",J="statusBar",K="gallery-itsamodelsyncpromise",Q={load:!0,save:!0,submit:!0,destroy:!0},G={ok:!0,retry:!0,save:!0,submit:!0};n=e.ITSAViewModelPanel=e.Base.create("itsaviewmodelpanel",e.ITSAPanel,[],null,{ATTRS:{bodyView:{value:null,writeOnce:!0},closableByEscape:{value:!1,validator:function(e){return typeof e===O}},editable:{value:!1,validator:function(e){return typeof e===O}},footerTemplate:{value:null,validator:function(e){return typeof e===M}},footerView:{value:null,writeOnce:!0},headerView:{value:null,readOnly:!0},hideOnBtn:{value:!0,validator:function(e){return typeof e===O}},noHideOnLoad:{value:!0,validator:function(e){return typeof e===O}},noHideOnReset:{value:!0,validator:function(e){return typeof e===O}},noHideOnSave:{value:!1,validator:function(e){return typeof e===O}},noHideOnSubmit:{value:!1,validator:function(e){return typeof e===O}},model:{value:{},validator:function(t){return t===null||o.isObject(t)||typeof t===M||t instanceof e.Model}},template:{value:null,validator:function(e){return typeof e===M}}}}),n.prototype.initializer=function(){var t=this,n=t.get(E),r=t.get(y);t._eventhandlers=[],t._partOfMultiView=!0,t.get(J)&&n&&e.batch(e.usePromise(K),t.readyPromise()).then(function(){n.addMessageTarget(t)}),t._set(p,new e.ITSAViewModel({model:n,template:t.get(g),editable:t.get(w),styled:!1,focusManaged:!1,partOfMultiView:!0})),r&&t._set(v,new e.ITSAViewModel({model:n,template:r,editable:!1,styled:!1,focusManaged:!1,partOfMultiView:!0}))},n.prototype.addCustomBtn=function(e,t,n){var r=this,i=r.get(p),s=r.get(v);i.addCustomBtn(e,t,n),s&&s.addCustomBtn(e,t,n)},n.prototype.addCustomBtns=function(e){var t=this;o.isArray(e)&&i.each(e,function(e){e.buttonId&&e.labelHTML&&t.addCustomBtn(e.buttonId,e.labelHTML,e.config)})},n.prototype.bindUI=function(){var t=this,i=t.get(l),o,c;n.superclass.bindUI.apply(t),o=t._eventhandlers,c=t.get(p),c.addTarget(t),o.push(t.after(w+x,function(e){c.set(w,e.newVal)})),o.push(t.after(S+x,function(n){var i=n.newVal,s;i||(t._pickerVis&&e.ItsaDateTimePicker.hide(!0),s=t.get(E),s.toJSONUI&&(r.tipsyOK._lastnode&&s._FORM_elements[r.tipsyOK._lastnode.get(f)]&&r.tipsyOK.hideTooltip(),r.tipsyInvalid._lastnode&&s._FORM_elements[r.tipsyInvalid._lastnode.get(f)]&&r.tipsyInvalid.hideTooltip()))})),o.push(t.after(E+x,function(n){var r=t.get(v),i=n.newVal,o=t._syncMessages;c.set(E,i),r&&r.set(E,i),o&&i&&i.setSyncMessage&&s.each(o,function(e,t){new i.setSyncMessage(t,e)}),t.get(J)&&e.batch(e.usePromise(K),t.readyPromise()).then(function(){i.addMessageTarget(t),n.prevVal.removeMessageTarget()})})),o.push(t.after(J+x,function(e){var n=t.get(E);n&&(e.newVal?n.addMessageTarget(t):n.removeMessageTarget())})),o.push(t.after(g+x,function(e){c.set(g,e.newVal),i.pluginReady(I,u).then(function(e){e.refresh(i),i.hasClass(b)&&e.focusInitialItem()})})),o.push(c.on(a,function(e){if(e.target!==t){var n=a,r={type:n,model:t.get(E),modelEventFacade:e,target:t};t.fire(n,r)}})),o.push(t.after(["*:"+C,"*:"+k+T],function(e){t.fire(A,{buttonNode:e.target})})),o.push(t.after(["*:"+_,"*:"+F],function(n){var r=n.target;r instanceof e.Model&&t.get(S)&&i.pluginReady(I,u).then(function(e){r.enableUI(),i.hasClass(b)&&e.focusInitialItem()})})),o.push(t.on(y+x,function(n){var r=n.newVal,s=n.prevVal,o,a;r&&r!==""&&(a=t.get(v),a?a.set("template",r):(o=new e.ITSAViewModel({model:t.get(E),template:r,editable:!1,styled:!1,focusManaged:!1,partOfMultiView:!0}),t._set(v,o),t._renderFooter())),s&&(!r||r==="")&&t._set(v,null),i.pluginReady(I,u).then(function(e){e.refresh(i),i.hasClass(b)&&e.focusInitialItem()})})),o.push(t.after(["*:"+L],function(e){var n=e.buttonNode,r=n&&n.get(j);n&&t.get("hideOnBtn")&&r!==T&&(!t.get(R)||r!==F)&&(!t.get(q)||r!==_)&&(!t.get(U)||r!==D)&&(!t.get(z)||r!==H)&&n.getAttribute("data-datetimepicker")!=="true"&&t.fire(A,{buttonNode:n})})),o.push(t._header.delegate(N,function(e){var n=e.target,r=n.get(j),i=n.hasClass($);!i&&t.get("hideOnBtn")&&r!==T&&(!t.get(R)||r!==F)&&(!t.get(q)||r!==_)&&(!t.get(U)||r!==D)&&(!t.get(z)||r!==H)&&t.fire(A,{buttonNode:n})},k)),o.push(t.on(A,function(e){var n=t.get(E),r=t.get(w),i=e.buttonNode,s=i.get(j),o,u;G[s]&&r&&n&&n.getUnvalidatedUI&&(o=n.getUnvalidatedUI())&&!o.isEmpty()&&(u={target:n,nodelist:o,src:e.type},e.preventDefault(),n.fire(V,u))})),o.push(t.on(["*:"+D,"*:"+H,"*:"+_,"*:"+B],function(n){var r=n.promise,s=n.target,o=e.ITSAMessageController,a=t.get(J)||s._itsamessageListener||o&&o._targets[E+"sync"],f=n.type.split(":")[1],l=n.options||{},c=f===B&&(l.remove||l[P]),h;if(!c&&s instanceof e.Model){if(f===D||f===H)h=s.getAttrs(),s.UIToModel();t._lockedBefore=t._locked,t.lockPanel(!0),a||t._setSpin(f,!0),f===B||r.then(function(){(f===_||f===D||f===H)&&s.setResetAttrs()},function(){return(f===D||f===H)&&s.setAttrs(h,{fromInternal:!0}),!0}).then(function(){a||t._setSpin(f,!1),t._lockedBefore||t.unlockPanel(),i.hasClass(b)&&i.pluginReady(I,u).then(function(e){e.focusInitialItem()})})}})),o.push(t.on("*:datepickerclick",function(){t.lockPanel(),t._pickerVis=!0,t.once("*:"+a,function(){t._pickerVis=!1,t.unlockPanel()})}))},n.prototype.focusInitialItem=function(){var e=this,t=e.get(l);return t.pluginReady(I,u).then(function(e){t.addClass(b),e.focusInitialItem()})},n.prototype.lockPanel=function(){var e=this,t=e.get(m),n=e.get(p),r=e.get(v);n.lockView(),t?t.lockView():e._header.all("button").addClass(X),r?r.lockView():e._footercont.all
("button").addClass(X),arguments[0]||(e._locked=!0)},n.prototype.unlockPanel=function(){var e=this,t=e.get(m),n=e.get(p),r=e.get(v);n.unlockView(),t?t.unlockView():e._header.all("button").removeClass(X),r?r.unlockView():e._footercont.all("button").removeClass(X),e._locked=!1},n.prototype.removeButtonLabel=function(e){var t=this,n=t.get(p),r=t.get(v);n.removeButtonLabel(e),r&&r.removeButtonLabel(e)},n.prototype.removeCustomBtn=function(e){var t=this,n=t.get(p),r=t.get(v);n.removeCustomBtn(e),r&&r.removeCustomBtn(e)},n.prototype.removeHotKey=function(e){var t=this,n=t.get(p),r=t.get(v);n.removeHotKey(e),r&&r.removeHotKey(e)},n.prototype.setButtonLabel=function(e,t){var n=this,r=n.get(p),i=n.get(v);r.setButtonLabel(e,t),i&&i.setButtonLabel(e,t)},n.prototype.setButtonLabels=function(e){var t=this;o.isArray(e)&&i.each(e,function(e){e.buttonType&&e.labelHTML&&t.setButtonLabel(e.buttonType,e.labelHTML)})},n.prototype.setHotKey=function(e,t){var n=this,r=n.get(p),i=n.get(v);r.setHotKey(e,t),i&&i.setHotKey(e,t)},n.prototype.setHotKeys=function(e){var t=this;o.isArray(e)&&i.each(e,function(e){e.buttonType&&e.hotkey&&t.setHotKey(e.buttonType,e.hotkey)})},n.prototype.setSyncMessage=function(e,t){var n=this,r=n.get(E);n._syncMessages||(n._syncMessages={}),Q[e]&&r&&r.setSyncMessage&&r.setSyncMessage(e,t)&&(n._syncMessages[e]=t)},n.prototype.syncUI=function(){var e=this,t=e.get(p),n=e.get(v);e.get(c)&&(t.render(),n&&n.render())},n.prototype.translate=function(e){return this.get(p).translate(e)},n.translatePromise=function(t){return e.ITSAViewModel.translatePromise(t)},n.prototype.translatePromise=n.translatePromise,n.prototype.destructor=function(){var e=this,t=e.get(p),n=e.get(v);e._clearEventhandlers(),t.removeTarget(e),t&&t.destroy(),n&&n.destroy()},n.prototype._clearEventhandlers=function(){var e=this;i.each(e._eventhandlers,function(e){e.detach()})},n.prototype._setSpin=function(e,t){var n=this,r=n.get(l).all('[data-buttonsubtype="'+e+'"] i');r.toggleClass("itsaicon-form-loading",t),r.toggleClass("itsa-busy",t)}},"@VERSION@",{requires:["node-pluginhost","yui-base","base-build","base-base","event-outside","model","gallery-itsapanel","gallery-itsaviewmodel","gallery-itsaformelement","gallery-itsamodulesloadedpromise"]});
