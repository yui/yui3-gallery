YUI.add("gallery-jsonrpc",function(c){var b=c.Lang.isFunction,a=c.Array;function d(f){var e=f&&f.methods,g;f=this._config=c.merge({context:this,method:"POST"},f);if(!("preload" in f)){f.preload=!e;}d.init.apply(this,arguments);if(e){for(g=e.length-1;g>=0;--g){d.addMethod(this,e[g]);}}if(f.preload){this.loadAPI();}}c.JSONRPC=c.mix(d,{defaults:{version:2,sync:false,contentType:"application/json"},addMethod:function(g,e,f){if(f||!g[e]){g[e]=function(){var h=a(arguments,0,true),i=h[h.length-1],j;if(b(i)||(i&&i.on&&(i.on.success||i.on.failure))){j=h.pop();}return this.exec(e,h,j);};}},init:function(){c.mix(this._config,d.defaults);this.publish("dispatch",{emitFacade:true,defaultFn:d._defDispatchFn});},_defDispatchFn:function(f){f.ioConfig.data=c.JSON.stringify(f.rpcPayload);c.io(f.url,f.ioConfig);},prototype:{exec:function(l,j,k){var h={method:l},g=this._config,e={headers:{"Content-Type":g.contentType+"; charset=utf-8"},method:g.method,sync:g.sync,on:{}},i,f;if(b(k)){k={on:{success:k}};}c.aggregate(e,k,true);if(j){h.params=j;}if(g.serverParams){c.mix(h,g.serverParams);}if(g.version>1){h.jsonrpc=g.version.toFixed(1);}if(k){h.id=c.guid();i=k.on.success;f=k.on.failure;if(i){e.on.success=function(p,m){var n;try{n=c.JSON.parse(m.responseText);}catch(o){n={error:{code:-32700,message:"Parse error"},id:null};}if(n.error){if(f){f.call(e.context,n.error);}}else{i.call(e.context,n.result);}};}}return this.fire("dispatch",{url:g.url,method:l,params:j,callback:k,rpcPayload:h,ioConfig:e});},loadAPI:function(){var e=this._config;c.io(e.url,{headers:{"Content-Type":e.contentType+"; charset=utf-8"},sync:e.sync,on:{success:function(k,f){var h,g;try{h=c.JSON.parse(f.responseText);}catch(j){c.error("Unable to parse remote API response",j);}if(h.envelope==="JSON-RPC-1.0"){e.version=1;}if(h.methods){for(g=h.methods.length-1;g>=0;--g){d.addMethod(this,h.methods[g]);}}this.fire("apiready");},failure:function(){c.error("Unable to load remote API");this.fire("apierror");}},context:this});return this;}}},true);c.augment(d,c.EventTarget);c.jsonrpc=function(f,i,g,h,e){if(f&&i){return new c.JSONRPC(c.mix({url:f,preload:false},e)).exec(i,g,h);}};c.mix(c.namespace("RPC"),{JSON:c.JSONRPC,json:c.jsonrpc});},"gallery-2012.05.09-20-27",{requires:["io-base","event-custom","json"]});