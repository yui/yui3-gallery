YUI.add("gallery-dynamic-dialog",function(h){var e,d=h.Panel,c=h.Lang,b=c.sub,g=c.isValue,a=c.isString,f=h.Object.each;e=h.Base.create("dynamicDialog",h.Base,[],{container:h.one(document.body),panels:{},DEFAULT_EVENTS:{"a.open-dialog":"click","a.remote-dialog":"click"},initializer:function(){this.publish("submit",{defaultFn:this._defSubmitFn,preventable:true});this.publish("show",{preventable:false});},setupDelegates:function(){var i=this.container,j=this.DEFAULT_EVENTS,k=h.bind(this._triggerEventFn,this);f(j,function(m,l){i.delegate(m,k,l);});},_fetchDialogContent:function(n){var m=n.currentTarget,l=m.get("tagName")==="A"?m.get("href"):m.get("target"),k=m.getAttribute("data-async")==="true",o=(m.getAttribute("title")||""),p=h.bind(this._triggerEventFn,this),j=this.get("remoteFailureText"),i={method:"GET",on:{success:function(s,r){var q=h.one(h.config.doc.createDocumentFragment());q.append("<div>"+r.responseText+"</div>");q=q.one("div");q.setAttribute("data-async",k);q.setAttribute("title",o);n.dialogId=m.get("id");n.template=q;n.preventDefault=function(){};p(n);},failure:function(s,r){var q=h.one(h.config.doc.createDocumentFragment());q.append("<div>"+j+"</div>");q=q.one("div");q.setAttribute("data-async",k);q.setAttribute("title",o);n.dialogId=m.get("id");n.template=q;n.preventDefault=function(){};p(n);}}};h.io(l,i);},open:function(i){var j=h.one(i),k={currentTarget:j,preventDefault:function(){},halt:function(){}};this._dialogFromNode(k);},_triggerEventFn:function(i){this._dialogFromNode(i);},_dialogFromNode:function(p){var q=p.currentTarget,i=q.get("tagName")==="A"?q.get("href"):q.get("target"),t={},k=p.dialogId||i.substr(i.indexOf("#")),s=p.template||h.one(k),m=s?s.getAttribute("data-async")==="true":false,n=this.panels[k],o=q.get("attributes"),r=[];if(q.hasClass(this.get("remoteClass"))&&!s){p.preventDefault();return this._fetchDialogContent(p);}o.each(function(v){var u=v.get("name");if(u.match(/^data-/)){var w=q.getAttribute(u);if(w!==null){t[u.substr(5)]=w;}}});if(n||s){p.preventDefault();if(!n){n=this._setupDialog(q,s,t);}else{if(s){n.setStdModContent(h.WidgetStdMod.BODY,b(s.getContent(),t));}}var j=n.get("contentBox").one("form");if(j){var l=h.bind(this._defSubmitButtonFn,this);if(n.formListener){n.formListener.detach();}n.formListener=j.on("submit",function(u){u.preventDefault();u.async=m;u.dialog=this;u.trigger=q;u.form=this.get("contentBox").one("form");if(!u.form){throw"Form disappeared, was the dialog content replaced incorrectly?";}l(u);},n);}n.trigger=q;n.show();this.fire("show",{dialog:n,trigger:q});}},_setupDialog:function(m,t,u){var v=this,r=m.getAttribute("title")||t.getAttribute("title")||"",o=b(t.getContent(),u),s=m.getAttribute("data-modal")||t.getAttribute("data-modal")||this.get("modal"),q=m.getAttribute("data-zindex")||this.get("zIndex"),i=null,l=t.getAttribute("data-async")==="true",k=h.bind(this._defSubmitButtonFn,this),n=this.get("closeLabel"),p=null,j=null;i=new d({headerContent:r,bodyContent:o,modal:s,centered:true,zIndex:q,buttons:[{value:n,section:h.WidgetStdMod.HEADER,classNames:["closer"],action:function(w){this.hide();}}]});i.render(this.container);i.get("boundingBox").addClass("yui3-dynamic-dialog");p=i.get("contentBox");j=p.one("form");if(j){i.addButton({value:this.get("cancelLabel"),classNames:["yui3-dynamic-dialog-cancel"],action:function(w){w.preventDefault();this.hide();},section:h.WidgetStdMod.FOOTER});i.addButton({value:this.get("submitLabel"),classNames:["yui3-dynamic-dialog-submit"],action:function(w){w.preventDefault();w.async=l;w.dialog=this;w.trigger=this.trigger;w.form=this.get("contentBox").one("form");if(!w.form){throw"Form disappeared, was the dialog content replaced incorrectly?";}k(w);},section:h.WidgetStdMod.FOOTER});}else{i.addButton({value:this.get("okLabel"),classNames:["yui3-dynamic-dialog-ok"],action:function(w){w.preventDefault();this.hide();},section:h.WidgetStdMod.FOOTER});}this.panels["#"+t.get("id")]=i;return i;},_defSubmitButtonFn:function(i){this.fire("submit",{dialog:i.dialog,trigger:i.trigger,form:i.form,async:i.async||false});},_defSubmitFn:function(o){var k=o.dialog,m=o.form,l=o.async,j=o.trigger||k.trigger,n=m.getAttribute("action"),p=m.getAttribute("method")||"POST",i={};if(!l){k.hide();m.submit();return;}i.method=p.toUpperCase();i.form={id:m};i.context=this;i.arguments={dialog:k,form:m,trigger:j};i.on={success:this._ioSuccess,failure:this._ioFailure};h.io(n,i);},_ioSuccess:function(k,j,i){i.dialog.hide();i.response=j;this.fire("ioSuccess",i);},_ioFailure:function(p,m,i){var j=i.dialog,l=i.form,n=j.get("boundingBox"),k=this.get("ioFailureClass");i.response=m;this.fire("ioFailure",i);n.addClass(k);this._shakeNode(n,h.bind(function(){this.removeClass(k);},n));if(m.responseText){j.setStdModContent(h.WidgetStdMod.BODY,m.responseText);}},_shakeNode:function(l,n){var k=l.getX(),j=l.getY(),i=k+5,m;l.get("clientX");m=new h.Anim({node:l,to:{xy:[i,j]},duration:0.01,iterations:10,direction:"alternate"});if(n&&typeof n==="function"){m.on("end",n);}m.run();return m;}},{ATTRS:{modal:{value:false},zIndex:{value:1},closeLabel:{value:"âœ•"},okLabel:{value:"OK"},cancelLabel:{value:"Cancel"},submitLabel:{value:"Submit"},remoteFailureText:{value:"<p>There was a problem fetching the dialog content. Sorry.</p>"},dialogClass:{value:"open-dialog"},remoteClass:{value:"remote-dialog"},ioFailureClass:{value:"yui3-dynamic-dialog-io-failure"}}});h.DynamicDialog=e;},"gallery-2012.06.20-20-07",{requires:["anim","substitute","widget","base","panel","io","io-form","event-delegate"]});