YUI.add("gallery-yui3treeview-datasource",function(b){var a=function(){a.superclass.constructor.apply(this,arguments);};a.NAME="TreeviewDatasource";a.NS="ds";a.ATTRS={source:{value:null},loadingMsg:{value:null},dataSchemaJSON:{value:{resultListLocator:null,resultFields:null,metaFields:null}},sourceMethod:{value:null}};b.extend(a,b.Plugin.Base,{initializer:function(){var d=this.get("sourceMethod"),c=this.get("dataSchemaJSON");this.publish("sendRequest",{defaultFn:this._makeRequest});this.publish("onDataReturnSuccess",{defaultFn:this._defSuccessHandler});this.publish("onDataReturnFailure",{defaultFn:this._defFailureHandler});switch(d){case"io":this.treedatasource=new b.DataSource.IO({source:this.get("source")});break;case"get":this.treedatasource=new b.DataSource.Get({source:this.get("source")});break;case"local":this.treedatasource=new b.DataSource.Local({source:this.get("source")});break;}this.treedatasource.plug(b.Plugin.DataSourceJSONSchema,{schema:{resultListLocator:c.resultListLocator,resultFields:c.resultFields}});this.set("treeDataSource",this.treedatasource);},_tree:null,_defSuccessHandler:function(d){var c=this._tree;b.fire("onDataReturnSuccess",{data:d});if(this.get("loadingMsg")){c.get("contentBox").set("innerHTML","");}c.add(d.response.results);this.get("host").get("contentBox").focusManager.refresh();},_defFailureHandler:function(c){b.fire("onDataSourceFailure",{data:c});},_makeRequest:function(h){var i={success:b.bind(this._defSuccessHandler,this),failure:b.bind(this._defFailureHandler,this)},g=this.get("loadingMsg"),f=h.request,d,c=h.node;d=c.get("loadOnDemand");if(d!==false){c.set("loadOnDemand",false);this._tree=c;if(g){c.get("contentBox").set("innerHTML",g);}this.treedatasource.sendRequest({request:"?"+f,callback:i});}}});b.namespace("Plugin");b.Plugin.TreeviewDatasource=a;},"gallery-2010.12.01-21-32",{requires:["gallery-yui3treeview","plugin","datasource","datasource-jsonschema"]});