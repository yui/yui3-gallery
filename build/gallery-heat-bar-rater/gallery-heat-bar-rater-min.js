YUI.add("gallery-heat-bar-rater",function(E){var B=E.Node,D=E.Lang,C=E.Widget;function A(F){A.superclass.constructor.apply(this,arguments);}A.NAME="heatbarrater";A.ATTRS={rating:{value:0,validator:"_validateRating",broadcast:1},ratingUnrated:{value:0,writeOnce:true},valueMap:{value:{1:{color:"ffdd33",legend:"Awful"},2:{color:"ffcc33",legend:"Awful"},3:{color:"ffbb33",legend:"Not that good"},4:{color:"ffaa22",legend:"Not that good"},5:{color:"ff9922",legend:"Okay"},6:{color:"ff8822",legend:"Okay"},7:{color:"ff7711",legend:"Pretty good"},8:{color:"ff6611",legend:"Pretty good"},9:{color:"ff5500",legend:"Fantastic"},10:{color:"ff4400",legend:"Fantastic"}},writeOnce:true}};A.RATING_BAR_CLASS=E.ClassNameManager.getClassName(A.NAME,"rating-bar");A.RATING_BAR_UNRATED_CLASS=E.ClassNameManager.getClassName(A.NAME,"rating-bar-unrated");A.RATING_BAR_RATED_CLASS=E.ClassNameManager.getClassName(A.NAME,"rating-bar-rated");A.RATING_UNIT_CLASS=E.ClassNameManager.getClassName(A.NAME,"rating-unit");A.RATING_UNIT_ACTIVE_PART_CLASS=E.ClassNameManager.getClassName(A.NAME,"rating-unit-active");A.RATING_UNIT_FIRST_CLASS=E.ClassNameManager.getClassName(A.NAME,"rating-unit-first");A.RATING_UNIT_LAST_CLASS=E.ClassNameManager.getClassName(A.NAME,"rating-unit-last");A.RATING_LEGEND_CLASS=E.ClassNameManager.getClassName(A.NAME,"rating-legend");A.RATING_LEGEND_UNRATED_CLASS=E.ClassNameManager.getClassName(A.NAME,"rating-legend-unrated");A.RATING_BAR_TEMPLATE='<ol class="'+A.RATING_BAR_CLASS+'"></ol>';A.RATING_UNIT_TEMPLATE='<li title="{legend}" value="{value}" class="'+A.RATING_UNIT_CLASS+'"></li>';A.RATING_CARRIER_TEMPLATE='<input type="hidden" value="" name="{name}" />';A.RATING_LEGEND_TEMPLATE='<span class="'+A.RATING_LEGEND_CLASS+'"></span>';A.HTML_PARSER={rating:function(F){var G=parseInt(F.get("value"),10);return D.isNumber(G)?G:null;}};E.extend(A,C,{initializer:function(){var F=this.get("srcNode");this._ratingCarrierName=F.get("name");},destructor:function(){this._ratingBarNode=null;this._ratingLegendNode=null;this._ratingCarrierNode=null;this.get("boundingBox").replace(this.get("srcNode"));},renderUI:function(){var L=this.get("contentBox"),F=this.get("valueMap"),N=null,K=null,G=null,J=null,I=null,H=E.StyleSheet(A.NAME),O="",M=L.get("id");J=B.create(A.RATING_BAR_TEMPLATE);this._ratingBarNode=J;for(I in F){if(F.hasOwnProperty(I)){N=F[I];K=I;G=B.create(E.substitute(A.RATING_UNIT_TEMPLATE,{legend:N.legend,value:K}));O=this._getActiveUnitClassName(K);H.set("#"+M+" ."+A.RATING_BAR_RATED_CLASS+" ."+O,{backgroundColor:"#"+N.color,borderColor:"#"+N.color});J.appendChild(G);}}J.one(":first-child").addClass(A.RATING_UNIT_FIRST_CLASS);J.one(":last-child").addClass(A.RATING_UNIT_LAST_CLASS);L.appendChild(J);this._ratingLegendNode=B.create(A.RATING_LEGEND_TEMPLATE);L.appendChild(this._ratingLegendNode);this._ratingCarrierNode=B.create(E.substitute(A.RATING_CARRIER_TEMPLATE,{name:this._ratingCarrierName}));L.appendChild(this._ratingCarrierNode);},bindUI:function(){var F=this._ratingBarNode;this.after("ratingChange",this._afterRatingChange);F.delegate("click",E.bind(this._onSelectRating,this),"."+A.RATING_UNIT_CLASS);F.delegate("mouseenter",E.bind(this._onMouseEnterRatingUnit,this),"."+A.RATING_UNIT_CLASS);F.on("mouseleave",E.bind(this._onMouseLeaveRatingBar,this));},syncUI:function(){var F=this.get("rating");this._uiSetRatingBar(F);this._updateRatingCarrier(F);},_onMouseEnterRatingUnit:function(F){this._uiSetRatingBar(parseInt(F.currentTarget.getAttribute("value"),10));},_onMouseLeaveRatingBar:function(F){this.syncUI();},_onSelectRating:function(H){var F=H.currentTarget,G=F.getAttribute("value");this.set("rating",parseInt(G,10));},_afterRatingChange:function(F){this.syncUI();},_uiSetRatingBar:function(M){var K=this._ratingBarNode,G=K.all("."+A.RATING_UNIT_CLASS),L=M,J="",H=A.RATING_BAR_RATED_CLASS,F=A.RATING_BAR_UNRATED_CLASS,I=this._ratingLegendNode;if(L===this.get("ratingUnrated")){if(K.hasClass(H)===true){K.removeClass(H);}if(K.hasClass(F)===false){K.addClass(F);}J="Not rated";}else{if(K.hasClass(F)===true){K.removeClass(F);}if(K.hasClass(H)===false){K.addClass(H);}}G.each(function(N){var O=N.getAttribute("value"),P=this._getActiveUnitClassName(O);if(O<=L){if(N.hasClass(P)===false){N.addClass(P);}J=N.getAttribute("title");}else{if(N.hasClass(P)===true){N.removeClass(P);}}},this);if(L===this.get("ratingUnrated")){if(I.hasClass(A.RATING_LEGEND_UNRATED_CLASS)===false){I.addClass(A.RATING_LEGEND_UNRATED_CLASS);}}else{if(I.hasClass(A.RATING_LEGEND_UNRATED_CLASS)===true){I.removeClass(A.RATING_LEGEND_UNRATED_CLASS);}}I.set("innerHTML",J);},_updateRatingCarrier:function(F){this._ratingCarrierNode.set("value",F);},_getActiveUnitClassName:E.cached(function(F){return A.RATING_UNIT_ACTIVE_PART_CLASS+"-"+F;}),_defaultCB:function(){return null;},_validateRating:function(F){return(D.isNumber(F)&&((this.get("valueMap")[F]!==undefined)||(F===this.get("ratingUnrated"))));}});E.HeatBarRater=A;},"gallery-2010.07.28-20-07",{requires:["widget","substitute","stylesheet","event-mouseenter","selector-css3"]});