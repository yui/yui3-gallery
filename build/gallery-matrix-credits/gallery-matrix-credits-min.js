YUI.add("gallery-matrix-credits",function(a){function c(s){this.timer={};c.superclass.constructor.call(this,s);}c.NAME="matrixcredits";c.ATTRS={textSequence:{value:[],validator:a.Lang.isArray},introDelay:{value:5000,validator:a.Lang.isNumber},pagePause:{value:2000,validator:a.Lang.isNumber},restartDelay:{value:5000,validator:a.Lang.isNumber},cursor:{value:"block",validator:function(s){return s=="none"||s=="block"||s=="char";}},maxPhaseCount:{value:20,validator:a.Lang.isNumber},charRange:{value:["!","~"],validator:function(s){return(a.Lang.isArray(s)&&s.length==2&&s[0].length==1&&s[1].length==1&&s[0]<s[1]);}},background:{value:a.Plugin.MatrixBackground,writeOnce:true,validator:function(s){return(s===null||(s instanceof a.Plugin.Base));}},backgroundConfig:{writeOnce:true}};var q={cursor:30,spin:10};var i=a.Plugin.MatrixBackground.rnd;var h=a.Plugin.MatrixBackground.startTimer;var k=a.Plugin.MatrixBackground.stopTimer;var f=a.Plugin.MatrixBackground.getCharacterRange;function e(){var s=this.get("textSequence");var u=s[this.page_index];var t=(this.page_index==s.length-1)?"restartDelay":"pagePause";a.later(u.pause||this.get(t),this,p);}function p(){var s=this.get("textSequence");this.page_index++;if(this.page_index>=s.length){this.page_index=0;}var v=s[this.page_index];var u=a.reduce(v.intro||[],"",function(x,w){return x+"<p>"+(w||"&nbsp;")+"</p>";});var t=a.reduce(v.lines||[],"",function(y,w){y+="<p><span>";for(var x=0;x<w.length;x++){y+="&nbsp;";}return y+"</span></p>";});this.frame.setContent(u+t);this.frame_top=Math.floor((this.get("height")-this.frame.totalHeight())/2);this.frame.setStyle("top",this.frame_top+"px");if(v.lines){this.frame_lines=this.frame.all("span");this.cursor_pt={row:-1,col:-1};this.cursor_top=this.frame_top-this.frame.totalHeight();g.call(this);o.call(this);}else{e.call(this);}}function g(){this.cursor.removeClass("hidden");h.call(this,"cursor");var s=this.get("textSequence")[this.page_index].lines;do{this.cursor_pt.row++;}while(s[this.cursor_pt.row]=="&nbsp;");this.cursor_pt.col=-1;this.spin_index=0;this.spin_count=0;}function m(){this.cursor.addClass("hidden");this.cursor.setStyles({top:0,left:0});k.call(this,"cursor");}function l(){this.cursor_pt.col++;if(parseInt(this.cursor.getStyle("left"),10)>this.get("width")){m.call(this);d.call(this);return;}var t=this.cursor_width*this.cursor_pt.col,s=this.frame_lines.item(this.cursor_pt.row);this.cursor.setStyles({top:(this.cursor_top+s.get("offsetTop"))+"px",left:t+"px"});if(this.spin_index===0&&t>s.get("offsetLeft")){this.spin_index++;this.spin_text=s.get("innerHTML").replace(/&nbsp;/g," ").split("");this.end_text=this.get("textSequence")[this.page_index].lines[this.cursor_pt.row].split("");}else{if(0<this.spin_index&&this.spin_index<this.spin_text.length){this.spin_index++;}}}function o(){if(this.bkgd){this.spin_handle=this.bkgd.on("spin",n,this);}else{h.call(this,"spin");}}function j(){if(this.spin_handle){this.spin_handle.detach();this.spin_handle=null;}else{k.call(this,"spin");}}function n(){if(this.timer.cursor&&this.get("cursor")=="char"){var u=f.call(this.bkgd||this);this.cursor.set("innerHTML",String.fromCharCode(i(u[0],u[1]+1)));}if(this.spin_index>0){var s=this.frame_lines.item(this.cursor_pt.row),u=f.call(this),t=0;for(var v=0;v<this.spin_index;v++){if(this.spin_text[v]===this.end_text[v]){t++;continue;}this.spin_text[v]=String.fromCharCode(i(u[0],u[1]+1));}this.spin_count++;if(this.spin_count>this.get("maxPhaseCount")){this.spin_text=this.end_text.slice(0);t=this.spin_text.length;}s.set("innerHTML",this.spin_text.join("").replace(/\s/g,"&nbsp;"));if(t>=this.spin_text.length){j.call(this);d.call(this);}}}function d(){if(this.timer.cursor||this.spin_handle||this.timer.spin){return;}if(this.cursor_pt.row>=this.frame_lines.size()-1){e.call(this);}else{g.call(this);o.call(this);}}function b(){var s=this.get("cursor");if(s=="block"){this.cursor.set("innerHTML","\u2588");}else{this.cursor.set("innerHTML","&nbsp;");}this.cursor_width=this.cursor.get("offsetWidth");}function r(){this.set("width",a.DOM.winWidth());this.set("height",a.DOM.winHeight());}a.extend(c,a.Widget,{initializer:function(s){this.on("cursor",l);this.on("spin",n);},destructor:function(){k.call(this,"cursor");},bindUI:function(){if(this.get("boundingBox").ancestor()==a.one("body")){r.call(this);a.on("windowresize",r,this);}},syncUI:function(){var t=this.get("background");if(t){var s=this.get("boundingBox");s.plug(t,this.get("backgroundConfig"));this.bkgd=s.matrix;}this.frame=a.Node.create('<div class="frame"></div>');this.get("contentBox").append(this.frame);this.cursor=a.Node.create('<span class="cursor hidden"></span>');this.get("contentBox").append(this.cursor);b.call(this);this.after("cursorChange",b);this.page_index=-1;a.later(this.get("introDelay"),this,p);}});a.MatrixCredits=c;},"gallery-2012.06.13-20-30",{requires:["widget","gallery-matrix-background","gallery-funcprog"],skinnable:true});