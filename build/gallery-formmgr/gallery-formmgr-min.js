YUI.add("gallery-formmgr",function(d){function k(o,n){if(arguments.length===0){return;}if(!n){n={};}this.form_name=o;this.status_node=d.one(n.status_node);this.enabled=true;this.default_value_map=n.default_value_map;this.validation={fn:{},regex:{}};this.validation_msgs={};this.has_messages=false;this.has_errors=false;this.button_list=[];this.user_button_list=[];this.has_file_inputs=false;}var e="(?:^|\\s)(?:";var h=")(?:\\s|$)";k.row_marker_class="formmgr-row";k.field_marker_class="formmgr-field";k.status_marker_class="formmgr-message-text";k.status_none_class="formmgr-status-hidden";k.status_success_class="formmgr-status-success";k.status_failure_class="formmgr-status-failure";k.row_status_prefix="formmgr-has";var g;var m;var l;function b(){if(!g){g=k.status_success_class+"|"+k.status_failure_class;}return g;}function c(){if(!m){m=k.row_status_prefix+"([^\\s]+)";}return m;}function a(){if(!l){l=new RegExp(e+c()+h);}return l;}k.status_order=["error","warn","success","info"];k.getStatusPrecedence=function(n){for(var o=0;o<k.status_order.length;o++){if(n==k.status_order[o]){return o;}}return k.status_order.length;};k.statusTakesPrecendence=function(o,n){return(!o||k.getStatusPrecedence(n)<k.getStatusPrecedence(o));};k.getElementStatus=function(o){var n=d.one(o).get("className").match(a());return(n&&n.length>1?n[1]:false);};function f(n){if(d.Lang.isString(n)){return n.replace(/^#/,"");}else{if(n instanceof d.Node){return n.get("id");}else{return n.id;}}}k.cleanValues=function(r){var q=false;for(var o=0;o<r.length;o++){var n=r[o];var p=n.type&&n.type.toLowerCase();if(p=="file"){q=true;}else{if(p=="select-multiple"){}else{if(n.value){n.value=d.Lang.trim(n.value);}}}}return q;};function i(){var r=(this.button_list.length===0);for(var q=0;q<this.form.elements.length;q++){var u=this.form.elements[q];var p=u.tagName.toLowerCase();var s=(u.type?u.type.toLowerCase():null);if(r&&(s=="submit"||s=="reset"||p=="button")){this.button_list.push(u);}if(!u.name){continue;}var n=this.default_value_map[u.name];if(p=="input"&&s=="file"){u.value="";}else{if(d.Lang.isUndefined(n)){if(p=="input"&&(s=="password"||s=="text")){this.default_value_map[u.name]=u.value;}else{if(p=="input"&&s=="checkbox"){this.default_value_map[u.name]=(u.checked?u.value:"");}else{if(p=="input"&&s=="radio"){var t=this.form[u.name];if(t&&!t.length){this.default_value_map[u.name]=t.value;}else{if(t){this.default_value_map[u.name]=t[0].value;for(var o=0;o<t.length;o++){if(t[o].checked){this.default_value_map[u.name]=t[o].value;break;}}}}}else{if((p=="select"&&s=="select-one")||p=="textarea"){this.default_value_map[u.name]=u.value;}}}}}else{if(p=="input"&&(s=="password"||s=="text")){u.value=n;}else{if(p=="input"&&(s=="checkbox"||s=="radio")){u.checked=(u.value==n);}else{if(p=="select"&&s=="select-one"){u.value=n;if(u.selectedIndex>=0&&u.options[u.selectedIndex].value!==n.toString()){u.selectedIndex=-1;}}else{if(p=="textarea"){u.value=n;}}}}}}}}k.prototype={getForm:function(){if(!this.form){this.form=d.config.doc.forms[this.form_name];}return this.form;},hasFileInputs:function(){return this.has_file_inputs;},setDefaultValues:function(n){this.default_value_map=n;},setDefaultValue:function(o,n){this.default_value_map[o]=n;},saveCurrentValuesAsDefault:function(){this.default_value_map={};this.button_list=[];i.call(this);},setFunction:function(o,n){this.validation.fn[f(o)]=n;},setRegex:function(p,o,n){p=f(p);if(d.Lang.isString(o)){this.validation.regex[p]=new RegExp(o,n);}else{this.validation.regex[p]=o;}if(!this.validation_msgs[p]||!this.validation_msgs[p].regex){}},setErrorMessages:function(o,n){this.validation_msgs[f(o)]=n;},addErrorMessage:function(p,n,o){p=f(p);if(!this.validation_msgs[p]){this.validation_msgs[p]={};}this.validation_msgs[p][n]=o;},clearForm:function(){this.clearMessages();this.form.reset();this.postPopulateForm();},populateForm:function(){if(!this.default_value_map){this.default_value_map={};}this.clearMessages();i.call(this);this.postPopulateForm();},postPopulateForm:function(){},isChanged:function(){for(var p=0;p<this.form.elements.length;p++){var s=this.form.elements[p];if(!s.name){continue;}var q=(s.type?s.type.toLowerCase():null);var o=s.tagName.toLowerCase();var n=this.default_value_map[s.name];if(n===null||typeof n==="undefined"){n="";}if(o=="input"&&q=="file"){if(s.value){return true;}}else{if(o=="input"&&(q=="password"||q=="text"||q=="file")){if(s.value!=n){return true;}}else{if(o=="input"&&(q=="checkbox"||q=="radio")){var r=(s.value==n);if((r&&!s.checked)||(!r&&s.checked)){return true;}}else{if((o=="select"&&q=="select-one")||o=="textarea"){if(s.value!=n){return true;}}}}}}return false;},prepareForm:function(){this.getForm();if(!this.prePrepareForm.apply(this,arguments)){return false;}this.populateForm();return this.postPrepareForm.apply(this,arguments);},prePrepareForm:function(){return true;},postPrepareForm:function(){return true;},initFocus:function(){for(var p=0;p<this.form.elements.length;p++){var r=this.form.elements[p];if(r.disabled||r.offsetHeight===0){continue;}var n=r.tagName.toLowerCase();var q=(r.type?r.type.toLowerCase():null);if((n=="input"&&(q=="file"||q=="password"||q=="text"))||n=="textarea"){try{r.focus();}catch(o){}r.select();break;}}},validateForm:function(){this.clearMessages();var o=true;var t=this.form.elements;this.has_file_inputs=k.cleanValues(t);for(var p=0;p<t.length;p++){var u=t[p].id;var n=this.validation_msgs[u];var s=k.validateFromCSSData(t[p],n);if(s.error){this.displayMessage(t[p],s.error,"error");o=false;continue;}if(s.keepGoing){if(this.validation.regex[u]&&!this.validation.regex[u].test(t[p].value)){this.displayMessage(t[p],n?n.regex:null,"error");o=false;continue;}}var r=this.validation.fn[u];var q=this;if(d.Lang.isFunction(r)){}else{if(d.Lang.isString(r)){r=q[r];}else{if(r&&r.scope){q=r.scope;r=(d.Lang.isString(r.fn)?q[r.fn]:r.fn);}else{r=null;}}}if(r&&!r.call(q,this.form,d.one(t[p]))){o=false;continue;}}if(!this.postValidateForm(this.form)){o=false;}if(!o){this.notifyErrors();
}return o;},postValidateForm:function(n){return true;},registerButton:function(n){var o={e:d.one(n)};this.user_button_list.push(o);},isFormEnabled:function(){return this.enabled;},enableForm:function(){this.setFormEnabled(true);},disableForm:function(){this.setFormEnabled(false);},setFormEnabled:function(n){this.enabled=n;var p=!n;for(var o=0;o<this.button_list.length;o++){this.button_list[o].disabled=p;}for(o=0;o<this.user_button_list.length;o++){var q=this.user_button_list[o];q.e.set("disabled",p);}},hasMessages:function(){return this.has_messages;},hasErrors:function(){return this.has_errors;},getRowStatus:function(o){var n=d.one(o).getAncestorByClassName(k.row_marker_class,true);return k.getElementStatus(n);},clearMessages:function(){this.has_messages=false;this.has_errors=false;if(this.status_node){this.status_node.set("innerHTML","");this.status_node.replaceClass(b(),k.status_none_class);}for(var o=0;o<this.form.elements.length;o++){var s=this.form.elements[o];var n=s.tagName.toLowerCase();var q=(s.type?s.type.toLowerCase():null);if(n=="button"||q=="submit"||q=="reset"){continue;}var r=d.one(s).getAncestorByClassName(k.row_marker_class);if(r&&r.hasClass(c())){r.all("."+k.status_marker_class).set("innerHTML","");r.removeClass(c());r.all("."+k.field_marker_class).removeClass(c());}}d.one(this.form).all("fieldset").removeClass(c());},displayMessage:function(s,o,u,v){if(d.Lang.isUndefined(v)){v=true;}s=d.one(s);var n=s.getAncestorByClassName(k.row_marker_class);if(n&&k.statusTakesPrecendence(k.getElementStatus(n),u)){var r=n.all("."+k.field_marker_class);if(r){r.removeClass(c());}if(o){n.one("."+k.status_marker_class).set("innerHTML",o);}var q=k.row_status_prefix+u;n.replaceClass(c(),q);r=s.getAncestorByClassName(k.field_marker_class,true);if(r){r.replaceClass(c(),q);}var w=s.getAncestorByTagName("fieldset");if(w&&k.statusTakesPrecendence(k.getElementStatus(w),u)){w.removeClass(c());w.addClass(k.row_status_prefix+u);}if(!this.has_messages&&v){n.scrollIntoView();try{s.focus();}catch(t){}}this.has_messages=true;if(u=="error"){this.has_errors=true;}return true;}return false;},notifyErrors:function(){this.displayFormMessage(k.Strings.validation_error,true,false);},displayFormMessage:function(p,o,n){if(d.Lang.isUndefined(n)){n=true;}if(this.status_node){if(!this.status_node.innerHTML){this.status_node.replaceClass(k.status_none_class,(o?k.status_failure_class:k.status_success_class));this.status_node.set("innerHTML",p);}if(n){this.status_node.scrollIntoView();}}else{}}};if(d.FormManager){for(var j in d.FormManager){if(d.FormManager.hasOwnProperty(j)){k[j]=d.FormManager[j];}}}d.FormManager=k;},"gallery-2011.04.13-22-38",{requires:["gallery-node-optimizations","gallery-formmgr-css-validation"]});