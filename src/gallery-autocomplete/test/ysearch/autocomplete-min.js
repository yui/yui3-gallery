YUI.add("ac-plugin",function(C){function E(){E.superclass.constructor.apply(this,arguments);}var B="autocomplete",K=C.Lang,D=C.Array.each,F={query:function(P){var L=this,O=L.get("dataSource"),N=P.value,M=C.bind(G,L);if(O){O.sendRequest({request:L.get("queryTemplate")(N),callback:{success:M,failure:M}});}}};C.Plugin.ACPlugin=C.extend(E,C.Plugin.Base,{initializer:function(){var L=this,M=L.get("host");I(L,M);var N=F;D(["query","load","show","hide","next","previous"],function(O){L.publish("ac:"+O,{broadcast:1,bubbles:1,context:L,preventable:true,defaultFn:N[O]||null,prefix:"ac"});},L);J(M);},destructor:function(){C.detach(C.stamp(this)+"|");},open:function(){this.fire("ac:show");},next:function(L){L.preventDefault();this.fire("ac:next");},previous:function(L){L.preventDefault();this.fire("ac:previous");},close:function(){this.fire("ac:hide");}},{NAME:"ACPlugin",NS:"ac",ATTRS:{queryValue:{getter:function(){return this.get("host").get("value");},setter:function(L){this.get("host").set("value",L);return(this._cachedValue=L);}},dataSource:{validator:function(L){return L&&K.isFunction(L.sendRequest);}},minQueryLength:{value:3,validator:K.isNumber},queryTemplate:{value:encodeURIComponent,setter:function(L){return(K.isFunction(L)?L:function(M){return L.replace(/(^|[^\\])((\\{2})*)\{query\}/,"$1$2"+encodeURIComponent(M)).replace(/(^|[^\\])((\\{2})*)\\(\{query\})/,"$1$2$4");});}}}});function I(L,N){var M=C.stamp(this)+"|";C.on(M+"valueChange",H,N,L);C.on(M+"key",L.next,N,"down:40",L);C.on(M+"key",L.previous,N,"down:38",L);C.on(M+"key",L.close,N,"down:27",L);}function H(M){var L=M.value;if(!L){return this.close();}if(L===this._cachedValue||L.length<this.get("minQueryLength")){return;}this._cachedValue=L;this.fire("ac:query",{value:M.value});}function A(L){return function(){if(L){L.setAttribute(B,"on");}L=null;};}function J(L){var N=C.Node.getDOMNode(L),O=N.getAttribute(B);if((O&&O!=="off")||O===null||O===undefined){var M=A(N);C.on("beforeunload",M,window);C.on("unload",M,window);}N.setAttribute(B,"off");}function G(M){var L=(M&&M.response&&M.response.results)?M.response.results:M;if(L&&!(L&&("length" in L)&&L.length===0)){this.fire("ac:load",{results:L,query:this.get("queryValue")});}}},"@VERSION@",{requires:["node","plugin","value-change","event-key"],optional:["event-custom"]});YUI.add("ac-widget",function(B){function D(){D.superclass.constructor.apply(this,arguments);}var A="_bound",E="selectedIndex",J="_selectedIndex",G="_originalValue",C=B.Array.each,F="queryValue";B.ACWidget=B.extend(D,B.Widget,{initializer:function(){var K=this;K.after({queryChanged:K.syncUI,dataChanged:K.syncUI});K.hide();},renderUI:function(){var L=this.get("ac");if(!L){return;}var K=L.get("host");H(this.get("boundingBox"),K);this.setSize();return;},setSize:function(){return this.set("width",this.get("ac").get("host").getComputedStyle("width"));},bindUI:function(N){var O=this,K=O.get("contentBox"),M=O.get("ac"),L=B.stamp(O)+"|";if(N&&M!==N&&O[A]){B.detach(L);O[A]=0;}N=N||M;if(N&&!O[A]){O[A]=1;K.delegate(L+"click",O.click,"li",O);B.on(L+"click",O.hide,document);N.on(L+"ac:load",function(P){O.setAttrs({query:P.query,data:P.results}).syncUI().show();});N.on(L+"ac:query",function(P){O.set("query",P.value).syncUI();});N.on(L+"ac:next",O.next,O);N.on(L+"ac:previous",O.previous,O);N.on(L+"ac:hide",O.hide,O);}return O;},syncUI:function(){var K=this,M=K.get("data"),L=K.get("query");if(!M){return K;}K[J]=-1;K[G]="";K.get("contentBox").set("innerHTML",K.getListMarkup(M));return K;},getListMarkup:function(N){var M=this,K=M.get("listTpl"),L=[];C(N,function(O){L.push(M.getItemMarkup(O));});return K.replace(/\{list\}/g,L.join(""));},getItemMarkup:function(K){return this.get("itemTpl").replace(/\{term\}/g,K).replace(/\{hilite\}/g,this.getHiliteMarkup(K));},getHiliteMarkup:function(M){var L=this,K=L.get("query").split(/\s+/);out=M;C(K,function(N){if(!N){return;}N=I(N);out=out.replace(new RegExp(N,"g"),L.get("hiliteTpl").replace(/\{term\}/g,N));});return out;},next:function(){var K=this;return(K.get("visible")?K.selectNext():K.get("data")?K.show():K);},selectNext:function(){return this.set(E,this.get(E)+1);},selectPrevious:function(){return this.set(E,this.get(E)-1);},previous:function(){return this.get("visible")?this.selectPrevious():this;},item:function(K){return this.get("contentBox").one(this.get("itemSelector").replace(/\{n\}/g,I(K+1)));},click:function(M){var K=this,L=K.get("ac"),N=M.currentTarget.get("text");L.set(F,N);K[J]=-1;K._currentValue=N;L.get("host").focus();K.hide();}},{NAME:"ACWidget",ATTRS:{ac:{setter:function(K){if(!this[A]){return;}this.bindUI(K);},validator:function(K){return true;}},data:{validator:function(K){return K&&K.length>0;}},query:{value:""},listTpl:{value:"<ul>{list}</ul>"},itemTpl:{value:"<li>{hilite}</li>"},itemSelector:{value:"ul li:nth-child({n})"},hiliteTpl:{value:"<em>{term}</em>"}}});D.ATTRS[E]={value:-1,validator:function(K){var L=this.get("data");return L&&B.Lang.isNumber(K);},getter:function(){return this[J];},setter:function(M){var R=this,O=R.get(E),P=R.get("data"),K=P&&P.length,Q=R.get("ac"),L=this.getClassName("selected");if(isNaN(O)){O=-1;}if(!P||!K){return;}while(M<-1){M+=K+1;}M=(M+1)%(K+1)-1;O=(O+1)%(K+1)-1;R[J]=M;if(O===-1){R[G]=Q.get(F);}if(O===M){return;}var S=R.get("contentBox").one("."+L);if(S){S.removeClass(L);}if(M===-1){Q.set(F,this[G]);}else{var N=R.item(M);if(N){N.addClass(L);}Q.set(F,P[M]);}return M;}};function I(K){return(""+K).replace(/([\^\/.*+?|()[\]{}\\])/g,"\\$1");}function H(L,K){K.insert(L,"after");return;var M=K.get("parentNode");M.insertBefore(L,K);M.insertBefore(K,L);}},"@VERSION@",{requires:["widget","ac-plugin"]});YUI.add("autocomplete",function(A){},"@VERSION@",{use:["ac-plugin"]});